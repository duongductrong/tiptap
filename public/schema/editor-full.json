{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "editor-full",
  "title": "Editor (Full)",
  "description": "Complete rich text editor with all extensions: image, table, code block, and slash menu.",
  "dependencies": [
    "@tiptap/core",
    "@tiptap/react",
    "@tiptap/starter-kit",
    "@tiptap/extension-text-align",
    "@tiptap/extension-typography",
    "@tiptap/extension-underline",
    "@tiptap/extension-highlight",
    "@tiptap/extension-link",
    "@tiptap/extension-task-list",
    "@tiptap/extension-task-item",
    "@tiptap/extension-placeholder",
    "@tiptap/extension-table",
    "@tiptap/extension-table-row",
    "@tiptap/extension-table-header",
    "@tiptap/extension-table-cell",
    "@tiptap/extension-code-block-lowlight",
    "@tiptap/suggestion",
    "lowlight",
    "lucide-react",
    "tippy.js"
  ],
  "registryDependencies": [
    "button",
    "dropdown-menu",
    "scroll-area",
    "input",
    "popover",
    "tabs"
  ],
  "files": [
    {
      "path": "src/registry/editor/editor.tsx",
      "content": "\"use client\"\n\nimport { Button } from \"@/components/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { Input } from \"@/components/ui/input\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { cn } from \"@/lib/utils\"\nimport * as React from \"react\"\n\nimport { TextAlign } from \"@tiptap/extension-text-align\"\nimport TiptapTypography from \"@tiptap/extension-typography\"\nimport TiptapUnderline from \"@tiptap/extension-underline\"\nimport {\n  BubbleMenu,\n  Editor,\n  Extensions,\n  FloatingMenu,\n  EditorContent as TiptapEditorContent,\n  useEditorState,\n  useEditor as useTiptapEditor,\n  type UseEditorOptions,\n} from \"@tiptap/react\"\nimport StarterKit from \"@tiptap/starter-kit\"\nimport {\n  AlignCenter,\n  AlignJustify,\n  AlignLeft,\n  AlignRight,\n  Bold,\n  Check,\n  CheckSquare,\n  ChevronDown,\n  Code,\n  Heading1,\n  Heading2,\n  Heading3,\n  Heading4,\n  Heading5,\n  Heading6,\n  Highlighter,\n  ImageUp,\n  Italic,\n  Link2,\n  Link2Off,\n  List,\n  ListOrdered,\n  Minus,\n  Redo,\n  Strikethrough,\n  TextQuote,\n  Type,\n  Underline,\n  Undo,\n} from \"lucide-react\"\nimport { EditorBubbleMenuLink } from \"./editor-link\"\nimport { EDITOR_PLACEHOLDER_CLASSES } from \"./editor-placeholder\"\n\n// =============================================================================\n// Constants\n// =============================================================================\n\nexport const EDITOR_ACTIONS = {\n  // @tiptap/starter-kit\n  undo: \"undo\",\n  redo: \"redo\",\n  bold: \"bold\",\n  italic: \"italic\",\n  strike: \"strike\",\n  code: \"code\",\n  divider: \"divider\",\n  heading1: \"heading1\",\n  heading2: \"heading2\",\n  heading3: \"heading3\",\n  heading4: \"heading4\",\n  heading5: \"heading5\",\n  heading6: \"heading6\",\n  text: \"paragraph\",\n  blockquote: \"blockquote\",\n  bulletList: \"bulletList\",\n  orderedList: \"orderedList\",\n  codeBlock: \"codeBlock\",\n  // @tiptap/extension-underline\n  underline: \"underline\",\n  // Text alignment\n  left: \"left\",\n  center: \"center\",\n  right: \"right\",\n  justify: \"justify\",\n  // Image\n  image: \"image\",\n  // Table\n  insertTable: \"insertTable\",\n  addColumnBefore: \"addColumnBefore\",\n  addColumnAfter: \"addColumnAfter\",\n  deleteColumn: \"deleteColumn\",\n  addRowBefore: \"addRowBefore\",\n  addRowAfter: \"addRowAfter\",\n  deleteRow: \"deleteRow\",\n  deleteTable: \"deleteTable\",\n  mergeCells: \"mergeCells\",\n  splitCell: \"splitCell\",\n  toggleHeaderColumn: \"toggleHeaderColumn\",\n  toggleHeaderRow: \"toggleHeaderRow\",\n  toggleHeaderCell: \"toggleHeaderCell\",\n  mergeOrSplit: \"mergeOrSplit\",\n  goToNextCell: \"goToNextCell\",\n  goToPreviousCell: \"goToPreviousCell\",\n  // Task list\n  taskList: \"taskList\",\n  // Highlight\n  highlight: \"highlight\",\n  // Link\n  setLink: \"setLink\",\n  unsetLink: \"unsetLink\",\n} as const\n\nexport type EditorAction = (typeof EDITOR_ACTIONS)[keyof typeof EDITOR_ACTIONS]\n\nconst EDITOR_TEXT_ALIGN_ACTIONS: EditorAction[] = [\n  EDITOR_ACTIONS.left,\n  EDITOR_ACTIONS.center,\n  EDITOR_ACTIONS.right,\n  EDITOR_ACTIONS.justify,\n]\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface EditorBlock {\n  key: EditorAction\n  icon: React.ElementType\n  label: string\n  description: string\n}\n\nexport const EDITOR_BLOCKS_MAP = new Map<EditorAction, EditorBlock>([\n  [\n    EDITOR_ACTIONS.undo,\n    {\n      key: EDITOR_ACTIONS.undo,\n      icon: Undo,\n      label: \"Undo\",\n      description: \"Undo the last action\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.redo,\n    {\n      key: EDITOR_ACTIONS.redo,\n      icon: Redo,\n      label: \"Redo\",\n      description: \"Redo the last action\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.text,\n    {\n      key: EDITOR_ACTIONS.text,\n      icon: Type,\n      label: \"Text\",\n      description: \"Start writing with plain text\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.heading1,\n    {\n      key: EDITOR_ACTIONS.heading1,\n      icon: Heading1,\n      label: \"Heading 1\",\n      description: \"Use this for main titles\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.heading2,\n    {\n      key: EDITOR_ACTIONS.heading2,\n      icon: Heading2,\n      label: \"Heading 2\",\n      description: \"Ideal for subsections\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.heading3,\n    {\n      key: EDITOR_ACTIONS.heading3,\n      icon: Heading3,\n      label: \"Heading 3\",\n      description: \"Use for smaller subsections\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.heading4,\n    {\n      key: EDITOR_ACTIONS.heading4,\n      icon: Heading4,\n      label: \"Heading 4\",\n      description: \"Suitable for detailed sections\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.heading5,\n    {\n      key: EDITOR_ACTIONS.heading5,\n      icon: Heading5,\n      label: \"Heading 5\",\n      description: \"For minor details\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.heading6,\n    {\n      key: EDITOR_ACTIONS.heading6,\n      icon: Heading6,\n      label: \"Heading 6\",\n      description: \"Use for the smallest details\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.blockquote,\n    {\n      key: EDITOR_ACTIONS.blockquote,\n      icon: TextQuote,\n      label: \"Quote\",\n      description: \"Capture a quote\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.bold,\n    {\n      key: EDITOR_ACTIONS.bold,\n      icon: Bold,\n      label: \"Bold\",\n      description: \"Make text bold\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.italic,\n    {\n      key: EDITOR_ACTIONS.italic,\n      icon: Italic,\n      label: \"Italic\",\n      description: \"Italicize text\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.underline,\n    {\n      key: EDITOR_ACTIONS.underline,\n      icon: Underline,\n      label: \"Underline\",\n      description: \"Underline text\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.strike,\n    {\n      key: EDITOR_ACTIONS.strike,\n      icon: Strikethrough,\n      label: \"Strikethrough\",\n      description: \"Strike through text\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.code,\n    {\n      key: EDITOR_ACTIONS.code,\n      icon: Code,\n      label: \"Code\",\n      description: \"Format text as code\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.divider,\n    {\n      key: EDITOR_ACTIONS.divider,\n      icon: Minus,\n      label: \"Divider\",\n      description: \"Visually divide blocks\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.bulletList,\n    {\n      key: EDITOR_ACTIONS.bulletList,\n      icon: List,\n      label: \"Bullet List\",\n      description: \"Create a bullet list\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.orderedList,\n    {\n      key: EDITOR_ACTIONS.orderedList,\n      icon: ListOrdered,\n      label: \"Ordered List\",\n      description: \"Create an ordered list\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.left,\n    {\n      key: EDITOR_ACTIONS.left,\n      icon: AlignLeft,\n      label: \"Left\",\n      description: \"Align text to the left\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.center,\n    {\n      key: EDITOR_ACTIONS.center,\n      icon: AlignCenter,\n      label: \"Center\",\n      description: \"Align text to the center\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.right,\n    {\n      key: EDITOR_ACTIONS.right,\n      icon: AlignRight,\n      label: \"Right\",\n      description: \"Align text to the right\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.justify,\n    {\n      key: EDITOR_ACTIONS.justify,\n      icon: AlignJustify,\n      label: \"Justify\",\n      description: \"Align text to justify\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.image,\n    {\n      key: EDITOR_ACTIONS.image,\n      icon: ImageUp,\n      label: \"Image\",\n      description: \"Upload or embed an image\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.taskList,\n    {\n      key: EDITOR_ACTIONS.taskList,\n      icon: CheckSquare,\n      label: \"Task List\",\n      description: \"Create a task list with checkboxes\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.highlight,\n    {\n      key: EDITOR_ACTIONS.highlight,\n      icon: Highlighter,\n      label: \"Highlight\",\n      description: \"Highlight selected text\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.setLink,\n    {\n      key: EDITOR_ACTIONS.setLink,\n      icon: Link2,\n      label: \"Add Link\",\n      description: \"Insert a hyperlink\",\n    },\n  ],\n  [\n    EDITOR_ACTIONS.unsetLink,\n    {\n      key: EDITOR_ACTIONS.unsetLink,\n      icon: Link2Off,\n      label: \"Remove Link\",\n      description: \"Remove the hyperlink\",\n    },\n  ],\n])\n\n// =============================================================================\n// Default Extensions\n// =============================================================================\n\nexport const defaultExtensions = [\n  StarterKit.configure({\n    codeBlock: false, // Use CodeBlock extension separately\n  }),\n  TiptapUnderline.configure({\n    HTMLAttributes: {\n      class: \"underline underline-offset-4\",\n    },\n  }),\n  TextAlign.configure({\n    types: [\"heading\", \"paragraph\", \"blockquote\", \"bulletList\", \"orderedList\"],\n  }),\n  TiptapTypography.configure({}),\n]\n\n// =============================================================================\n// Context\n// =============================================================================\n\nexport interface EditorContextValue {\n  editor: Editor | null\n}\n\nexport const EditorContext = React.createContext<EditorContextValue | null>(\n  null\n)\n\nexport function useEditor(): EditorContextValue {\n  const ctx = React.useContext(EditorContext)\n  if (!ctx) {\n    throw new Error(\"useEditor must be used within EditorProvider\")\n  }\n  return ctx\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\nexport function canUseEditorAction(\n  editor: Editor | null,\n  action: EditorAction\n): boolean {\n  if (!editor) return false\n\n  switch (action) {\n    case EDITOR_ACTIONS.undo:\n      return editor.can().chain().focus().undo().run()\n    case EDITOR_ACTIONS.redo:\n      return editor.can().chain().focus().redo().run()\n    case EDITOR_ACTIONS.text:\n      return editor.can().chain().focus().setParagraph().run()\n    case EDITOR_ACTIONS.heading1:\n      return editor.can().chain().focus().setHeading({ level: 1 }).run()\n    case EDITOR_ACTIONS.heading2:\n      return editor.can().chain().focus().setHeading({ level: 2 }).run()\n    case EDITOR_ACTIONS.heading3:\n      return editor.can().chain().focus().setHeading({ level: 3 }).run()\n    case EDITOR_ACTIONS.heading4:\n      return editor.can().chain().focus().setHeading({ level: 4 }).run()\n    case EDITOR_ACTIONS.heading5:\n      return editor.can().chain().focus().setHeading({ level: 5 }).run()\n    case EDITOR_ACTIONS.heading6:\n      return editor.can().chain().focus().setHeading({ level: 6 }).run()\n    case EDITOR_ACTIONS.codeBlock:\n      return editor.can().chain().focus().toggleCodeBlock().run()\n    case EDITOR_ACTIONS.divider:\n      return editor.can().chain().focus().setHorizontalRule().run()\n    case EDITOR_ACTIONS.bold:\n      return editor.can().chain().focus().toggleBold().run()\n    case EDITOR_ACTIONS.italic:\n      return editor.can().chain().focus().toggleItalic().run()\n    case EDITOR_ACTIONS.strike:\n      return editor.can().chain().focus().toggleStrike().run()\n    case EDITOR_ACTIONS.code:\n      return editor.can().chain().focus().toggleCode().run()\n    case EDITOR_ACTIONS.blockquote:\n      return editor.can().chain().focus().setBlockquote().run()\n    case EDITOR_ACTIONS.bulletList:\n      return editor.can().chain().focus().toggleBulletList().run()\n    case EDITOR_ACTIONS.orderedList:\n      return editor.can().chain().focus().toggleOrderedList().run()\n    case EDITOR_ACTIONS.left:\n      return editor.can().chain().focus().setTextAlign(\"left\").run()\n    case EDITOR_ACTIONS.center:\n      return editor.can().chain().focus().setTextAlign(\"center\").run()\n    case EDITOR_ACTIONS.right:\n      return editor.can().chain().focus().setTextAlign(\"right\").run()\n    case EDITOR_ACTIONS.underline:\n      return editor.can().chain().focus().toggleUnderline().run()\n    case EDITOR_ACTIONS.image:\n      return true\n    case EDITOR_ACTIONS.insertTable:\n      return editor\n        .can()\n        .chain()\n        .focus()\n        .insertTable({ rows: 3, cols: 3 })\n        .run()\n    case EDITOR_ACTIONS.addColumnBefore:\n      return editor.can().chain().focus().addColumnBefore().run()\n    case EDITOR_ACTIONS.addColumnAfter:\n      return editor.can().chain().focus().addColumnAfter().run()\n    case EDITOR_ACTIONS.deleteColumn:\n      return editor.can().chain().focus().deleteColumn().run()\n    case EDITOR_ACTIONS.addRowBefore:\n      return editor.can().chain().focus().addRowBefore().run()\n    case EDITOR_ACTIONS.addRowAfter:\n      return editor.can().chain().focus().addRowAfter().run()\n    case EDITOR_ACTIONS.deleteRow:\n      return editor.can().chain().focus().deleteRow().run()\n    case EDITOR_ACTIONS.deleteTable:\n      return editor.can().chain().focus().deleteTable().run()\n    case EDITOR_ACTIONS.mergeCells:\n      return editor.can().chain().focus().mergeCells().run()\n    case EDITOR_ACTIONS.splitCell:\n      return editor.can().chain().focus().splitCell().run()\n    case EDITOR_ACTIONS.toggleHeaderColumn:\n      return editor.can().chain().focus().toggleHeaderColumn().run()\n    case EDITOR_ACTIONS.toggleHeaderRow:\n      return editor.can().chain().focus().toggleHeaderRow().run()\n    case EDITOR_ACTIONS.toggleHeaderCell:\n      return editor.can().chain().focus().toggleHeaderCell().run()\n    case EDITOR_ACTIONS.mergeOrSplit:\n      return editor.can().chain().focus().mergeOrSplit().run()\n    case EDITOR_ACTIONS.goToNextCell:\n      return editor.can().chain().focus().goToNextCell().run()\n    case EDITOR_ACTIONS.goToPreviousCell:\n      return editor.can().chain().focus().goToPreviousCell().run()\n    case EDITOR_ACTIONS.taskList:\n      return editor.can().chain().focus().toggleTaskList().run()\n    case EDITOR_ACTIONS.highlight:\n      return editor.can().chain().focus().toggleHighlight().run()\n    case EDITOR_ACTIONS.setLink:\n      return true\n    case EDITOR_ACTIONS.unsetLink:\n      return editor.isActive(\"link\")\n    default:\n      return true\n  }\n}\n\nexport function executeEditorAction(\n  editor: Editor | null,\n  action: EditorAction,\n  options: Record<string, unknown> = {}\n): void {\n  if (!editor) return\n\n  switch (action) {\n    case EDITOR_ACTIONS.undo:\n      editor.chain().focus().undo().run()\n      break\n    case EDITOR_ACTIONS.redo:\n      editor.chain().focus().redo().run()\n      break\n    case EDITOR_ACTIONS.text:\n      editor.chain().focus().setParagraph().run()\n      break\n    case EDITOR_ACTIONS.heading1:\n      editor.chain().focus().setHeading({ level: 1 }).run()\n      break\n    case EDITOR_ACTIONS.heading2:\n      editor.chain().focus().setHeading({ level: 2 }).run()\n      break\n    case EDITOR_ACTIONS.heading3:\n      editor.chain().focus().setHeading({ level: 3 }).run()\n      break\n    case EDITOR_ACTIONS.heading4:\n      editor.chain().focus().setHeading({ level: 4 }).run()\n      break\n    case EDITOR_ACTIONS.heading5:\n      editor.chain().focus().setHeading({ level: 5 }).run()\n      break\n    case EDITOR_ACTIONS.heading6:\n      editor.chain().focus().setHeading({ level: 6 }).run()\n      break\n    case EDITOR_ACTIONS.codeBlock:\n      editor.chain().focus().toggleCodeBlock().run()\n      break\n    case EDITOR_ACTIONS.divider:\n      editor.chain().focus().setHorizontalRule().run()\n      break\n    case EDITOR_ACTIONS.bold:\n      editor.chain().focus().toggleBold().run()\n      break\n    case EDITOR_ACTIONS.italic:\n      editor.chain().focus().toggleItalic().run()\n      break\n    case EDITOR_ACTIONS.strike:\n      editor.chain().focus().toggleStrike().run()\n      break\n    case EDITOR_ACTIONS.code:\n      editor.chain().focus().toggleCode().run()\n      break\n    case EDITOR_ACTIONS.blockquote:\n      editor.chain().focus().setBlockquote().run()\n      break\n    case EDITOR_ACTIONS.bulletList:\n      editor.chain().focus().toggleBulletList().run()\n      break\n    case EDITOR_ACTIONS.orderedList:\n      editor.chain().focus().toggleOrderedList().run()\n      break\n    case EDITOR_ACTIONS.left:\n      editor.chain().focus().setTextAlign(\"left\").run()\n      break\n    case EDITOR_ACTIONS.center:\n      editor.chain().focus().setTextAlign(\"center\").run()\n      break\n    case EDITOR_ACTIONS.right:\n      editor.chain().focus().setTextAlign(\"right\").run()\n      break\n    case EDITOR_ACTIONS.justify:\n      editor.chain().focus().setTextAlign(\"justify\").run()\n      break\n    case EDITOR_ACTIONS.underline:\n      editor.chain().focus().toggleUnderline().run()\n      break\n    case EDITOR_ACTIONS.image:\n      editor\n        .chain()\n        .focus()\n        .setImage({\n          src: options.src as string,\n          alt: options.alt as string,\n          title: options.title as string,\n        })\n        .run()\n      break\n    case EDITOR_ACTIONS.insertTable:\n      editor\n        .chain()\n        .focus()\n        .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n        .run()\n      break\n    case EDITOR_ACTIONS.addColumnBefore:\n      editor.chain().focus().addColumnBefore().run()\n      break\n    case EDITOR_ACTIONS.addColumnAfter:\n      editor.chain().focus().addColumnAfter().run()\n      break\n    case EDITOR_ACTIONS.deleteColumn:\n      editor.chain().focus().deleteColumn().run()\n      break\n    case EDITOR_ACTIONS.addRowBefore:\n      editor.chain().focus().addRowBefore().run()\n      break\n    case EDITOR_ACTIONS.addRowAfter:\n      editor.chain().focus().addRowAfter().run()\n      break\n    case EDITOR_ACTIONS.deleteRow:\n      editor.chain().focus().deleteRow().run()\n      break\n    case EDITOR_ACTIONS.deleteTable:\n      editor.chain().focus().deleteTable().run()\n      break\n    case EDITOR_ACTIONS.mergeCells:\n      editor.chain().focus().mergeCells().run()\n      break\n    case EDITOR_ACTIONS.splitCell:\n      editor.chain().focus().splitCell().run()\n      break\n    case EDITOR_ACTIONS.toggleHeaderColumn:\n      editor.chain().focus().toggleHeaderColumn().run()\n      break\n    case EDITOR_ACTIONS.toggleHeaderRow:\n      editor.chain().focus().toggleHeaderRow().run()\n      break\n    case EDITOR_ACTIONS.toggleHeaderCell:\n      editor.chain().focus().toggleHeaderCell().run()\n      break\n    case EDITOR_ACTIONS.mergeOrSplit:\n      editor.chain().focus().mergeOrSplit().run()\n      break\n    case EDITOR_ACTIONS.goToNextCell:\n      editor.chain().focus().goToNextCell().run()\n      break\n    case EDITOR_ACTIONS.goToPreviousCell:\n      editor.chain().focus().goToPreviousCell().run()\n      break\n    case EDITOR_ACTIONS.taskList:\n      editor.chain().focus().toggleTaskList().run()\n      break\n    case EDITOR_ACTIONS.highlight:\n      editor.chain().focus().toggleHighlight().run()\n      break\n    case EDITOR_ACTIONS.unsetLink:\n      editor.chain().focus().unsetLink().run()\n      break\n  }\n}\n\nexport function getActiveEditorActions(editor: Editor | null): EditorAction[] {\n  if (!editor) return [EDITOR_ACTIONS.text]\n\n  const keys: Set<EditorAction> = new Set()\n\n  if (editor.isActive(\"heading\")) {\n    const headingLevel = editor.getAttributes(\"heading\").level\n    const headingMap = `heading${headingLevel}` as EditorAction\n    if (EDITOR_BLOCKS_MAP.has(headingMap)) {\n      keys.add(headingMap)\n    }\n  }\n\n  EDITOR_BLOCKS_MAP.forEach((block) => {\n    if (EDITOR_TEXT_ALIGN_ACTIONS.includes(block.key)) {\n      if (editor.isActive({ textAlign: block.key })) {\n        keys.add(block.key)\n      }\n    } else if (editor.isActive(block.key)) {\n      keys.add(block.key)\n    }\n  })\n\n  // Paragraph (text) has lowest priority - if any other block is active, hide paragraph\n  if (keys.size > 1 && keys.has(EDITOR_ACTIONS.text)) {\n    keys.delete(EDITOR_ACTIONS.text)\n  }\n\n  return keys.size > 0 ? Array.from(keys) : [EDITOR_ACTIONS.text]\n}\n\n// =============================================================================\n// EditorProvider\n// =============================================================================\n\ntype NestedArray<T> = T | NestedArray<T>[]\n\nexport type EditorExtensions = NestedArray<Extensions[number]>\n\nexport interface EditorProviderProps\n  extends React.PropsWithChildren, Omit<UseEditorOptions, \"extensions\"> {\n  content?: string\n  extensions?: EditorExtensions[]\n  className?: string\n}\n\nconst EditorProvider = React.forwardRef<HTMLDivElement, EditorProviderProps>(\n  (\n    { content, extensions = [], children, className, ...editorOptions },\n    ref\n  ) => {\n    const editor = useTiptapEditor({\n      content,\n      extensions: toLatentArray(defaultExtensions, extensions),\n      ...editorOptions,\n    })\n\n    const contextValue = React.useMemo<EditorContextValue>(\n      () => ({ editor }),\n      [editor]\n    )\n\n    return (\n      <EditorContext.Provider value={contextValue}>\n        <div\n          ref={ref}\n          className={cn(\"relative\", className)}\n          data-editor-root=\"\"\n        >\n          {children}\n        </div>\n      </EditorContext.Provider>\n    )\n  }\n)\nEditorProvider.displayName = \"EditorProvider\"\n\n// =============================================================================\n// EditorContent\n// =============================================================================\n\nexport interface EditorContentProps extends Omit<\n  React.ComponentProps<typeof TiptapEditorContent>,\n  \"editor\"\n> {}\n\nconst EditorContent = React.forwardRef<HTMLDivElement, EditorContentProps>(\n  ({ className, ...props }, ref) => {\n    const { editor } = useEditor()\n\n    if (!editor) return null\n\n    return (\n      <TiptapEditorContent\n        ref={ref}\n        editor={editor}\n        className={cn(\n          \"w-full\",\n          \"[&>*]:outline-none\",\n          // Inline code styles\n          \"[&_.ProseMirror_code]:bg-muted\",\n          \"[&_.ProseMirror_code]:rounded\",\n          \"[&_.ProseMirror_code]:px-1.5\",\n          \"[&_.ProseMirror_code]:py-0.5\",\n          \"[&_.ProseMirror_code]:font-mono\",\n          \"[&_.ProseMirror_code]:text-[0.875em]\",\n          // Task list styles\n          \"[&_.ProseMirror_ul[data-type=taskList]]:list-none\",\n          \"[&_.ProseMirror_ul[data-type=taskList]]:pl-0\",\n          \"[&_.ProseMirror_ul[data-type=taskList]]:my-2\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li]:flex\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li]:items-start\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li]:gap-2\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li]:my-1\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li>label]:shrink-0\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li>label]:mt-0.5\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li>label>input[type=checkbox]]:cursor-pointer\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li>label>input[type=checkbox]]:size-4\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li>label>input[type=checkbox]]:accent-primary\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li>div]:flex-1\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li[data-checked=true]>div]:line-through\",\n          \"[&_.ProseMirror_ul[data-type=taskList]_li[data-checked=true]>div]:opacity-60\",\n          // Placeholder styles\n          EDITOR_PLACEHOLDER_CLASSES,\n          className\n        )}\n        {...props}\n      />\n    )\n  }\n)\nEditorContent.displayName = \"EditorContent\"\n\n// =============================================================================\n// EditorToolbar\n// =============================================================================\n\nexport interface EditorToolbarProps extends React.ComponentProps<\"div\"> {\n  orientation?: \"horizontal\" | \"vertical\"\n}\n\nconst EditorToolbar = React.forwardRef<HTMLDivElement, EditorToolbarProps>(\n  ({ className, orientation = \"horizontal\", children, ...props }, ref) => {\n    const { editor } = useEditor()\n\n    if (!editor) return null\n\n    return (\n      <div\n        ref={ref}\n        role=\"toolbar\"\n        aria-orientation={orientation}\n        className={cn(\n          \"flex items-center gap-1\",\n          orientation === \"vertical\" && \"flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n)\nEditorToolbar.displayName = \"EditorToolbar\"\n\n// =============================================================================\n// EditorButtonGroup\n// =============================================================================\n\nexport interface EditorButtonGroupProps extends React.ComponentProps<\"div\"> {}\n\nconst EditorButtonGroup = React.forwardRef<\n  HTMLDivElement,\n  EditorButtonGroupProps\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      className={cn(\"flex items-center gap-0.5\", className)}\n      {...props}\n    />\n  )\n})\nEditorButtonGroup.displayName = \"EditorButtonGroup\"\n\n// Alias\nconst EditorToolbarGroup = EditorButtonGroup\n\n// =============================================================================\n// EditorButton\n// =============================================================================\n\nexport interface EditorButtonProps extends React.ComponentProps<typeof Button> {\n  action: EditorAction\n  activeVariant?: \"default\" | \"secondary\" | \"outline\"\n}\n\nconst EditorButton = React.forwardRef<HTMLButtonElement, EditorButtonProps>(\n  (\n    { action, activeVariant = \"secondary\", className, children, ...props },\n    ref\n  ) => {\n    const { editor } = useEditor()\n\n    const isActive = React.useMemo(() => {\n      if (!editor) return false\n      if (EDITOR_TEXT_ALIGN_ACTIONS.includes(action)) {\n        return editor.isActive({ textAlign: action })\n      }\n      return editor.isActive(action)\n    }, [editor, action])\n\n    const canUse = React.useMemo(\n      () => canUseEditorAction(editor, action),\n      [editor, action]\n    )\n\n    const handleClick = () => {\n      executeEditorAction(editor, action)\n    }\n\n    const block = EDITOR_BLOCKS_MAP.get(action)\n\n    if (!editor) return null\n\n    return (\n      <Button\n        ref={ref}\n        type=\"button\"\n        variant={isActive ? activeVariant : \"ghost\"}\n        size=\"icon\"\n        disabled={!canUse}\n        onClick={handleClick}\n        aria-label={block?.label}\n        className={cn(\"size-8\", className)}\n        {...props}\n      >\n        {children}\n      </Button>\n    )\n  }\n)\nEditorButton.displayName = \"EditorButton\"\n\n// =============================================================================\n// EditorSeparator\n// =============================================================================\n\nexport interface EditorSeparatorProps extends React.ComponentProps<\"span\"> {}\n\nconst EditorSeparator = React.forwardRef<HTMLSpanElement, EditorSeparatorProps>(\n  ({ className, ...props }, ref) => {\n    const { editor } = useEditor()\n\n    if (!editor) return null\n\n    return (\n      <span\n        ref={ref}\n        className={cn(\"text-border mx-1 inline-flex items-center\", className)}\n        {...props}\n      >\n        |\n      </span>\n    )\n  }\n)\nEditorSeparator.displayName = \"EditorSeparator\"\n\n// =============================================================================\n// EditorDropdown Context\n// =============================================================================\n\ninterface EditorDropdownContextValue {\n  sharedBlocks: EditorBlock[]\n}\n\nconst EditorDropdownContext =\n  React.createContext<EditorDropdownContextValue | null>(null)\n\n// =============================================================================\n// EditorDropdown\n// =============================================================================\n\nexport interface EditorDropdownProps extends React.ComponentProps<\n  typeof DropdownMenu\n> {\n  actions: EditorAction[]\n}\n\nconst EditorDropdown = React.forwardRef<HTMLButtonElement, EditorDropdownProps>(\n  ({ actions, children, ...props }, _ref) => {\n    const { editor } = useEditor()\n\n    const handleChangeBlock = (key: EditorAction) => {\n      executeEditorAction(editor, key)\n    }\n\n    const filteredBlocks = actions\n      .map((action) => EDITOR_BLOCKS_MAP.get(action)!)\n      .filter(Boolean)\n\n    const contextValue = React.useMemo<EditorDropdownContextValue>(\n      () => ({ sharedBlocks: filteredBlocks }),\n      [filteredBlocks]\n    )\n\n    if (!editor) return null\n\n    return (\n      <EditorDropdownContext.Provider value={contextValue}>\n        <DropdownMenu {...props}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"shadow-none\"\n              aria-label=\"Open blocks menu\"\n            >\n              {children}\n              <ChevronDown className=\"text-muted-foreground ml-1 size-3\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent className=\"pb-2\">\n            <ScrollArea\n              style={{\n                height: Math.min(filteredBlocks.length * 56, 300),\n              }}\n              className=\"max-h-[300px] overflow-auto\"\n            >\n              {filteredBlocks.map((item) => (\n                <DropdownMenuItem\n                  key={item.label}\n                  onClick={() => handleChangeBlock(item.key)}\n                >\n                  <div\n                    className=\"border-border bg-background flex size-8 items-center justify-center rounded-lg border\"\n                    aria-hidden=\"true\"\n                  >\n                    <item.icon\n                      size={16}\n                      strokeWidth={2}\n                      className=\"opacity-60\"\n                    />\n                  </div>\n                  <div>\n                    <div className=\"text-sm font-medium\">{item.label}</div>\n                    <div className=\"text-muted-foreground text-xs\">\n                      {item.description}\n                    </div>\n                  </div>\n                </DropdownMenuItem>\n              ))}\n            </ScrollArea>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </EditorDropdownContext.Provider>\n    )\n  }\n)\nEditorDropdown.displayName = \"EditorDropdown\"\n\n// =============================================================================\n// EditorLabel\n// =============================================================================\n\nexport interface EditorLabelProps extends React.ComponentProps<\"span\"> {\n  action?: EditorAction\n  pattern?: \":icon :label\" | \":label\" | \":label :icon\" | \":icon\"\n}\n\nconst EditorLabel = React.forwardRef<HTMLSpanElement, EditorLabelProps>(\n  ({ className, action, pattern = \":label\", ...props }, ref) => {\n    const dropdownCtx = React.useContext(EditorDropdownContext)\n    const { editor } = useEditor()\n\n    const activeActions =\n      useEditorState({\n        editor,\n        selector: ({ editor: e }) => getActiveEditorActions(e),\n      }) ?? []\n\n    const blocks = React.useMemo(() => {\n      if (action) {\n        const block = EDITOR_BLOCKS_MAP.get(action)\n        return block ? [block] : []\n      }\n\n      const filteredActions = dropdownCtx?.sharedBlocks?.length\n        ? activeActions.filter((a) =>\n            dropdownCtx.sharedBlocks.some((b) => b.key === a)\n          )\n        : activeActions\n\n      return filteredActions\n        .map((key) => EDITOR_BLOCKS_MAP.get(key)!)\n        .filter(Boolean)\n    }, [action, activeActions, dropdownCtx])\n\n    const renderBlock = (block: EditorBlock) => {\n      switch (pattern) {\n        case \":icon :label\":\n          return (\n            <React.Fragment key={block.key}>\n              <block.icon className=\"size-4\" />\n              {block.label}\n            </React.Fragment>\n          )\n        case \":icon\":\n          return (\n            <React.Fragment key={block.key}>\n              <block.icon className=\"size-4\" />\n            </React.Fragment>\n          )\n        case \":label :icon\":\n          return (\n            <React.Fragment key={block.key}>\n              {block.label}\n              <block.icon className=\"size-4\" />\n            </React.Fragment>\n          )\n        default:\n          return block.label\n      }\n    }\n\n    const content =\n      blocks.length > 0\n        ? blocks.map(renderBlock)\n        : dropdownCtx?.sharedBlocks?.[0]\n          ? renderBlock(dropdownCtx.sharedBlocks[0])\n          : null\n\n    return (\n      <span\n        ref={ref}\n        className={cn(\"inline-flex items-center gap-2\", className)}\n        {...props}\n      >\n        {content}\n      </span>\n    )\n  }\n)\nEditorLabel.displayName = \"EditorLabel\"\n\n// =============================================================================\n// EditorFloatingMenu\n// =============================================================================\n\nexport interface EditorFloatingMenuProps extends Omit<\n  React.ComponentProps<typeof FloatingMenu>,\n  \"editor\"\n> {}\n\nfunction EditorFloatingMenu({ children, ...props }: EditorFloatingMenuProps) {\n  const { editor } = useEditor()\n\n  if (!editor) return null\n\n  return (\n    <FloatingMenu editor={editor} {...props}>\n      {children}\n    </FloatingMenu>\n  )\n}\n\n// =============================================================================\n// EditorBubbleMenuText\n// =============================================================================\n\nexport interface EditorBubbleMenuTextProps extends Omit<\n  React.ComponentProps<typeof BubbleMenu>,\n  \"editor\" | \"children\"\n> {}\n\nconst EditorBubbleMenuText = React.forwardRef<\n  HTMLDivElement,\n  EditorBubbleMenuTextProps\n>((props, ref) => {\n  const { editor } = useEditor()\n  const [linkUrl, setLinkUrl] = React.useState(\"\")\n  const [showLinkInput, setShowLinkInput] = React.useState(false)\n\n  if (!editor) return null\n\n  const handleSetLink = () => {\n    if (linkUrl) {\n      editor\n        .chain()\n        .focus()\n        .extendMarkRange(\"link\")\n        .setLink({ href: linkUrl })\n        .run()\n      setLinkUrl(\"\")\n      setShowLinkInput(false)\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault()\n      handleSetLink()\n    }\n    if (e.key === \"Escape\") {\n      setShowLinkInput(false)\n      setLinkUrl(\"\")\n    }\n  }\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"top\",\n      }}\n      shouldShow={({ editor: e, from, to }) => {\n        if (from === to) return false\n        if (e.isActive(\"table\")) return false\n        if (e.isActive(\"codeBlock\")) return false\n        if (e.isActive(\"image\")) return false\n        return true\n      }}\n      className=\"w-fit\"\n    >\n      <div\n        ref={ref}\n        className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\"\n      >\n        {showLinkInput ? (\n          <div className=\"flex items-center gap-1 p-1\">\n            <Input\n              type=\"url\"\n              placeholder=\"https://...\"\n              value={linkUrl}\n              onChange={(e) => setLinkUrl(e.target.value)}\n              onKeyDown={handleKeyDown}\n              className=\"h-7 w-48 text-xs\"\n              autoFocus\n            />\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={handleSetLink}\n            >\n              <Check className=\"size-3.5\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => {\n                setShowLinkInput(false)\n                setLinkUrl(\"\")\n              }}\n            >\n              <Link2Off className=\"size-3.5\" />\n            </Button>\n          </div>\n        ) : (\n          <>\n            <Button\n              variant={editor.isActive(\"bold\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleBold().run()}\n              title=\"Bold\"\n            >\n              <Bold className=\"size-3.5\" />\n            </Button>\n            <Button\n              variant={editor.isActive(\"italic\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleItalic().run()}\n              title=\"Italic\"\n            >\n              <Italic className=\"size-3.5\" />\n            </Button>\n            <Button\n              variant={editor.isActive(\"underline\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleUnderline().run()}\n              title=\"Underline\"\n            >\n              <Underline className=\"size-3.5\" />\n            </Button>\n            <Button\n              variant={editor.isActive(\"strike\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleStrike().run()}\n              title=\"Strikethrough\"\n            >\n              <Strikethrough className=\"size-3.5\" />\n            </Button>\n            <Button\n              variant={editor.isActive(\"code\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleCode().run()}\n              title=\"Code\"\n            >\n              <Code className=\"size-3.5\" />\n            </Button>\n\n            <div className=\"bg-border h-4 w-px\" />\n\n            <Button\n              variant={editor.isActive(\"highlight\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleHighlight().run()}\n              title=\"Highlight\"\n            >\n              <Highlighter className=\"size-3.5\" />\n            </Button>\n\n            <div className=\"bg-border h-4 w-px\" />\n\n            {editor.isActive(\"link\") ? (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 w-7 p-0\"\n                onClick={() => editor.chain().focus().unsetLink().run()}\n                title=\"Remove Link\"\n              >\n                <Link2Off className=\"size-3.5\" />\n              </Button>\n            ) : (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 w-7 p-0\"\n                onClick={() => setShowLinkInput(true)}\n                title=\"Add Link\"\n              >\n                <Link2 className=\"size-3.5\" />\n              </Button>\n            )}\n          </>\n        )}\n      </div>\n    </BubbleMenu>\n  )\n})\nEditorBubbleMenuText.displayName = \"EditorBubbleMenuText\"\n\n// =============================================================================\n// Hooks\n// =============================================================================\n\nexport function useEditorIsActive(action: EditorAction): boolean {\n  const { editor } = useEditor()\n\n  return React.useMemo(() => {\n    if (!editor) return false\n    if (EDITOR_TEXT_ALIGN_ACTIONS.includes(action)) {\n      return editor.isActive({ textAlign: action })\n    }\n    return editor.isActive(action)\n  }, [editor, action])\n}\n\nexport function useEditorCurrentActions(): EditorAction[] {\n  const { editor } = useEditor()\n  return React.useMemo(() => getActiveEditorActions(editor), [editor])\n}\n\nexport function toLatentArray<T>(...inputs: NestedArray<T>[]): T[] {\n  const out: T[] = []\n\n  // Stack holds items to process. We push in reverse so we can pop and keep order.\n  const stack: NestedArray<T>[] = []\n  for (let i = inputs.length - 1; i >= 0; i--) stack.push(inputs[i])\n\n  while (stack.length) {\n    const cur = stack.pop() as NestedArray<T>\n\n    if (Array.isArray(cur)) {\n      // Push children in reverse to preserve original order.\n      for (let i = cur.length - 1; i >= 0; i--) {\n        stack.push(cur[i] as NestedArray<T>)\n      }\n    } else {\n      out.push(cur)\n    }\n  }\n\n  return out\n}\n\n// =============================================================================\n// Exports\n// =============================================================================\n\nexport {\n  EditorBubbleMenuLink,\n  EditorBubbleMenuText,\n  EditorButton,\n  EditorButtonGroup,\n  EditorContent,\n  EditorDropdown,\n  EditorFloatingMenu,\n  EditorLabel,\n  EditorProvider,\n  EditorSeparator,\n  EditorToolbar,\n  EditorToolbarGroup,\n}\n",
      "type": "registry:ui"
    },
    {
      "path": "src/registry/editor/editor-image.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Node, mergeAttributes } from \"@tiptap/core\"\nimport {\n  BubbleMenu,\n  NodeViewWrapper,\n  ReactNodeViewRenderer,\n} from \"@tiptap/react\"\nimport { EditorContext, type EditorContextValue } from \"./editor\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { DropdownMenuContent as DropdownMenuContentPrimitive } from \"@radix-ui/react-dropdown-menu\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { cn } from \"@/lib/utils\"\nimport {\n  AlertCircle,\n  AlignCenter,\n  AlignLeft,\n  AlignRight,\n  Check,\n  ChevronDown,\n  ImageUp,\n  Link2,\n  Loader2,\n  Lock,\n  LockOpen,\n  MessageSquare,\n  Trash2,\n  Upload,\n  X,\n} from \"lucide-react\"\n\n// =============================================================================\n// Types & Configuration\n// =============================================================================\n\nexport type EditorImageUploadStrategy = \"base64\" | \"server\" | \"url\"\nexport type EditorImageAlignment = \"left\" | \"center\" | \"right\"\nexport type EditorImageObjectFit =\n  | \"contain\"\n  | \"cover\"\n  | \"fill\"\n  | \"none\"\n  | \"scale-down\"\n\nexport interface EditorImageConfig {\n  uploadStrategy?: EditorImageUploadStrategy\n  onUpload?: (file: File) => Promise<string>\n  maxFileSize?: number\n  acceptedTypes?: string[]\n  onError?: (error: Error) => void\n}\n\nconst DEFAULT_CONFIG: Required<\n  Omit<EditorImageConfig, \"onUpload\" | \"onError\">\n> = {\n  uploadStrategy: \"base64\",\n  maxFileSize: 5 * 1024 * 1024, // 5MB\n  acceptedTypes: [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"],\n}\n\n// =============================================================================\n// Context\n// =============================================================================\n\ninterface EditorImageContextType extends EditorImageConfig {\n  isUploading: boolean\n  setIsUploading: (value: boolean) => void\n  error: string | null\n  setError: (value: string | null) => void\n}\n\nconst EditorImageContext = React.createContext<EditorImageContextType | null>(\n  null\n)\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`\n}\n\nasync function convertToBase64(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(reader.result as string)\n    reader.onerror = reject\n    reader.readAsDataURL(file)\n  })\n}\n\nfunction validateFile(\n  file: File,\n  config: Pick<EditorImageConfig, \"maxFileSize\" | \"acceptedTypes\">\n): string | null {\n  const maxSize = config.maxFileSize ?? DEFAULT_CONFIG.maxFileSize\n  const acceptedTypes = config.acceptedTypes ?? DEFAULT_CONFIG.acceptedTypes\n\n  if (!acceptedTypes.includes(file.type)) {\n    return `Invalid file type. Accepted: ${acceptedTypes.map((t) => t.split(\"/\")[1]).join(\", \")}`\n  }\n\n  if (file.size > maxSize) {\n    return `File too large. Maximum size: ${formatFileSize(maxSize)}`\n  }\n\n  return null\n}\n\n// =============================================================================\n// EditorImagePlaceholder - Upload UI shown when src is empty\n// =============================================================================\n\ninterface EditorImagePlaceholderProps {\n  onImageReady: (src: string, alt?: string) => void\n  config: EditorImageConfig\n}\n\nexport function EditorImagePlaceholder({\n  onImageReady,\n  config,\n}: EditorImagePlaceholderProps) {\n  const [isUploading, setIsUploading] = React.useState(false)\n  const [error, setError] = React.useState<string | null>(null)\n  const [activeTab, setActiveTab] = React.useState<string>(\"upload\")\n\n  const contextValue: EditorImageContextType = {\n    ...config,\n    isUploading,\n    setIsUploading,\n    error,\n    setError,\n  }\n\n  const handleUpload = React.useCallback(\n    async (file: File) => {\n      setError(null)\n\n      const validationError = validateFile(file, config)\n      if (validationError) {\n        setError(validationError)\n        return\n      }\n\n      setIsUploading(true)\n\n      try {\n        let src: string\n\n        const strategy = config.uploadStrategy ?? DEFAULT_CONFIG.uploadStrategy\n\n        if (strategy === \"server\" && config.onUpload) {\n          src = await config.onUpload(file)\n        } else {\n          src = await convertToBase64(file)\n        }\n\n        onImageReady(src, file.name)\n      } catch (err) {\n        const message = err instanceof Error ? err.message : \"Upload failed\"\n        setError(message)\n        config.onError?.(err instanceof Error ? err : new Error(message))\n      } finally {\n        setIsUploading(false)\n      }\n    },\n    [config, onImageReady]\n  )\n\n  const handleUrlSubmit = React.useCallback(\n    (url: string) => {\n      if (!url.trim()) {\n        setError(\"Please enter a valid URL\")\n        return\n      }\n\n      try {\n        new URL(url)\n        onImageReady(url)\n      } catch {\n        setError(\"Please enter a valid URL\")\n      }\n    },\n    [onImageReady]\n  )\n\n  return (\n    <EditorImageContext.Provider value={contextValue}>\n      <div className=\"border-border bg-muted/30 my-4 rounded-lg border\">\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"ml-2 mt-2\">\n            <TabsTrigger value=\"upload\">\n              <Upload className=\"mr-2 size-4\" />\n              Upload\n            </TabsTrigger>\n            <TabsTrigger value=\"embed\">\n              <Link2 className=\"mr-2 size-4\" />\n              Embed link\n            </TabsTrigger>\n          </TabsList>\n\n          <div className=\"p-4\">\n            {error && (\n              <div className=\"bg-destructive/10 text-destructive mb-4 flex items-center gap-2 rounded-md p-3 text-sm\">\n                <AlertCircle className=\"size-4 shrink-0\" />\n                <span>{error}</span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"ml-auto h-6 w-6 p-0\"\n                  onClick={() => setError(null)}\n                >\n                  <X className=\"size-3\" />\n                </Button>\n              </div>\n            )}\n\n            <TabsContent value=\"upload\" className=\"mt-0\">\n              <EditorImageUploadZone\n                onUpload={handleUpload}\n                disabled={isUploading}\n              />\n              <p className=\"text-muted-foreground mt-3 text-center text-xs\">\n                Maximum file size:{\" \"}\n                {formatFileSize(\n                  config.maxFileSize ?? DEFAULT_CONFIG.maxFileSize\n                )}\n              </p>\n            </TabsContent>\n\n            <TabsContent value=\"embed\" className=\"mt-0\">\n              <EditorImageUrlInput\n                onSubmit={handleUrlSubmit}\n                disabled={isUploading}\n              />\n            </TabsContent>\n          </div>\n        </Tabs>\n      </div>\n    </EditorImageContext.Provider>\n  )\n}\n\n// =============================================================================\n// EditorImageUploadZone - Drag & drop file upload\n// =============================================================================\n\ninterface EditorImageUploadZoneProps {\n  onUpload: (file: File) => void\n  disabled?: boolean\n}\n\nexport function EditorImageUploadZone({\n  onUpload,\n  disabled,\n}: EditorImageUploadZoneProps) {\n  const [isDragOver, setIsDragOver] = React.useState(false)\n  const inputRef = React.useRef<HTMLInputElement>(null)\n  const ctx = React.useContext(EditorImageContext)\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (!disabled) setIsDragOver(true)\n  }\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n  }\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n\n    if (disabled) return\n\n    const file = e.dataTransfer.files[0]\n    if (file) onUpload(file)\n  }\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (file) onUpload(file)\n    if (inputRef.current) inputRef.current.value = \"\"\n  }\n\n  return (\n    <div\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n      className={cn(\n        \"flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 transition-colors\",\n        isDragOver\n          ? \"border-primary bg-primary/5\"\n          : \"border-muted-foreground/25 hover:border-muted-foreground/50\",\n        disabled && \"pointer-events-none opacity-50\"\n      )}\n    >\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n        disabled={disabled}\n      />\n\n      {ctx?.isUploading ? (\n        <>\n          <Loader2 className=\"text-muted-foreground size-8 animate-spin\" />\n          <p className=\"text-muted-foreground mt-2 text-sm\">Uploading...</p>\n        </>\n      ) : (\n        <>\n          <ImageUp className=\"text-muted-foreground size-8\" />\n          <Button\n            variant=\"outline\"\n            className=\"mt-4\"\n            onClick={() => inputRef.current?.click()}\n            disabled={disabled}\n          >\n            Upload file\n          </Button>\n          <p className=\"text-muted-foreground mt-2 text-sm\">\n            or drag and drop an image here\n          </p>\n        </>\n      )}\n    </div>\n  )\n}\n\n// =============================================================================\n// EditorImageUrlInput - External URL input\n// =============================================================================\n\ninterface EditorImageUrlInputProps {\n  onSubmit: (url: string) => void\n  disabled?: boolean\n}\n\nexport function EditorImageUrlInput({\n  onSubmit,\n  disabled,\n}: EditorImageUrlInputProps) {\n  const [url, setUrl] = React.useState(\"\")\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    onSubmit(url)\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault()\n      onSubmit(url)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"flex gap-2\">\n      <Input\n        type=\"url\"\n        placeholder=\"Paste image URL...\"\n        value={url}\n        onChange={(e) => setUrl(e.target.value)}\n        onKeyDown={handleKeyDown}\n        disabled={disabled}\n        className=\"flex-1\"\n      />\n      <Button type=\"submit\" disabled={disabled || !url.trim()}>\n        Embed\n      </Button>\n    </form>\n  )\n}\n\n// =============================================================================\n// Resize Handle Component\n// =============================================================================\n\ntype ResizeDirection = \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\"\n\ninterface ResizeHandleProps {\n  direction: ResizeDirection\n  onResizeStart: (e: React.MouseEvent, direction: ResizeDirection) => void\n}\n\nfunction ResizeHandle({ direction, onResizeStart }: ResizeHandleProps) {\n  const positionClasses: Record<ResizeDirection, string> = {\n    \"top-left\": \"-left-1.5 -top-1.5 cursor-nwse-resize\",\n    \"top-right\": \"-right-1.5 -top-1.5 cursor-nesw-resize\",\n    \"bottom-left\": \"-bottom-1.5 -left-1.5 cursor-nesw-resize\",\n    \"bottom-right\": \"-bottom-1.5 -right-1.5 cursor-nwse-resize\",\n  }\n\n  return (\n    <div\n      className={cn(\n        \"border-primary bg-background absolute size-3 border-2 transition-transform hover:scale-125\",\n        positionClasses[direction]\n      )}\n      onMouseDown={(e) => onResizeStart(e, direction)}\n    />\n  )\n}\n\n// =============================================================================\n// EditorImageBlock - Rendered image with styling\n// =============================================================================\n\ninterface EditorImageBlockProps extends React.ComponentProps<\"img\"> {\n  selected?: boolean\n  imageWidth?: number | string | null\n  imageHeight?: number | string | null\n  objectFit?: EditorImageObjectFit | null\n}\n\nexport const EditorImageBlock = React.forwardRef<\n  HTMLImageElement,\n  EditorImageBlockProps\n>(\n  (\n    {\n      className,\n      selected,\n      imageWidth,\n      imageHeight,\n      objectFit,\n      style,\n      ...props\n    },\n    ref\n  ) => {\n    return (\n      <img\n        ref={ref}\n        {...props}\n        className={cn(\n          \"max-w-full\",\n          selected && \"ring-primary ring-1 ring-offset-1\",\n          className\n        )}\n        style={{\n          margin: 0,\n          ...style,\n          width: imageWidth\n            ? typeof imageWidth === \"string\" && imageWidth.includes(\"%\")\n              ? imageWidth\n              : `${imageWidth}px`\n            : undefined,\n          height: imageHeight\n            ? typeof imageHeight === \"string\" && imageHeight.includes(\"%\")\n              ? imageHeight\n              : `${imageHeight}px`\n            : undefined,\n          objectFit: objectFit ?? undefined,\n        }}\n      />\n    )\n  }\n)\nEditorImageBlock.displayName = \"EditorImageBlock\"\n\n// =============================================================================\n// ImageNodeView - Main NodeView component\n// =============================================================================\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction ImageNodeView(props: any) {\n  const { node, updateAttributes, selected, extension } = props\n\n  const nodeAttrs = node.attrs as {\n    src: string | null\n    alt: string | null\n    title: string | null\n    width: number | string | null\n    height: number | string | null\n    alignment: EditorImageAlignment\n    caption: string | null\n    objectFit: EditorImageObjectFit\n    lockAspectRatio: boolean\n  }\n\n  const hasSrc = !!nodeAttrs.src\n  const imageRef = React.useRef<HTMLImageElement>(null)\n  const containerRef = React.useRef<HTMLDivElement>(null)\n\n  const [isResizing, setIsResizing] = React.useState(false)\n  const [resizeDirection, setResizeDirection] =\n    React.useState<ResizeDirection | null>(null)\n  const [initialSize, setInitialSize] = React.useState({ width: 0, height: 0 })\n  const [initialMousePos, setInitialMousePos] = React.useState({ x: 0, y: 0 })\n  const [currentSize, setCurrentSize] = React.useState<{\n    width: number\n    height: number\n  } | null>(null)\n\n  const handleImageReady = (src: string, alt?: string) => {\n    updateAttributes({ src, alt: alt ?? nodeAttrs.alt })\n  }\n\n  const handleResizeStart = React.useCallback(\n    (e: React.MouseEvent, direction: ResizeDirection) => {\n      e.preventDefault()\n      e.stopPropagation()\n\n      if (!imageRef.current) return\n\n      const rect = imageRef.current.getBoundingClientRect()\n      setIsResizing(true)\n      setResizeDirection(direction)\n      setInitialSize({\n        width: rect.width,\n        height: rect.height,\n      })\n      setInitialMousePos({ x: e.clientX, y: e.clientY })\n      setCurrentSize({ width: rect.width, height: rect.height })\n    },\n    []\n  )\n\n  React.useEffect(() => {\n    if (!isResizing) return\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!resizeDirection) return\n\n      const deltaX = e.clientX - initialMousePos.x\n      const deltaY = e.clientY - initialMousePos.y\n\n      let newWidth = initialSize.width\n      let newHeight = initialSize.height\n\n      if (resizeDirection.includes(\"right\")) newWidth += deltaX\n      if (resizeDirection.includes(\"left\")) newWidth -= deltaX\n      if (resizeDirection.includes(\"bottom\")) newHeight += deltaY\n      if (resizeDirection.includes(\"top\")) newHeight -= deltaY\n\n      const shouldLockRatio = e.shiftKey || nodeAttrs.lockAspectRatio\n      if (shouldLockRatio && initialSize.width > 0 && initialSize.height > 0) {\n        const aspectRatio = initialSize.width / initialSize.height\n        const containerMaxWidth =\n          containerRef.current?.parentElement?.clientWidth ?? Infinity\n\n        if (Math.abs(deltaX) > Math.abs(deltaY)) {\n          newWidth = Math.min(newWidth, containerMaxWidth)\n          newHeight = newWidth / aspectRatio\n        } else {\n          newWidth = newHeight * aspectRatio\n          if (newWidth > containerMaxWidth) {\n            newWidth = containerMaxWidth\n            newHeight = newWidth / aspectRatio\n          }\n        }\n      }\n\n      newWidth = Math.max(50, newWidth)\n      newHeight = Math.max(50, newHeight)\n\n      setCurrentSize({\n        width: Math.round(newWidth),\n        height: Math.round(newHeight),\n      })\n    }\n\n    const handleMouseUp = () => {\n      if (currentSize) {\n        updateAttributes({\n          width: currentSize.width,\n          height: currentSize.height,\n        })\n      }\n      setIsResizing(false)\n      setResizeDirection(null)\n      setCurrentSize(null)\n    }\n\n    document.addEventListener(\"mousemove\", handleMouseMove)\n    document.addEventListener(\"mouseup\", handleMouseUp)\n\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove)\n      document.removeEventListener(\"mouseup\", handleMouseUp)\n    }\n  }, [\n    isResizing,\n    resizeDirection,\n    initialMousePos,\n    initialSize,\n    currentSize,\n    updateAttributes,\n    nodeAttrs.lockAspectRatio,\n  ])\n\n  const displayWidth = currentSize?.width ?? nodeAttrs.width\n  const displayHeight = currentSize?.height ?? nodeAttrs.height\n\n  const alignmentClasses: Record<EditorImageAlignment, string> = {\n    left: \"items-start\",\n    center: \"items-center\",\n    right: \"items-end\",\n  }\n\n  return (\n    <NodeViewWrapper\n      data-type=\"image\"\n      data-src={nodeAttrs.src ?? undefined}\n      data-alt={nodeAttrs.alt ?? undefined}\n      data-title={nodeAttrs.title ?? undefined}\n      data-alignment={nodeAttrs.alignment}\n    >\n      {hasSrc ? (\n        <figure\n          className={cn(\n            \"my-4 flex w-full flex-col\",\n            alignmentClasses[nodeAttrs.alignment]\n          )}\n        >\n          <div\n            ref={containerRef}\n            className={cn(\n              \"group relative inline-block\",\n              isResizing && \"select-none\"\n            )}\n          >\n            <EditorImageBlock\n              ref={imageRef}\n              src={nodeAttrs.src!}\n              alt={nodeAttrs.alt ?? undefined}\n              title={nodeAttrs.title ?? undefined}\n              selected={selected}\n              imageWidth={displayWidth}\n              imageHeight={displayHeight}\n              objectFit={nodeAttrs.objectFit}\n              draggable={!isResizing}\n            />\n            {selected && (\n              <>\n                <ResizeHandle\n                  direction=\"top-left\"\n                  onResizeStart={handleResizeStart}\n                />\n                <ResizeHandle\n                  direction=\"top-right\"\n                  onResizeStart={handleResizeStart}\n                />\n                <ResizeHandle\n                  direction=\"bottom-left\"\n                  onResizeStart={handleResizeStart}\n                />\n                <ResizeHandle\n                  direction=\"bottom-right\"\n                  onResizeStart={handleResizeStart}\n                />\n              </>\n            )}\n            {isResizing && currentSize && (\n              <div className=\"absolute bottom-2 left-2 rounded bg-black/70 px-2 py-1 text-xs text-white\">\n                {currentSize.width}  {currentSize.height}\n              </div>\n            )}\n          </div>\n          {nodeAttrs.caption && (\n            <figcaption className=\"text-muted-foreground mt-2 text-center text-sm\">\n              {nodeAttrs.caption}\n            </figcaption>\n          )}\n        </figure>\n      ) : (\n        <EditorImagePlaceholder\n          onImageReady={handleImageReady}\n          config={extension.options}\n        />\n      )}\n    </NodeViewWrapper>\n  )\n}\n\n// =============================================================================\n// EditorImageExtension\n// =============================================================================\n\nexport interface EditorImageOptions extends EditorImageConfig {\n  inline: boolean\n  HTMLAttributes: Record<string, unknown>\n}\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    editorImage: {\n      setImage: (options: {\n        src?: string | null\n        alt?: string\n        title?: string\n      }) => ReturnType\n    }\n  }\n}\n\nexport const EditorImageExtension = Node.create<EditorImageOptions>({\n  name: \"image\",\n\n  addOptions() {\n    return {\n      inline: false,\n      uploadStrategy: \"base64\",\n      maxFileSize: 5 * 1024 * 1024,\n      acceptedTypes: [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"],\n      HTMLAttributes: {\n        class: \"rounded-lg border object-contain\",\n      },\n    }\n  },\n\n  inline() {\n    return this.options.inline\n  },\n\n  group() {\n    return this.options.inline ? \"inline\" : \"block\"\n  },\n\n  draggable: true,\n  atom: false,\n\n  addAttributes() {\n    return {\n      src: {\n        default: null,\n        parseHTML: (el) => (el as HTMLImageElement).getAttribute(\"src\"),\n        renderHTML: (attrs) => (attrs.src ? { src: attrs.src } : {}),\n      },\n      alt: {\n        default: null,\n        parseHTML: (el) => (el as HTMLImageElement).getAttribute(\"alt\"),\n        renderHTML: (attrs) => (attrs.alt ? { alt: attrs.alt } : {}),\n      },\n      title: {\n        default: null,\n        parseHTML: (el) => (el as HTMLImageElement).getAttribute(\"title\"),\n        renderHTML: (attrs) => (attrs.title ? { title: attrs.title } : {}),\n      },\n      width: {\n        default: null,\n        parseHTML: (el) => {\n          const width = (el as HTMLImageElement).getAttribute(\"width\")\n          if (!width) return null\n          return width.includes(\"%\") ? width : parseInt(width, 10)\n        },\n        renderHTML: (attrs) => (attrs.width ? { width: attrs.width } : {}),\n      },\n      height: {\n        default: null,\n        parseHTML: (el) => {\n          const height = (el as HTMLImageElement).getAttribute(\"height\")\n          if (!height) return null\n          return height.includes(\"%\") ? height : parseInt(height, 10)\n        },\n        renderHTML: (attrs) => (attrs.height ? { height: attrs.height } : {}),\n      },\n      alignment: {\n        default: \"left\" as EditorImageAlignment,\n        parseHTML: (el) =>\n          (el as HTMLElement).getAttribute(\"data-alignment\") ?? \"left\",\n        renderHTML: (attrs) => ({ \"data-alignment\": attrs.alignment }),\n      },\n      caption: {\n        default: null,\n        parseHTML: (el) => (el as HTMLElement).getAttribute(\"data-caption\"),\n        renderHTML: (attrs) =>\n          attrs.caption ? { \"data-caption\": attrs.caption } : {},\n      },\n      objectFit: {\n        default: \"contain\" as EditorImageObjectFit,\n        parseHTML: (el) =>\n          (el as HTMLElement).getAttribute(\"data-object-fit\") ?? \"contain\",\n        renderHTML: (attrs) => ({ \"data-object-fit\": attrs.objectFit }),\n      },\n      lockAspectRatio: {\n        default: true,\n        parseHTML: (el) =>\n          (el as HTMLElement).getAttribute(\"data-lock-aspect-ratio\") !==\n          \"false\",\n        renderHTML: (attrs) => ({\n          \"data-lock-aspect-ratio\": String(attrs.lockAspectRatio),\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [{ tag: \"img[src]\" }, { tag: \"img\" }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      \"img\",\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes),\n    ]\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(ImageNodeView)\n  },\n\n  addCommands() {\n    return {\n      setImage:\n        (options) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: options,\n          })\n        },\n    }\n  },\n})\n\n// =============================================================================\n// EditorBubbleMenuImage\n// =============================================================================\n\nconst OBJECT_FIT_OPTIONS: { value: EditorImageObjectFit; label: string }[] = [\n  { value: \"contain\", label: \"Contain\" },\n  { value: \"cover\", label: \"Cover\" },\n  { value: \"fill\", label: \"Fill\" },\n  { value: \"none\", label: \"None\" },\n  { value: \"scale-down\", label: \"Scale Down\" },\n]\n\nexport function EditorBubbleMenuImage() {\n  const ctx = React.useContext(EditorContext)\n  const editor = ctx?.editor\n  const [captionOpen, setCaptionOpen] = React.useState(false)\n  const [captionValue, setCaptionValue] = React.useState(\"\")\n  const widthInputRef = React.useRef<HTMLInputElement>(null)\n  const heightInputRef = React.useRef<HTMLInputElement>(null)\n  const [forceUpdate, setForceUpdate] = React.useState(0)\n\n  const isImageActive = editor?.isActive(\"image\") ?? false\n\n  // Subscribe to editor transaction updates to sync dimensions\n  React.useEffect(() => {\n    if (!editor) return\n\n    const handleUpdate = () => {\n      if (editor.isActive(\"image\")) {\n        setForceUpdate((prev) => prev + 1)\n      }\n    }\n\n    editor.on(\"transaction\", handleUpdate)\n    editor.on(\"selectionUpdate\", handleUpdate)\n\n    return () => {\n      editor.off(\"transaction\", handleUpdate)\n      editor.off(\"selectionUpdate\", handleUpdate)\n    }\n  }, [editor])\n\n  const getDefaultDimensions = React.useCallback(() => {\n    if (!editor || !isImageActive) return { width: \"\", height: \"\" }\n\n    const attrs = editor.getAttributes(\"image\")\n\n    if (attrs.width && attrs.height) {\n      return {\n        width: attrs.width.toString(),\n        height: attrs.height.toString(),\n      }\n    }\n\n    const { node } = editor.state.selection as { node?: { type?: { name?: string }, attrs?: { src?: string } } }\n    if (node?.type?.name === \"image\" && node.attrs?.src) {\n      const imageElement = editor.view.dom.querySelector(\n        `img[src=\"${node.attrs.src}\"]`\n      ) as HTMLImageElement | null\n\n      if (imageElement?.complete && imageElement.naturalWidth > 0) {\n        const rect = imageElement.getBoundingClientRect()\n        return {\n          width: Math.round(rect.width).toString(),\n          height: Math.round(rect.height).toString(),\n        }\n      }\n    }\n\n    return { width: \"\", height: \"\" }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [editor, isImageActive, forceUpdate])\n\n  const defaultDimensions = getDefaultDimensions()\n\n  if (!editor) return null\n\n  const getImageAttrs = () => {\n    if (!isImageActive) return null\n    return editor.getAttributes(\"image\") as {\n      src: string | null\n      alt: string | null\n      width: number | string | null\n      height: number | string | null\n      alignment: EditorImageAlignment\n      caption: string | null\n      objectFit: EditorImageObjectFit\n      lockAspectRatio: boolean\n    }\n  }\n\n  const attrs = getImageAttrs()\n  const isConstrained = attrs?.lockAspectRatio ?? true\n\n  const handleToggleLockAspectRatio = () => {\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"image\", { lockAspectRatio: !isConstrained })\n      .run()\n  }\n\n  const parseValue = (\n    value: string\n  ): { numericValue: number; isPercentage: boolean } | null => {\n    const trimmed = value.trim()\n    if (!trimmed) return null\n\n    const isPercentage = trimmed.endsWith(\"%\")\n    const numStr = isPercentage ? trimmed.slice(0, -1) : trimmed\n    const numValue = parseFloat(numStr)\n\n    if (isNaN(numValue) || numValue <= 0) return null\n    if (isPercentage && numValue > 100) return null\n\n    return { numericValue: numValue, isPercentage }\n  }\n\n  const formatValue = (\n    numericValue: number,\n    isPercentage: boolean\n  ): string | number => {\n    return isPercentage ? `${numericValue}%` : Math.round(numericValue)\n  }\n\n  const applyWidth = (value: string) => {\n    const parsed = parseValue(value)\n    if (!parsed) return\n\n    const { numericValue, isPercentage } = parsed\n    const formattedValue = formatValue(numericValue, isPercentage)\n\n    if (\n      isConstrained &&\n      defaultDimensions.width &&\n      defaultDimensions.height &&\n      !isPercentage\n    ) {\n      const currentWidth = parseFloat(defaultDimensions.width)\n      const currentHeight = parseFloat(defaultDimensions.height)\n      if (currentWidth > 0 && currentHeight > 0) {\n        const aspectRatio = currentHeight / currentWidth\n        const newHeight = Math.round(numericValue * aspectRatio)\n        editor\n          .chain()\n          .focus()\n          .updateAttributes(\"image\", {\n            width: formattedValue,\n            height: newHeight,\n          })\n          .run()\n        return\n      }\n    }\n\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"image\", { width: formattedValue })\n      .run()\n  }\n\n  const applyHeight = (value: string) => {\n    const parsed = parseValue(value)\n    if (!parsed) return\n\n    const { numericValue, isPercentage } = parsed\n    const formattedValue = formatValue(numericValue, isPercentage)\n\n    if (\n      isConstrained &&\n      defaultDimensions.width &&\n      defaultDimensions.height &&\n      !isPercentage\n    ) {\n      const currentWidth = parseFloat(defaultDimensions.width)\n      const currentHeight = parseFloat(defaultDimensions.height)\n      if (currentWidth > 0 && currentHeight > 0) {\n        const aspectRatio = currentWidth / currentHeight\n        const newWidth = Math.round(numericValue * aspectRatio)\n        editor\n          .chain()\n          .focus()\n          .updateAttributes(\"image\", {\n            width: newWidth,\n            height: formattedValue,\n          })\n          .run()\n        return\n      }\n    }\n\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"image\", { height: formattedValue })\n      .run()\n  }\n\n  const handleWidthBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    applyWidth(e.target.value)\n  }\n\n  const handleHeightBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    applyHeight(e.target.value)\n  }\n\n  const handleWidthKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault()\n      applyWidth(e.currentTarget.value)\n    }\n  }\n\n  const handleHeightKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault()\n      applyHeight(e.currentTarget.value)\n    }\n  }\n\n  const handleAlignmentChange = (alignment: EditorImageAlignment) => {\n    editor.chain().focus().updateAttributes(\"image\", { alignment }).run()\n  }\n\n  const handleObjectFitChange = (objectFit: EditorImageObjectFit) => {\n    editor.chain().focus().updateAttributes(\"image\", { objectFit }).run()\n  }\n\n  const handleCaptionSave = () => {\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"image\", { caption: captionValue || null })\n      .run()\n    setCaptionOpen(false)\n  }\n\n  const handleCaptionOpen = () => {\n    const attrs = getImageAttrs()\n    setCaptionValue(attrs?.caption ?? \"\")\n    setCaptionOpen(true)\n  }\n\n  const handleDelete = () => {\n    editor.chain().focus().deleteSelection().run()\n  }\n\n  return (\n    <BubbleMenu\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"bottom\",\n        offset: [0, 8],\n        getReferenceClientRect: () => {\n          const { state, view } = editor\n          const { selection } = state\n\n          const { node } = selection as { node?: { type?: { name?: string }, attrs?: { src?: string } } }\n          if (node?.type?.name === \"image\" && node.attrs?.src) {\n            const imageElement = view.dom.querySelector(\n              `[data-type=\"image\"][data-src=\"${node.attrs.src}\"] img`\n            ) as HTMLImageElement | null\n\n            if (imageElement) {\n              return imageElement.getBoundingClientRect()\n            }\n          }\n\n          const selectedImageWrapper = view.dom.querySelector(\n            '[data-type=\"image\"] .ring-primary'\n          )?.closest('[data-type=\"image\"]') as HTMLElement | null\n\n          if (selectedImageWrapper) {\n            const img = selectedImageWrapper.querySelector(\"img\")\n            if (img) {\n              return img.getBoundingClientRect()\n            }\n          }\n\n          const { from, to } = selection\n          const start = view.coordsAtPos(from)\n          const end = view.coordsAtPos(to)\n\n          return new DOMRect(\n            start.left,\n            start.top,\n            end.right - start.left,\n            end.bottom - start.top\n          )\n        },\n      }}\n      shouldShow={({ editor: e }) => e.isActive(\"image\")}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-1 rounded-md border p-1 shadow-md\">\n        {/* Size Controls */}\n        <div className=\"flex items-center gap-1\">\n          <Input\n            ref={widthInputRef}\n            key={`width-${defaultDimensions.width}-${isConstrained}`}\n            type=\"text\"\n            placeholder=\"W\"\n            defaultValue={defaultDimensions.width}\n            onBlur={handleWidthBlur}\n            onKeyDown={handleWidthKeyDown}\n            className=\"h-7 w-16 text-xs\"\n          />\n          <Button\n            variant={isConstrained ? \"secondary\" : \"ghost\"}\n            size=\"sm\"\n            className=\"h-7 w-7 p-0\"\n            onClick={handleToggleLockAspectRatio}\n            title={isConstrained ? \"Unlock aspect ratio\" : \"Lock aspect ratio\"}\n          >\n            {isConstrained ? (\n              <Lock className=\"size-2\" />\n            ) : (\n              <LockOpen className=\"size-2\" />\n            )}\n          </Button>\n          <Input\n            ref={heightInputRef}\n            key={`height-${defaultDimensions.height}-${isConstrained}`}\n            type=\"text\"\n            placeholder=\"H\"\n            defaultValue={defaultDimensions.height}\n            onBlur={handleHeightBlur}\n            onKeyDown={handleHeightKeyDown}\n            className=\"h-7 w-16 text-xs\"\n          />\n        </div>\n\n        <div className=\"bg-border mx-1 h-5 w-px\" />\n\n        {/* Alignment Controls */}\n        <div className=\"flex items-center gap-0.5\">\n          <Button\n            variant={attrs?.alignment === \"left\" ? \"secondary\" : \"ghost\"}\n            size=\"sm\"\n            className=\"h-7 w-7 p-0\"\n            onClick={() => handleAlignmentChange(\"left\")}\n            title=\"Align left\"\n          >\n            <AlignLeft className=\"size-3.5\" />\n          </Button>\n          <Button\n            variant={attrs?.alignment === \"center\" ? \"secondary\" : \"ghost\"}\n            size=\"sm\"\n            className=\"h-7 w-7 p-0\"\n            onClick={() => handleAlignmentChange(\"center\")}\n            title=\"Align center\"\n          >\n            <AlignCenter className=\"size-3.5\" />\n          </Button>\n          <Button\n            variant={attrs?.alignment === \"right\" ? \"secondary\" : \"ghost\"}\n            size=\"sm\"\n            className=\"h-7 w-7 p-0\"\n            onClick={() => handleAlignmentChange(\"right\")}\n            title=\"Align right\"\n          >\n            <AlignRight className=\"size-3.5\" />\n          </Button>\n        </div>\n\n        <div className=\"bg-border mx-1 h-5 w-px\" />\n\n        {/* Object Fit Selector */}\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 gap-1 px-2 text-xs\">\n              {OBJECT_FIT_OPTIONS.find((o) => o.value === attrs?.objectFit)\n                ?.label || \"Contain\"}\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            className={cn(\n              \"bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\"\n            )}\n            align=\"start\"\n            sideOffset={8}\n          >\n            {OBJECT_FIT_OPTIONS.map((option) => (\n              <DropdownMenuItem\n                key={option.value}\n                onClick={() => handleObjectFitChange(option.value)}\n              >\n                {option.label}\n                {attrs?.objectFit === option.value && (\n                  <Check className=\"ml-auto size-4\" />\n                )}\n              </DropdownMenuItem>\n            ))}\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        <div className=\"bg-border mx-1 h-5 w-px\" />\n\n        {/* Caption Popover */}\n        <Popover open={captionOpen} onOpenChange={setCaptionOpen}>\n          <PopoverTrigger asChild>\n            <Button\n              variant={attrs?.caption ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n              onClick={handleCaptionOpen}\n              title=\"Add caption\"\n            >\n              <MessageSquare className=\"size-3.5\" />\n              Caption\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-64 p-3\" align=\"start\" sideOffset={8}>\n            <div className=\"space-y-2\">\n              <p className=\"text-sm font-medium\">Image Caption</p>\n              <Input\n                placeholder=\"Enter caption...\"\n                value={captionValue}\n                onChange={(e) => setCaptionValue(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") {\n                    e.preventDefault()\n                    handleCaptionSave()\n                  }\n                }}\n              />\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setCaptionValue(\"\")\n                    editor\n                      .chain()\n                      .focus()\n                      .updateAttributes(\"image\", { caption: null })\n                      .run()\n                    setCaptionOpen(false)\n                  }}\n                >\n                  Clear\n                </Button>\n                <Button size=\"sm\" onClick={handleCaptionSave}>\n                  Save\n                </Button>\n              </div>\n            </div>\n          </PopoverContent>\n        </Popover>\n\n        <div className=\"bg-border mx-1 h-5 w-px\" />\n\n        {/* Delete Button */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 w-7 p-0\"\n          onClick={handleDelete}\n          title=\"Delete image\"\n        >\n          <Trash2 className=\"size-3.5\" />\n        </Button>\n      </div>\n    </BubbleMenu>\n  )\n}\n",
      "type": "registry:ui"
    },
    {
      "path": "src/registry/editor/editor-table.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Table } from \"@tiptap/extension-table\"\nimport { TableCell } from \"@tiptap/extension-table-cell\"\nimport { TableHeader } from \"@tiptap/extension-table-header\"\nimport { TableRow } from \"@tiptap/extension-table-row\"\nimport { BubbleMenu, useEditorState } from \"@tiptap/react\"\nimport { EditorContext } from \"./editor\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { DropdownMenuContent as DropdownMenuContentPrimitive } from \"@radix-ui/react-dropdown-menu\"\nimport { cn } from \"@/lib/utils\"\nimport {\n  AlignCenter,\n  AlignLeft,\n  AlignRight,\n  AlignVerticalJustifyCenter,\n  AlignVerticalJustifyEnd,\n  AlignVerticalJustifyStart,\n  ArrowDownToLine,\n  ArrowLeftToLine,\n  ArrowRightToLine,\n  ArrowUpToLine,\n  ChevronDown,\n  Columns3,\n  Combine,\n  Rows3,\n  Split,\n  TableProperties,\n  Trash2,\n} from \"lucide-react\"\n\n// =============================================================================\n// EditorTableExtension\n// =============================================================================\n\nexport interface EditorTableOptions {\n  resizable?: boolean\n  HTMLAttributes?: Record<string, unknown>\n}\n\nexport const EditorTableExtension = Table.configure({\n  resizable: true,\n  HTMLAttributes: {\n    class: cn(\n      \"w-full caption-bottom text-sm my-4 border border-border\",\n      \"border-collapse table-fixed\",\n      // Resize cursor when resizing\n      \"[&.resize-cursor]:cursor-col-resize\"\n    ),\n  },\n})\n\nexport const EditorTableRowExtension = TableRow.configure({\n  HTMLAttributes: {\n    class:\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n  },\n})\n\nexport const EditorTableHeaderExtension = TableHeader.extend({\n  addAttributes() {\n    return {\n      ...this.parent?.(),\n      textAlign: {\n        default: null,\n        parseHTML: (element) =>\n          element.style.textAlign || element.getAttribute(\"data-text-align\"),\n        renderHTML: (attributes) => {\n          if (!attributes.textAlign) return {}\n          return {\n            style: `text-align: ${attributes.textAlign}`,\n            \"data-text-align\": attributes.textAlign,\n          }\n        },\n      },\n      verticalAlign: {\n        default: null,\n        parseHTML: (element) =>\n          element.style.verticalAlign ||\n          element.getAttribute(\"data-vertical-align\"),\n        renderHTML: (attributes) => {\n          if (!attributes.verticalAlign) return {}\n          return {\n            style: `vertical-align: ${attributes.verticalAlign}`,\n            \"data-vertical-align\": attributes.verticalAlign,\n          }\n        },\n      },\n    }\n  },\n}).configure({\n  HTMLAttributes: {\n    class: cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground\",\n      \"border-b border-r last:border-r-0 bg-muted/10\",\n      \"relative box-border min-w-[1em]\",\n      \"[&>p]:m-0\",\n      // Selected cell overlay using Tailwind after: pseudo-element\n      \"[&.selectedCell]:after:content-[''] [&.selectedCell]:after:absolute [&.selectedCell]:after:inset-0\",\n      \"[&.selectedCell]:after:bg-primary [&.selectedCell]:after:opacity-[0.08] [&.selectedCell]:after:pointer-events-none\"\n    ),\n  },\n})\n\nexport const EditorTableCellExtension = TableCell.extend({\n  addAttributes() {\n    return {\n      ...this.parent?.(),\n      textAlign: {\n        default: null,\n        parseHTML: (element) =>\n          element.style.textAlign || element.getAttribute(\"data-text-align\"),\n        renderHTML: (attributes) => {\n          if (!attributes.textAlign) return {}\n          return {\n            style: `text-align: ${attributes.textAlign}`,\n            \"data-text-align\": attributes.textAlign,\n          }\n        },\n      },\n      verticalAlign: {\n        default: null,\n        parseHTML: (element) =>\n          element.style.verticalAlign ||\n          element.getAttribute(\"data-vertical-align\"),\n        renderHTML: (attributes) => {\n          if (!attributes.verticalAlign) return {}\n          return {\n            style: `vertical-align: ${attributes.verticalAlign}`,\n            \"data-vertical-align\": attributes.verticalAlign,\n          }\n        },\n      },\n    }\n  },\n}).configure({\n  HTMLAttributes: {\n    class: cn(\n      \"p-2 align-middle border-b\",\n      \"[&:not(:last-child)]:border-r\",\n      \"relative box-border min-w-[1em]\",\n      \"[&>p]:m-0\",\n      // Selected cell overlay using Tailwind after: pseudo-element\n      \"[&.selectedCell]:after:content-[''] [&.selectedCell]:after:absolute [&.selectedCell]:after:inset-0\",\n      \"[&.selectedCell]:after:bg-primary [&.selectedCell]:after:opacity-[0.08] [&.selectedCell]:after:pointer-events-none\"\n    ),\n  },\n})\n\n// Export as array for easy use\nexport const EditorTableExtensions = [\n  EditorTableExtension,\n  EditorTableRowExtension,\n  EditorTableHeaderExtension,\n  EditorTableCellExtension,\n]\n\n// =============================================================================\n// EditorBubbleMenuTable\n// =============================================================================\n\nexport interface EditorBubbleMenuTableProps\n  extends Omit<React.ComponentProps<typeof BubbleMenu>, \"editor\" | \"children\"> {}\n\nexport function EditorBubbleMenuTable(props: EditorBubbleMenuTableProps) {\n  const ctx = React.useContext(EditorContext)\n  const editor = ctx?.editor\n\n  const {\n    canMergeCells = false,\n    canSplitCell = false,\n    canDeleteColumn = false,\n    canDeleteRow = false,\n  } =\n    useEditorState({\n      editor: editor ?? null,\n      selector: ({ editor: e }): {\n        canMergeCells: boolean\n        canSplitCell: boolean\n        canDeleteColumn: boolean\n        canDeleteRow: boolean\n      } => {\n        if (!e) {\n          return {\n            canMergeCells: false,\n            canSplitCell: false,\n            canDeleteColumn: false,\n            canDeleteRow: false,\n          }\n        }\n        return {\n          canMergeCells: e.can().mergeCells(),\n          canSplitCell: e.can().splitCell(),\n          canDeleteColumn: e.can().deleteColumn(),\n          canDeleteRow: e.can().deleteRow(),\n        }\n      },\n    }) ?? {}\n\n  if (!editor) return null\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"bottom\",\n        getReferenceClientRect: () => {\n          const { view, state } = editor\n          const domAtPos = view.domAtPos(state.selection.from)\n          const node = domAtPos.node\n          const tableElement =\n            node instanceof Element\n              ? node.closest(\"table\")\n              : node.parentElement?.closest(\"table\")\n          if (tableElement) {\n            return tableElement.getBoundingClientRect()\n          }\n          return view.dom.getBoundingClientRect()\n        },\n      }}\n      shouldShow={({ editor: e }) => e.isActive(\"table\")}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {/* Column Actions */}\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n            >\n              <Columns3 className=\"size-3.5\" />\n              Column\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            align=\"start\"\n            sideOffset={8}\n            className={cn(\n              \"min-w-[160px]\",\n              \"bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\"\n            )}\n          >\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().toggleHeaderColumn().run()}\n            >\n              <TableProperties className=\"mr-2 size-3.5\" />\n              Toggle Header\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addColumnBefore().run()}\n            >\n              <ArrowLeftToLine className=\"mr-2 size-3.5\" />\n              Insert Before\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addColumnAfter().run()}\n            >\n              <ArrowRightToLine className=\"mr-2 size-3.5\" />\n              Insert After\n            </DropdownMenuItem>\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"textAlign\", \"left\")\n                  .run()\n              }\n            >\n              <AlignLeft className=\"mr-2 size-3.5\" />\n              Align Left\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"textAlign\", \"center\")\n                  .run()\n              }\n            >\n              <AlignCenter className=\"mr-2 size-3.5\" />\n              Align Center\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"textAlign\", \"right\")\n                  .run()\n              }\n            >\n              <AlignRight className=\"mr-2 size-3.5\" />\n              Align Right\n            </DropdownMenuItem>\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().deleteColumn().run()}\n              className=\"text-destructive focus:text-destructive\"\n            >\n              <Trash2 className=\"mr-2 size-3.5\" />\n              Delete Column\n            </DropdownMenuItem>\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        {/* Row Actions */}\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n            >\n              <Rows3 className=\"size-3.5\" />\n              Row\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            align=\"start\"\n            sideOffset={8}\n            className={cn(\n              \"min-w-[160px]\",\n              \"bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\"\n            )}\n          >\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().toggleHeaderRow().run()}\n            >\n              <TableProperties className=\"mr-2 size-3.5\" />\n              Toggle Header\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addRowBefore().run()}\n            >\n              <ArrowUpToLine className=\"mr-2 size-3.5\" />\n              Insert Above\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addRowAfter().run()}\n            >\n              <ArrowDownToLine className=\"mr-2 size-3.5\" />\n              Insert Below\n            </DropdownMenuItem>\n\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"verticalAlign\", \"top\")\n                  .run()\n              }\n            >\n              <AlignVerticalJustifyStart className=\"mr-2 size-3.5\" />\n              Align Top\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"verticalAlign\", \"middle\")\n                  .run()\n              }\n            >\n              <AlignVerticalJustifyCenter className=\"mr-2 size-3.5\" />\n              Align Middle\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"verticalAlign\", \"bottom\")\n                  .run()\n              }\n            >\n              <AlignVerticalJustifyEnd className=\"mr-2 size-3.5\" />\n              Align Bottom\n            </DropdownMenuItem>\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().deleteRow().run()}\n              className=\"text-destructive focus:text-destructive\"\n            >\n              <Trash2 className=\"mr-2 size-3.5\" />\n              Delete Row\n            </DropdownMenuItem>\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        {/* Cell Actions */}\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n            >\n              <Combine className=\"size-3.5\" />\n              Cell\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            align=\"start\"\n            sideOffset={8}\n            className={cn(\n              \"min-w-[160px]\",\n              \"bg-popover text-popover-foreground z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\"\n            )}\n          >\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().mergeCells().run()}\n              disabled={!canMergeCells}\n            >\n              <Combine className=\"mr-2 size-3.5\" />\n              Merge Cells\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().splitCell().run()}\n              disabled={!canSplitCell}\n            >\n              <Split className=\"mr-2 size-3.5\" />\n              Split Cell\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().toggleHeaderCell().run()}\n            >\n              <TableProperties className=\"mr-2 size-3.5\" />\n              Toggle Header Cell\n            </DropdownMenuItem>\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        {/* Quick Delete Actions */}\n        <div className=\"ml-0.5 flex items-center gap-0.5 border-l pl-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 gap-1 px-2 text-xs\"\n            onClick={() => editor.chain().focus().deleteColumn().run()}\n            disabled={!canDeleteColumn}\n            title=\"Delete Column\"\n          >\n            <Columns3 className=\"size-3.5\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 gap-1 px-2 text-xs\"\n            onClick={() => editor.chain().focus().deleteRow().run()}\n            disabled={!canDeleteRow}\n            title=\"Delete Row\"\n          >\n            <Rows3 className=\"size-3.5\" />\n          </Button>\n        </div>\n\n        {/* Delete Table */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 w-7 p-0\"\n          onClick={() => editor.chain().focus().deleteTable().run()}\n          title=\"Delete Table\"\n        >\n          <Trash2 className=\"size-3.5\" />\n        </Button>\n      </div>\n    </BubbleMenu>\n  )\n}\n\n",
      "type": "registry:ui"
    },
    {
      "path": "src/registry/editor/editor-code-block.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Extension } from \"@tiptap/core\"\nimport CodeBlockLowlight from \"@tiptap/extension-code-block-lowlight\"\nimport { BubbleMenu } from \"@tiptap/react\"\nimport { all, createLowlight } from \"lowlight\"\nimport { EditorContext } from \"./editor\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { cn } from \"@/lib/utils\"\nimport { Check, ChevronDown, ClipboardCopy, Code2, Trash2 } from \"lucide-react\"\n\n// =============================================================================\n// Constants\n// =============================================================================\n\ninterface CodeBlockLanguage {\n  name: string\n  value: string\n}\n\nexport const CODEBLOCK_LANGUAGES: CodeBlockLanguage[] = [\n  { name: \"Plain Text\", value: \"plaintext\" },\n  { name: \"JavaScript\", value: \"javascript\" },\n  { name: \"TypeScript\", value: \"typescript\" },\n  { name: \"JSX\", value: \"jsx\" },\n  { name: \"TSX\", value: \"tsx\" },\n  { name: \"HTML\", value: \"html\" },\n  { name: \"CSS\", value: \"css\" },\n  { name: \"SCSS\", value: \"scss\" },\n  { name: \"JSON\", value: \"json\" },\n  { name: \"Markdown\", value: \"markdown\" },\n  { name: \"Python\", value: \"python\" },\n  { name: \"Java\", value: \"java\" },\n  { name: \"C\", value: \"c\" },\n  { name: \"C++\", value: \"cpp\" },\n  { name: \"C#\", value: \"csharp\" },\n  { name: \"Go\", value: \"go\" },\n  { name: \"Rust\", value: \"rust\" },\n  { name: \"Ruby\", value: \"ruby\" },\n  { name: \"PHP\", value: \"php\" },\n  { name: \"Swift\", value: \"swift\" },\n  { name: \"Kotlin\", value: \"kotlin\" },\n  { name: \"Scala\", value: \"scala\" },\n  { name: \"SQL\", value: \"sql\" },\n  { name: \"GraphQL\", value: \"graphql\" },\n  { name: \"Shell\", value: \"bash\" },\n  { name: \"PowerShell\", value: \"powershell\" },\n  { name: \"Docker\", value: \"dockerfile\" },\n  { name: \"YAML\", value: \"yaml\" },\n  { name: \"XML\", value: \"xml\" },\n  { name: \"Diff\", value: \"diff\" },\n]\n\nexport type CodeBlockLanguageValue =\n  (typeof CODEBLOCK_LANGUAGES)[number][\"value\"]\n\n// =============================================================================\n// Lowlight instance with all languages\n// =============================================================================\n\nconst lowlight = createLowlight(all)\n\n// =============================================================================\n// EditorCodeBlockExtension\n// =============================================================================\n\nexport interface EditorCodeBlockOptions {\n  defaultLanguage?: CodeBlockLanguageValue\n  HTMLAttributes?: Record<string, unknown>\n}\n\nexport const EditorCodeBlockExtension = Extension.create({\n  name: \"codeBlockLowlight\",\n  addExtensions() {\n    return [\n      CodeBlockLowlight.configure({ lowlight, defaultLanguage: \"plaintext\" }),\n    ]\n  },\n})\n\n// =============================================================================\n// Syntax Highlighting Styles (GitHub Dark-inspired)\n// Injected into document on first use\n// =============================================================================\n\nexport const CODEBLOCK_STYLES = `\n  /* ==========================================================================\n     Syntax Highlighting Theme (GitHub Dark-inspired)\n     ========================================================================== */\n  /* Comments */\n  .ProseMirror .hljs-comment,\n  .ProseMirror .hljs-quote {\n    color: hsl(215 12% 50%);\n    font-style: italic;\n  }\n\n  /* Keywords & Tags */\n  .ProseMirror .hljs-keyword,\n  .ProseMirror .hljs-selector-tag {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Strings & Regex */\n  .ProseMirror .hljs-string,\n  .ProseMirror .hljs-regexp,\n  .ProseMirror .hljs-attribute,\n  .ProseMirror .hljs-template-variable,\n  .ProseMirror .hljs-variable.language_ {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Numbers */\n  .ProseMirror .hljs-number,\n  .ProseMirror .hljs-literal {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Functions & Classes */\n  .ProseMirror .hljs-title,\n  .ProseMirror .hljs-title.class_,\n  .ProseMirror .hljs-title.function_ {\n    color: hsl(260 83% 79%);\n  }\n\n  /* Built-in & Types */\n  .ProseMirror .hljs-built_in,\n  .ProseMirror .hljs-type {\n    color: hsl(29 67% 75%);\n  }\n\n  /* Variables & Params */\n  .ProseMirror .hljs-variable,\n  .ProseMirror .hljs-params {\n    color: hsl(210 14% 93%);\n  }\n\n  /* Properties & Attributes */\n  .ProseMirror .hljs-attr,\n  .ProseMirror .hljs-property {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Symbols & Bullets */\n  .ProseMirror .hljs-symbol,\n  .ProseMirror .hljs-bullet {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Meta & Preprocessor */\n  .ProseMirror .hljs-meta,\n  .ProseMirror .hljs-meta .hljs-keyword {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Links */\n  .ProseMirror .hljs-link {\n    color: hsl(212 97% 81%);\n    text-decoration: underline;\n  }\n\n  /* Deletion (diff) */\n  .ProseMirror .hljs-deletion {\n    color: hsl(350 89% 72%);\n    background: hsl(350 89% 72% / 0.15);\n  }\n\n  /* Addition (diff) */\n  .ProseMirror .hljs-addition {\n    color: hsl(139 66% 69%);\n    background: hsl(139 66% 69% / 0.15);\n  }\n\n  /* Section */\n  .ProseMirror .hljs-section {\n    color: hsl(212 97% 81%);\n    font-weight: bold;\n  }\n\n  /* Emphasis */\n  .ProseMirror .hljs-emphasis {\n    font-style: italic;\n  }\n\n  /* Strong */\n  .ProseMirror .hljs-strong {\n    font-weight: bold;\n  }\n\n  /* Punctuation */\n  .ProseMirror .hljs-punctuation {\n    color: hsl(210 14% 66%);\n  }\n\n  /* Pre code reset */\n  .ProseMirror pre code {\n    background: transparent;\n    padding: 0;\n    font-size: inherit;\n    color: inherit;\n    font-family: inherit;\n  }\n`\n\n// Inject styles once\nlet stylesInjected = false\nexport function injectCodeBlockStyles() {\n  if (stylesInjected || typeof document === \"undefined\") return\n  const styleEl = document.createElement(\"style\")\n  styleEl.id = \"editor-codeblock-styles\"\n  styleEl.textContent = CODEBLOCK_STYLES\n  document.head.appendChild(styleEl)\n  stylesInjected = true\n}\n\n// =============================================================================\n// EditorBubbleMenuCodeBlock\n// =============================================================================\n\nexport interface EditorBubbleMenuCodeBlockProps\n  extends Omit<React.ComponentProps<typeof BubbleMenu>, \"editor\" | \"children\"> {\n  children?: React.ReactNode\n}\n\nexport function EditorBubbleMenuCodeBlock(\n  props: EditorBubbleMenuCodeBlockProps\n) {\n  const ctx = React.useContext(EditorContext)\n  const editor = ctx?.editor\n  const [open, setOpen] = React.useState(false)\n  const [copied, setCopied] = React.useState(false)\n\n  // Inject styles on first render\n  React.useEffect(() => {\n    injectCodeBlockStyles()\n  }, [])\n\n  if (!editor) return null\n\n  const currentLanguage =\n    editor.getAttributes(\"codeBlock\").language || \"plaintext\"\n\n  const currentLanguageLabel =\n    CODEBLOCK_LANGUAGES.find((lang) => lang.value === currentLanguage)?.name ||\n    currentLanguage\n\n  const handleSelectLanguage = (value: string) => {\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"codeBlock\", { language: value })\n      .run()\n    setOpen(false)\n  }\n\n  const handleCopyCode = async () => {\n    const { state } = editor\n    const { from } = state.selection\n\n    let codeContent = \"\"\n\n    // Try to find the code block and get its content\n    state.doc.nodesBetween(from, from, (node) => {\n      if (node.type.name === \"codeBlock\") {\n        codeContent = node.textContent\n        return false\n      }\n      // Also handle if we're inside the text of a code block\n      if (node.type.name === \"text\") {\n        // Check parent\n        const $pos = state.doc.resolve(from)\n        for (let depth = $pos.depth; depth >= 0; depth--) {\n          const parentNode = $pos.node(depth)\n          if (parentNode.type.name === \"codeBlock\") {\n            codeContent = parentNode.textContent\n            return false\n          }\n        }\n      }\n      return true\n    })\n\n    // Fallback: traverse from current position up to find code block\n    if (!codeContent) {\n      const $pos = state.doc.resolve(from)\n      for (let depth = $pos.depth; depth >= 0; depth--) {\n        const node = $pos.node(depth)\n        if (node.type.name === \"codeBlock\") {\n          codeContent = node.textContent\n          break\n        }\n      }\n    }\n\n    if (codeContent) {\n      await navigator.clipboard.writeText(codeContent)\n      setCopied(true)\n      setTimeout(() => setCopied(false), 2000)\n    }\n  }\n\n  const handleDelete = () => {\n    const { state } = editor\n    const { from } = state.selection\n\n    // Find the code block node position\n    let codeBlockPos: number | null = null\n    let codeBlockNode: typeof state.doc | null = null\n\n    // Traverse up from the current position to find the code block\n    const $pos = state.doc.resolve(from)\n    for (let depth = $pos.depth; depth >= 0; depth--) {\n      const node = $pos.node(depth)\n      if (node.type.name === \"codeBlock\") {\n        codeBlockPos = $pos.before(depth)\n        codeBlockNode = node\n        break\n      }\n    }\n\n    if (codeBlockPos !== null && codeBlockNode) {\n      // Delete the entire code block\n      editor\n        .chain()\n        .focus()\n        .deleteRange({\n          from: codeBlockPos,\n          to: codeBlockPos + codeBlockNode.nodeSize,\n        })\n        .run()\n    }\n  }\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"top-end\",\n        offset: [0, 8],\n        getReferenceClientRect: () => {\n          const { view, state } = editor\n          const { from } = state.selection\n\n          // Find the code block node and get its position\n          let codeBlockPos = from\n          state.doc.nodesBetween(from, from, (node, pos) => {\n            if (node.type.name === \"codeBlock\") {\n              codeBlockPos = pos\n              return false\n            }\n          })\n\n          const domNode = view.nodeDOM(codeBlockPos)\n          if (domNode instanceof HTMLElement) {\n            const preElement = domNode.querySelector(\"pre\") || domNode\n            if (preElement instanceof HTMLElement) {\n              return preElement.getBoundingClientRect()\n            }\n          }\n          return view.dom.getBoundingClientRect()\n        },\n      }}\n      shouldShow={({ editor: e }) => e.isActive(\"codeBlock\")}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {/* Language Selector with Search */}\n        <Popover open={open} onOpenChange={setOpen}>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs font-normal\"\n              role=\"combobox\"\n              aria-expanded={open}\n            >\n              <Code2 className=\"size-3.5\" />\n              {currentLanguageLabel}\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-[200px] p-0\" align=\"start\" sideOffset={8}>\n            <Command>\n              <CommandInput placeholder=\"Search language...\" className=\"h-9\" />\n              <CommandList>\n                <CommandEmpty>No language found.</CommandEmpty>\n                <CommandGroup>\n                  {CODEBLOCK_LANGUAGES.map((lang) => (\n                    <CommandItem\n                      key={lang.value}\n                      value={lang.name}\n                      onSelect={() => handleSelectLanguage(lang.value)}\n                    >\n                      {lang.name}\n                      {currentLanguage === lang.value && (\n                        <Check className=\"ml-auto size-4\" />\n                      )}\n                    </CommandItem>\n                  ))}\n                </CommandGroup>\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n\n        {/* Divider */}\n        <div className=\"bg-border h-4 w-px\" />\n\n        {/* Copy Button */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-7 w-7 p-0\"\n          onClick={handleCopyCode}\n          title={copied ? \"Copied!\" : \"Copy code\"}\n        >\n          {copied ? (\n            <Check className=\"size-3.5 text-green-500\" />\n          ) : (\n            <ClipboardCopy className=\"size-3.5\" />\n          )}\n        </Button>\n\n        {/* Divider */}\n        <div className=\"bg-border h-4 w-px\" />\n\n        {/* Delete Button */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 w-7 p-0\"\n          onClick={handleDelete}\n          title=\"Delete code block\"\n        >\n          <Trash2 className=\"size-3.5\" />\n        </Button>\n      </div>\n    </BubbleMenu>\n  )\n}\n",
      "type": "registry:ui"
    },
    {
      "path": "src/registry/editor/editor-slash-menu.tsx",
      "content": "\"use client\"\n\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { cn } from \"@/lib/utils\"\nimport { Extension } from \"@tiptap/core\"\nimport { ReactRenderer } from \"@tiptap/react\"\nimport Suggestion, { type SuggestionOptions } from \"@tiptap/suggestion\"\nimport {\n  CheckSquare,\n  Code2,\n  Heading1,\n  Heading2,\n  Heading3,\n  ImageUp,\n  List,\n  ListOrdered,\n  Minus,\n  Table,\n  TextQuote,\n  Type,\n} from \"lucide-react\"\nimport * as React from \"react\"\nimport tippy, { type Instance, type Props } from \"tippy.js\"\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface SlashMenuItem {\n  title: string\n  description: string\n  icon: React.ElementType\n  searchTerms: string[]\n  command: (\n    editor: ReturnType<typeof import(\"@tiptap/react\").useEditor>\n  ) => void\n}\n\ninterface SlashMenuListProps {\n  items: SlashMenuItem[]\n  command: (item: SlashMenuItem) => void\n}\n\ninterface SlashMenuListRef {\n  onKeyDown: (event: KeyboardEvent) => boolean\n}\n\n// =============================================================================\n// Default Slash Menu Items\n// =============================================================================\n\nexport const defaultSlashMenuItems: SlashMenuItem[] = [\n  {\n    title: \"Text\",\n    description: \"Start writing with plain text\",\n    icon: Type,\n    searchTerms: [\"text\", \"paragraph\", \"plain\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setParagraph().run()\n    },\n  },\n  {\n    title: \"Heading 1\",\n    description: \"Large heading\",\n    icon: Heading1,\n    searchTerms: [\"heading\", \"h1\", \"title\", \"large\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHeading({ level: 1 }).run()\n    },\n  },\n  {\n    title: \"Heading 2\",\n    description: \"Medium heading\",\n    icon: Heading2,\n    searchTerms: [\"heading\", \"h2\", \"subtitle\", \"medium\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHeading({ level: 2 }).run()\n    },\n  },\n  {\n    title: \"Heading 3\",\n    description: \"Small heading\",\n    icon: Heading3,\n    searchTerms: [\"heading\", \"h3\", \"small\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHeading({ level: 3 }).run()\n    },\n  },\n  {\n    title: \"Bullet List\",\n    description: \"Create a bullet list\",\n    icon: List,\n    searchTerms: [\"bullet\", \"list\", \"unordered\", \"ul\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleBulletList().run()\n    },\n  },\n  {\n    title: \"Numbered List\",\n    description: \"Create a numbered list\",\n    icon: ListOrdered,\n    searchTerms: [\"numbered\", \"list\", \"ordered\", \"ol\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleOrderedList().run()\n    },\n  },\n  {\n    title: \"Task List\",\n    description: \"Create a task list with checkboxes\",\n    icon: CheckSquare,\n    searchTerms: [\"task\", \"todo\", \"checkbox\", \"checklist\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleTaskList().run()\n    },\n  },\n  {\n    title: \"Quote\",\n    description: \"Capture a quote\",\n    icon: TextQuote,\n    searchTerms: [\"quote\", \"blockquote\", \"cite\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setBlockquote().run()\n    },\n  },\n  {\n    title: \"Divider\",\n    description: \"Visually divide blocks\",\n    icon: Minus,\n    searchTerms: [\"divider\", \"hr\", \"horizontal\", \"rule\", \"line\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHorizontalRule().run()\n    },\n  },\n  {\n    title: \"Code Block\",\n    description: \"Add a code block with syntax highlighting\",\n    icon: Code2,\n    searchTerms: [\"code\", \"codeblock\", \"pre\", \"syntax\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleCodeBlock().run()\n    },\n  },\n  {\n    title: \"Image\",\n    description: \"Upload or embed an image\",\n    icon: ImageUp,\n    searchTerms: [\"image\", \"img\", \"picture\", \"photo\", \"upload\"],\n    command: (editor) => {\n      if (editor) {\n        editor.chain().focus().setImage({ src: null }).run()\n      }\n    },\n  },\n  {\n    title: \"Table\",\n    description: \"Insert a table\",\n    icon: Table,\n    searchTerms: [\"table\", \"grid\", \"spreadsheet\"],\n    command: (editor) => {\n      if (editor) {\n        editor\n          .chain()\n          .focus()\n          .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n          .run()\n      }\n    },\n  },\n]\n\n// =============================================================================\n// SlashMenuList Component\n// =============================================================================\n\nconst EditorSlashMenuList = React.forwardRef<\n  SlashMenuListRef,\n  SlashMenuListProps\n>(({ items, command }, ref) => {\n  const [selectedIndex, setSelectedIndex] = React.useState(0)\n  const itemRefs = React.useRef<(HTMLButtonElement | null)[]>([])\n  const isKeyboardNavigating = React.useRef(false)\n\n  React.useEffect(() => {\n    setSelectedIndex(0)\n  }, [items])\n\n  React.useEffect(() => {\n    const selectedItem = itemRefs.current[selectedIndex]\n    if (selectedItem) {\n      selectedItem.scrollIntoView({ block: \"nearest\" })\n    }\n  }, [selectedIndex])\n\n  const handleMouseEnter = (index: number) => {\n    // Ignore mouse enter events during keyboard navigation\n    // to prevent scrolling from triggering selection changes\n    if (isKeyboardNavigating.current) return\n    setSelectedIndex(index)\n  }\n\n  const handleMouseMove = () => {\n    // Re-enable mouse selection after user moves the mouse\n    isKeyboardNavigating.current = false\n  }\n\n  React.useImperativeHandle(ref, () => ({\n    onKeyDown: (event: KeyboardEvent) => {\n      if (event.key === \"ArrowUp\") {\n        isKeyboardNavigating.current = true\n        setSelectedIndex((prev) => (prev <= 0 ? items.length - 1 : prev - 1))\n        return true\n      }\n\n      if (event.key === \"ArrowDown\") {\n        isKeyboardNavigating.current = true\n        setSelectedIndex((prev) => (prev >= items.length - 1 ? 0 : prev + 1))\n        return true\n      }\n\n      if (event.key === \"Enter\") {\n        const item = items[selectedIndex]\n        if (item) {\n          command(item)\n        }\n        return true\n      }\n\n      return false\n    },\n  }))\n\n  if (items.length === 0) {\n    return (\n      <div className=\"text-muted-foreground p-4 text-center text-sm\">\n        No results found\n      </div>\n    )\n  }\n\n  return (\n    <ScrollArea\n      style={{\n        height:\n          items.length * Number(itemRefs.current[0]?.offsetHeight ?? 48) + 8,\n      }}\n      className=\"bg-popover max-h-[300px] overflow-auto rounded-md border p-1 shadow-md\"\n      onMouseMove={handleMouseMove}\n    >\n      {items.map((item, index) => (\n        <button\n          key={item.title}\n          ref={(el) => {\n            itemRefs.current[index] = el\n          }}\n          onClick={() => command(item)}\n          onMouseEnter={() => handleMouseEnter(index)}\n          className={cn(\n            \"relative flex w-full cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm transition-colors outline-none select-none\",\n            \"min-w-[256px]\",\n            index === selectedIndex\n              ? \"bg-accent text-accent-foreground\"\n              : \"hover:bg-accent hover:text-accent-foreground\"\n          )}\n        >\n          <div\n            className=\"border-border bg-background/40 flex size-8 items-center justify-center rounded-lg border\"\n            aria-hidden=\"true\"\n          >\n            <item.icon size={16} strokeWidth={2} className=\"opacity-60\" />\n          </div>\n          <div className=\"flex flex-col items-start\">\n            <span className=\"text-sm font-medium\">{item.title}</span>\n            <span className=\"text-muted-foreground text-xs\">\n              {item.description}\n            </span>\n          </div>\n        </button>\n      ))}\n    </ScrollArea>\n  )\n})\nEditorSlashMenuList.displayName = \"EditorSlashMenuList\"\n\n// =============================================================================\n// Slash Menu Suggestion\n// =============================================================================\n\nfunction createSlashMenuSuggestion(\n  items: SlashMenuItem[] = defaultSlashMenuItems\n): Omit<SuggestionOptions, \"editor\"> {\n  return {\n    char: \"/\",\n    items: ({ query }) => {\n      const normalizedQuery = query.toLowerCase()\n      return items.filter(\n        (item) =>\n          item.title.toLowerCase().includes(normalizedQuery) ||\n          item.searchTerms.some((term) => term.includes(normalizedQuery))\n      )\n    },\n    render: () => {\n      let component: ReactRenderer<SlashMenuListRef> | null = null\n      let popup: Instance<Props>[] | null = null\n\n      return {\n        onStart: (props) => {\n          component = new ReactRenderer(EditorSlashMenuList, {\n            props,\n            editor: props.editor,\n          })\n\n          if (!props.clientRect) return\n\n          popup = tippy(\"body\", {\n            getReferenceClientRect: props.clientRect as () => DOMRect,\n            appendTo: () => document.body,\n            content: component.element,\n            showOnCreate: true,\n            interactive: true,\n            trigger: \"manual\",\n            placement: \"bottom-start\",\n            animation: \"shift-toward-subtle\",\n            theme: \"slash-menu\",\n          })\n        },\n\n        onUpdate: (props) => {\n          component?.updateProps(props)\n\n          if (!props.clientRect || !popup?.[0]) return\n\n          popup[0].setProps({\n            getReferenceClientRect: props.clientRect as () => DOMRect,\n          })\n        },\n\n        onKeyDown: (props) => {\n          if (props.event.key === \"Escape\") {\n            popup?.[0]?.hide()\n            return true\n          }\n\n          return component?.ref?.onKeyDown(props.event) ?? false\n        },\n\n        onExit: () => {\n          popup?.[0]?.destroy()\n          component?.destroy()\n        },\n      }\n    },\n    command: ({ editor, range, props }) => {\n      // Delete the \"/\" trigger and any query text\n      editor.chain().focus().deleteRange(range).run()\n      // Execute the selected command\n      props.command(editor)\n    },\n  }\n}\n\n// =============================================================================\n// EditorSlashMenuExtension\n// =============================================================================\n\nexport interface EditorSlashMenuOptions {\n  items?: SlashMenuItem[]\n}\n\nexport const EditorSlashMenuExtension =\n  Extension.create<EditorSlashMenuOptions>({\n    name: \"slashMenu\",\n\n    addOptions() {\n      return {\n        items: defaultSlashMenuItems,\n      }\n    },\n\n    onCreate() {\n      injectSlashMenuStyles()\n    },\n\n    addProseMirrorPlugins() {\n      return [\n        Suggestion({\n          editor: this.editor,\n          ...createSlashMenuSuggestion(this.options.items),\n        }),\n      ]\n    },\n  })\n\n// =============================================================================\n// Slash Menu Styles (for tippy.js)\n// =============================================================================\n\nconst SLASH_MENU_STYLES = `\n  .tippy-box[data-theme~='slash-menu'] {\n    background-color: hsl(var(--popover));\n    border: 1px solid hsl(var(--border));\n    border-radius: 0.5rem;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n    overflow: hidden;\n    min-width: 280px;\n  }\n  .tippy-box[data-theme~='slash-menu'] .tippy-content {\n    padding: 0;\n  }\n`\n\nconst STYLE_ID = \"editor-slash-menu-styles\"\n\nfunction injectSlashMenuStyles() {\n  if (typeof document === \"undefined\") return\n  if (document.getElementById(STYLE_ID)) return\n\n  const style = document.createElement(\"style\")\n  style.id = STYLE_ID\n  style.textContent = SLASH_MENU_STYLES\n  document.head.appendChild(style)\n}\n\n// =============================================================================\n// Exports\n// =============================================================================\n\nexport { createSlashMenuSuggestion, EditorSlashMenuList }\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:block"
}