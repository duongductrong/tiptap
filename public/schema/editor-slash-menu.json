{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "editor-slash-menu",
  "title": "Editor Slash Menu Extension",
  "description": "Notion-style slash command menu with keyboard navigation.",
  "dependencies": [
    "@tiptap/suggestion",
    "tippy.js"
  ],
  "registryDependencies": [
    "editor"
  ],
  "files": [
    {
      "path": "src/registry/editor/editor-slash-menu.tsx",
      "content": "\"use client\"\n\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { cn } from \"@/lib/utils\"\nimport { Extension } from \"@tiptap/core\"\nimport { ReactRenderer } from \"@tiptap/react\"\nimport Suggestion, { type SuggestionOptions } from \"@tiptap/suggestion\"\nimport {\n  CheckSquare,\n  Code2,\n  Heading1,\n  Heading2,\n  Heading3,\n  ImageUp,\n  List,\n  ListOrdered,\n  Minus,\n  Table,\n  TextQuote,\n  Type,\n} from \"lucide-react\"\nimport * as React from \"react\"\nimport tippy, { type Instance, type Props } from \"tippy.js\"\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface SlashMenuItem {\n  title: string\n  description: string\n  icon: React.ElementType\n  searchTerms: string[]\n  command: (\n    editor: ReturnType<typeof import(\"@tiptap/react\").useEditor>\n  ) => void\n}\n\ninterface SlashMenuListProps {\n  items: SlashMenuItem[]\n  command: (item: SlashMenuItem) => void\n}\n\ninterface SlashMenuListRef {\n  onKeyDown: (event: KeyboardEvent) => boolean\n}\n\n// =============================================================================\n// Default Slash Menu Items\n// =============================================================================\n\nexport const defaultSlashMenuItems: SlashMenuItem[] = [\n  {\n    title: \"Text\",\n    description: \"Start writing with plain text\",\n    icon: Type,\n    searchTerms: [\"text\", \"paragraph\", \"plain\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setParagraph().run()\n    },\n  },\n  {\n    title: \"Heading 1\",\n    description: \"Large heading\",\n    icon: Heading1,\n    searchTerms: [\"heading\", \"h1\", \"title\", \"large\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHeading({ level: 1 }).run()\n    },\n  },\n  {\n    title: \"Heading 2\",\n    description: \"Medium heading\",\n    icon: Heading2,\n    searchTerms: [\"heading\", \"h2\", \"subtitle\", \"medium\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHeading({ level: 2 }).run()\n    },\n  },\n  {\n    title: \"Heading 3\",\n    description: \"Small heading\",\n    icon: Heading3,\n    searchTerms: [\"heading\", \"h3\", \"small\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHeading({ level: 3 }).run()\n    },\n  },\n  {\n    title: \"Bullet List\",\n    description: \"Create a bullet list\",\n    icon: List,\n    searchTerms: [\"bullet\", \"list\", \"unordered\", \"ul\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleBulletList().run()\n    },\n  },\n  {\n    title: \"Numbered List\",\n    description: \"Create a numbered list\",\n    icon: ListOrdered,\n    searchTerms: [\"numbered\", \"list\", \"ordered\", \"ol\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleOrderedList().run()\n    },\n  },\n  {\n    title: \"Task List\",\n    description: \"Create a task list with checkboxes\",\n    icon: CheckSquare,\n    searchTerms: [\"task\", \"todo\", \"checkbox\", \"checklist\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleTaskList().run()\n    },\n  },\n  {\n    title: \"Quote\",\n    description: \"Capture a quote\",\n    icon: TextQuote,\n    searchTerms: [\"quote\", \"blockquote\", \"cite\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setBlockquote().run()\n    },\n  },\n  {\n    title: \"Divider\",\n    description: \"Visually divide blocks\",\n    icon: Minus,\n    searchTerms: [\"divider\", \"hr\", \"horizontal\", \"rule\", \"line\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().setHorizontalRule().run()\n    },\n  },\n  {\n    title: \"Code Block\",\n    description: \"Add a code block with syntax highlighting\",\n    icon: Code2,\n    searchTerms: [\"code\", \"codeblock\", \"pre\", \"syntax\"],\n    command: (editor) => {\n      if (editor) editor.chain().focus().toggleCodeBlock().run()\n    },\n  },\n  {\n    title: \"Image\",\n    description: \"Upload or embed an image\",\n    icon: ImageUp,\n    searchTerms: [\"image\", \"img\", \"picture\", \"photo\", \"upload\"],\n    command: (editor) => {\n      if (editor) {\n        editor.chain().focus().setImage({ src: null }).run()\n      }\n    },\n  },\n  {\n    title: \"Table\",\n    description: \"Insert a table\",\n    icon: Table,\n    searchTerms: [\"table\", \"grid\", \"spreadsheet\"],\n    command: (editor) => {\n      if (editor) {\n        editor\n          .chain()\n          .focus()\n          .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n          .run()\n      }\n    },\n  },\n]\n\n// =============================================================================\n// SlashMenuList Component\n// =============================================================================\n\nconst EditorSlashMenuList = React.forwardRef<\n  SlashMenuListRef,\n  SlashMenuListProps\n>(({ items, command }, ref) => {\n  const [selectedIndex, setSelectedIndex] = React.useState(0)\n  const itemRefs = React.useRef<(HTMLButtonElement | null)[]>([])\n  const isKeyboardNavigating = React.useRef(false)\n\n  React.useEffect(() => {\n    setSelectedIndex(0)\n  }, [items])\n\n  React.useEffect(() => {\n    const selectedItem = itemRefs.current[selectedIndex]\n    if (selectedItem) {\n      selectedItem.scrollIntoView({ block: \"nearest\" })\n    }\n  }, [selectedIndex])\n\n  const handleMouseEnter = (index: number) => {\n    // Ignore mouse enter events during keyboard navigation\n    // to prevent scrolling from triggering selection changes\n    if (isKeyboardNavigating.current) return\n    setSelectedIndex(index)\n  }\n\n  const handleMouseMove = () => {\n    // Re-enable mouse selection after user moves the mouse\n    isKeyboardNavigating.current = false\n  }\n\n  React.useImperativeHandle(ref, () => ({\n    onKeyDown: (event: KeyboardEvent) => {\n      if (event.key === \"ArrowUp\") {\n        isKeyboardNavigating.current = true\n        setSelectedIndex((prev) => (prev <= 0 ? items.length - 1 : prev - 1))\n        return true\n      }\n\n      if (event.key === \"ArrowDown\") {\n        isKeyboardNavigating.current = true\n        setSelectedIndex((prev) => (prev >= items.length - 1 ? 0 : prev + 1))\n        return true\n      }\n\n      if (event.key === \"Enter\") {\n        const item = items[selectedIndex]\n        if (item) {\n          command(item)\n        }\n        return true\n      }\n\n      return false\n    },\n  }))\n\n  if (items.length === 0) {\n    return (\n      <div className=\"text-muted-foreground p-4 text-center text-sm\">\n        No results found\n      </div>\n    )\n  }\n\n  return (\n    <ScrollArea\n      style={{\n        height:\n          items.length * Number(itemRefs.current[0]?.offsetHeight ?? 48) + 8,\n      }}\n      className=\"bg-popover max-h-[300px] overflow-auto rounded-md border p-1 shadow-md\"\n      onMouseMove={handleMouseMove}\n    >\n      {items.map((item, index) => (\n        <button\n          key={item.title}\n          ref={(el) => {\n            itemRefs.current[index] = el\n          }}\n          onClick={() => command(item)}\n          onMouseEnter={() => handleMouseEnter(index)}\n          className={cn(\n            \"relative flex w-full cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm transition-colors outline-none select-none\",\n            \"min-w-[256px]\",\n            index === selectedIndex\n              ? \"bg-accent text-accent-foreground\"\n              : \"hover:bg-accent hover:text-accent-foreground\"\n          )}\n        >\n          <div\n            className=\"border-border bg-background/40 flex size-8 items-center justify-center rounded-lg border\"\n            aria-hidden=\"true\"\n          >\n            <item.icon size={16} strokeWidth={2} className=\"opacity-60\" />\n          </div>\n          <div className=\"flex flex-col items-start\">\n            <span className=\"text-sm font-medium\">{item.title}</span>\n            <span className=\"text-muted-foreground text-xs\">\n              {item.description}\n            </span>\n          </div>\n        </button>\n      ))}\n    </ScrollArea>\n  )\n})\nEditorSlashMenuList.displayName = \"EditorSlashMenuList\"\n\n// =============================================================================\n// Slash Menu Suggestion\n// =============================================================================\n\nfunction createSlashMenuSuggestion(\n  items: SlashMenuItem[] = defaultSlashMenuItems\n): Omit<SuggestionOptions, \"editor\"> {\n  return {\n    char: \"/\",\n    items: ({ query }) => {\n      const normalizedQuery = query.toLowerCase()\n      return items.filter(\n        (item) =>\n          item.title.toLowerCase().includes(normalizedQuery) ||\n          item.searchTerms.some((term) => term.includes(normalizedQuery))\n      )\n    },\n    render: () => {\n      let component: ReactRenderer<SlashMenuListRef> | null = null\n      let popup: Instance<Props>[] | null = null\n\n      return {\n        onStart: (props) => {\n          component = new ReactRenderer(EditorSlashMenuList, {\n            props,\n            editor: props.editor,\n          })\n\n          if (!props.clientRect) return\n\n          popup = tippy(\"body\", {\n            getReferenceClientRect: props.clientRect as () => DOMRect,\n            appendTo: () => document.body,\n            content: component.element,\n            showOnCreate: true,\n            interactive: true,\n            trigger: \"manual\",\n            placement: \"bottom-start\",\n            animation: \"shift-toward-subtle\",\n            theme: \"slash-menu\",\n          })\n        },\n\n        onUpdate: (props) => {\n          component?.updateProps(props)\n\n          if (!props.clientRect || !popup?.[0]) return\n\n          popup[0].setProps({\n            getReferenceClientRect: props.clientRect as () => DOMRect,\n          })\n        },\n\n        onKeyDown: (props) => {\n          if (props.event.key === \"Escape\") {\n            popup?.[0]?.hide()\n            return true\n          }\n\n          return component?.ref?.onKeyDown(props.event) ?? false\n        },\n\n        onExit: () => {\n          popup?.[0]?.destroy()\n          component?.destroy()\n        },\n      }\n    },\n    command: ({ editor, range, props }) => {\n      // Delete the \"/\" trigger and any query text\n      editor.chain().focus().deleteRange(range).run()\n      // Execute the selected command\n      props.command(editor)\n    },\n  }\n}\n\n// =============================================================================\n// EditorSlashMenuExtension\n// =============================================================================\n\nexport interface EditorSlashMenuOptions {\n  items?: SlashMenuItem[]\n}\n\nexport const EditorSlashMenuExtension =\n  Extension.create<EditorSlashMenuOptions>({\n    name: \"slashMenu\",\n\n    addOptions() {\n      return {\n        items: defaultSlashMenuItems,\n      }\n    },\n\n    onCreate() {\n      injectSlashMenuStyles()\n    },\n\n    addProseMirrorPlugins() {\n      return [\n        Suggestion({\n          editor: this.editor,\n          ...createSlashMenuSuggestion(this.options.items),\n        }),\n      ]\n    },\n  })\n\n// =============================================================================\n// Slash Menu Styles (for tippy.js)\n// =============================================================================\n\nconst SLASH_MENU_STYLES = `\n  .tippy-box[data-theme~='slash-menu'] {\n    background-color: hsl(var(--popover));\n    border: 1px solid hsl(var(--border));\n    border-radius: 0.5rem;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n    overflow: hidden;\n    min-width: 280px;\n  }\n  .tippy-box[data-theme~='slash-menu'] .tippy-content {\n    padding: 0;\n  }\n`\n\nconst STYLE_ID = \"editor-slash-menu-styles\"\n\nfunction injectSlashMenuStyles() {\n  if (typeof document === \"undefined\") return\n  if (document.getElementById(STYLE_ID)) return\n\n  const style = document.createElement(\"style\")\n  style.id = STYLE_ID\n  style.textContent = SLASH_MENU_STYLES\n  document.head.appendChild(style)\n}\n\n// =============================================================================\n// Exports\n// =============================================================================\n\nexport { createSlashMenuSuggestion, EditorSlashMenuList }\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}