{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "editor-code-block",
  "title": "Editor CodeBlock Extension",
  "description": "Code block with syntax highlighting, language selector, and copy button.",
  "dependencies": [
    "@tiptap/extension-code-block-lowlight",
    "lowlight"
  ],
  "registryDependencies": [
    "editor"
  ],
  "files": [
    {
      "path": "src/registry/editor/editor-code-block.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Extension } from \"@tiptap/core\"\nimport CodeBlockLowlight from \"@tiptap/extension-code-block-lowlight\"\nimport { BubbleMenu } from \"@tiptap/react\"\nimport { all, createLowlight } from \"lowlight\"\nimport { EditorContext } from \"./editor\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { cn } from \"@/lib/utils\"\nimport { Check, ChevronDown, ClipboardCopy, Code2, Trash2 } from \"lucide-react\"\n\n// =============================================================================\n// Constants\n// =============================================================================\n\ninterface CodeBlockLanguage {\n  name: string\n  value: string\n}\n\nexport const CODEBLOCK_LANGUAGES: CodeBlockLanguage[] = [\n  { name: \"Plain Text\", value: \"plaintext\" },\n  { name: \"JavaScript\", value: \"javascript\" },\n  { name: \"TypeScript\", value: \"typescript\" },\n  { name: \"JSX\", value: \"jsx\" },\n  { name: \"TSX\", value: \"tsx\" },\n  { name: \"HTML\", value: \"html\" },\n  { name: \"CSS\", value: \"css\" },\n  { name: \"SCSS\", value: \"scss\" },\n  { name: \"JSON\", value: \"json\" },\n  { name: \"Markdown\", value: \"markdown\" },\n  { name: \"Python\", value: \"python\" },\n  { name: \"Java\", value: \"java\" },\n  { name: \"C\", value: \"c\" },\n  { name: \"C++\", value: \"cpp\" },\n  { name: \"C#\", value: \"csharp\" },\n  { name: \"Go\", value: \"go\" },\n  { name: \"Rust\", value: \"rust\" },\n  { name: \"Ruby\", value: \"ruby\" },\n  { name: \"PHP\", value: \"php\" },\n  { name: \"Swift\", value: \"swift\" },\n  { name: \"Kotlin\", value: \"kotlin\" },\n  { name: \"Scala\", value: \"scala\" },\n  { name: \"SQL\", value: \"sql\" },\n  { name: \"GraphQL\", value: \"graphql\" },\n  { name: \"Shell\", value: \"bash\" },\n  { name: \"PowerShell\", value: \"powershell\" },\n  { name: \"Docker\", value: \"dockerfile\" },\n  { name: \"YAML\", value: \"yaml\" },\n  { name: \"XML\", value: \"xml\" },\n  { name: \"Diff\", value: \"diff\" },\n]\n\nexport type CodeBlockLanguageValue =\n  (typeof CODEBLOCK_LANGUAGES)[number][\"value\"]\n\n// =============================================================================\n// Lowlight instance with all languages\n// =============================================================================\n\nconst lowlight = createLowlight(all)\n\n// =============================================================================\n// EditorCodeBlockExtension\n// =============================================================================\n\nexport interface EditorCodeBlockOptions {\n  defaultLanguage?: CodeBlockLanguageValue\n  HTMLAttributes?: Record<string, unknown>\n}\n\nexport const EditorCodeBlockExtension = Extension.create({\n  name: \"codeBlockLowlight\",\n  addExtensions() {\n    return [\n      CodeBlockLowlight.configure({ lowlight, defaultLanguage: \"plaintext\" }),\n    ]\n  },\n})\n\n// =============================================================================\n// Syntax Highlighting Styles (GitHub Dark-inspired)\n// Injected into document on first use\n// =============================================================================\n\nexport const CODEBLOCK_STYLES = `\n  /* ==========================================================================\n     Syntax Highlighting Theme (GitHub Dark-inspired)\n     ========================================================================== */\n  /* Comments */\n  .ProseMirror .hljs-comment,\n  .ProseMirror .hljs-quote {\n    color: hsl(215 12% 50%);\n    font-style: italic;\n  }\n\n  /* Keywords & Tags */\n  .ProseMirror .hljs-keyword,\n  .ProseMirror .hljs-selector-tag {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Strings & Regex */\n  .ProseMirror .hljs-string,\n  .ProseMirror .hljs-regexp,\n  .ProseMirror .hljs-attribute,\n  .ProseMirror .hljs-template-variable,\n  .ProseMirror .hljs-variable.language_ {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Numbers */\n  .ProseMirror .hljs-number,\n  .ProseMirror .hljs-literal {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Functions & Classes */\n  .ProseMirror .hljs-title,\n  .ProseMirror .hljs-title.class_,\n  .ProseMirror .hljs-title.function_ {\n    color: hsl(260 83% 79%);\n  }\n\n  /* Built-in & Types */\n  .ProseMirror .hljs-built_in,\n  .ProseMirror .hljs-type {\n    color: hsl(29 67% 75%);\n  }\n\n  /* Variables & Params */\n  .ProseMirror .hljs-variable,\n  .ProseMirror .hljs-params {\n    color: hsl(210 14% 93%);\n  }\n\n  /* Properties & Attributes */\n  .ProseMirror .hljs-attr,\n  .ProseMirror .hljs-property {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Symbols & Bullets */\n  .ProseMirror .hljs-symbol,\n  .ProseMirror .hljs-bullet {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Meta & Preprocessor */\n  .ProseMirror .hljs-meta,\n  .ProseMirror .hljs-meta .hljs-keyword {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Links */\n  .ProseMirror .hljs-link {\n    color: hsl(212 97% 81%);\n    text-decoration: underline;\n  }\n\n  /* Deletion (diff) */\n  .ProseMirror .hljs-deletion {\n    color: hsl(350 89% 72%);\n    background: hsl(350 89% 72% / 0.15);\n  }\n\n  /* Addition (diff) */\n  .ProseMirror .hljs-addition {\n    color: hsl(139 66% 69%);\n    background: hsl(139 66% 69% / 0.15);\n  }\n\n  /* Section */\n  .ProseMirror .hljs-section {\n    color: hsl(212 97% 81%);\n    font-weight: bold;\n  }\n\n  /* Emphasis */\n  .ProseMirror .hljs-emphasis {\n    font-style: italic;\n  }\n\n  /* Strong */\n  .ProseMirror .hljs-strong {\n    font-weight: bold;\n  }\n\n  /* Punctuation */\n  .ProseMirror .hljs-punctuation {\n    color: hsl(210 14% 66%);\n  }\n\n  /* Pre code reset */\n  .ProseMirror pre code {\n    background: transparent;\n    padding: 0;\n    font-size: inherit;\n    color: inherit;\n    font-family: inherit;\n  }\n`\n\n// Inject styles once\nlet stylesInjected = false\nexport function injectCodeBlockStyles() {\n  if (stylesInjected || typeof document === \"undefined\") return\n  const styleEl = document.createElement(\"style\")\n  styleEl.id = \"editor-codeblock-styles\"\n  styleEl.textContent = CODEBLOCK_STYLES\n  document.head.appendChild(styleEl)\n  stylesInjected = true\n}\n\n// =============================================================================\n// EditorBubbleMenuCodeBlock\n// =============================================================================\n\nexport interface EditorBubbleMenuCodeBlockProps\n  extends Omit<React.ComponentProps<typeof BubbleMenu>, \"editor\" | \"children\"> {\n  children?: React.ReactNode\n}\n\nexport function EditorBubbleMenuCodeBlock(\n  props: EditorBubbleMenuCodeBlockProps\n) {\n  const ctx = React.useContext(EditorContext)\n  const editor = ctx?.editor\n  const [open, setOpen] = React.useState(false)\n  const [copied, setCopied] = React.useState(false)\n\n  // Inject styles on first render\n  React.useEffect(() => {\n    injectCodeBlockStyles()\n  }, [])\n\n  if (!editor) return null\n\n  const currentLanguage =\n    editor.getAttributes(\"codeBlock\").language || \"plaintext\"\n\n  const currentLanguageLabel =\n    CODEBLOCK_LANGUAGES.find((lang) => lang.value === currentLanguage)?.name ||\n    currentLanguage\n\n  const handleSelectLanguage = (value: string) => {\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"codeBlock\", { language: value })\n      .run()\n    setOpen(false)\n  }\n\n  const handleCopyCode = async () => {\n    const { state } = editor\n    const { from } = state.selection\n\n    let codeContent = \"\"\n\n    // Try to find the code block and get its content\n    state.doc.nodesBetween(from, from, (node) => {\n      if (node.type.name === \"codeBlock\") {\n        codeContent = node.textContent\n        return false\n      }\n      // Also handle if we're inside the text of a code block\n      if (node.type.name === \"text\") {\n        // Check parent\n        const $pos = state.doc.resolve(from)\n        for (let depth = $pos.depth; depth >= 0; depth--) {\n          const parentNode = $pos.node(depth)\n          if (parentNode.type.name === \"codeBlock\") {\n            codeContent = parentNode.textContent\n            return false\n          }\n        }\n      }\n      return true\n    })\n\n    // Fallback: traverse from current position up to find code block\n    if (!codeContent) {\n      const $pos = state.doc.resolve(from)\n      for (let depth = $pos.depth; depth >= 0; depth--) {\n        const node = $pos.node(depth)\n        if (node.type.name === \"codeBlock\") {\n          codeContent = node.textContent\n          break\n        }\n      }\n    }\n\n    if (codeContent) {\n      await navigator.clipboard.writeText(codeContent)\n      setCopied(true)\n      setTimeout(() => setCopied(false), 2000)\n    }\n  }\n\n  const handleDelete = () => {\n    const { state } = editor\n    const { from } = state.selection\n\n    // Find the code block node position\n    let codeBlockPos: number | null = null\n    let codeBlockNode: typeof state.doc | null = null\n\n    // Traverse up from the current position to find the code block\n    const $pos = state.doc.resolve(from)\n    for (let depth = $pos.depth; depth >= 0; depth--) {\n      const node = $pos.node(depth)\n      if (node.type.name === \"codeBlock\") {\n        codeBlockPos = $pos.before(depth)\n        codeBlockNode = node\n        break\n      }\n    }\n\n    if (codeBlockPos !== null && codeBlockNode) {\n      // Delete the entire code block\n      editor\n        .chain()\n        .focus()\n        .deleteRange({\n          from: codeBlockPos,\n          to: codeBlockPos + codeBlockNode.nodeSize,\n        })\n        .run()\n    }\n  }\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"top-end\",\n        offset: [0, 8],\n        getReferenceClientRect: () => {\n          const { view, state } = editor\n          const { from } = state.selection\n\n          // Find the code block node and get its position\n          let codeBlockPos = from\n          state.doc.nodesBetween(from, from, (node, pos) => {\n            if (node.type.name === \"codeBlock\") {\n              codeBlockPos = pos\n              return false\n            }\n          })\n\n          const domNode = view.nodeDOM(codeBlockPos)\n          if (domNode instanceof HTMLElement) {\n            const preElement = domNode.querySelector(\"pre\") || domNode\n            if (preElement instanceof HTMLElement) {\n              return preElement.getBoundingClientRect()\n            }\n          }\n          return view.dom.getBoundingClientRect()\n        },\n      }}\n      shouldShow={({ editor: e }) => e.isActive(\"codeBlock\")}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {/* Language Selector with Search */}\n        <Popover open={open} onOpenChange={setOpen}>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs font-normal\"\n              role=\"combobox\"\n              aria-expanded={open}\n            >\n              <Code2 className=\"size-3.5\" />\n              {currentLanguageLabel}\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-[200px] p-0\" align=\"start\" sideOffset={8}>\n            <Command>\n              <CommandInput placeholder=\"Search language...\" className=\"h-9\" />\n              <CommandList>\n                <CommandEmpty>No language found.</CommandEmpty>\n                <CommandGroup>\n                  {CODEBLOCK_LANGUAGES.map((lang) => (\n                    <CommandItem\n                      key={lang.value}\n                      value={lang.name}\n                      onSelect={() => handleSelectLanguage(lang.value)}\n                    >\n                      {lang.name}\n                      {currentLanguage === lang.value && (\n                        <Check className=\"ml-auto size-4\" />\n                      )}\n                    </CommandItem>\n                  ))}\n                </CommandGroup>\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n\n        {/* Divider */}\n        <div className=\"bg-border h-4 w-px\" />\n\n        {/* Copy Button */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-7 w-7 p-0\"\n          onClick={handleCopyCode}\n          title={copied ? \"Copied!\" : \"Copy code\"}\n        >\n          {copied ? (\n            <Check className=\"size-3.5 text-green-500\" />\n          ) : (\n            <ClipboardCopy className=\"size-3.5\" />\n          )}\n        </Button>\n\n        {/* Divider */}\n        <div className=\"bg-border h-4 w-px\" />\n\n        {/* Delete Button */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 w-7 p-0\"\n          onClick={handleDelete}\n          title=\"Delete code block\"\n        >\n          <Trash2 className=\"size-3.5\" />\n        </Button>\n      </div>\n    </BubbleMenu>\n  )\n}\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}