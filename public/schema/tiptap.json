{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "tiptap",
  "title": "Tiptap Editor",
  "description": "A fully-featured rich text editor built with Tiptap, including toolbar, bubble menu, floating menu, and image support.",
  "dependencies": [
    "@tiptap/core",
    "@tiptap/react",
    "@tiptap/starter-kit",
    "@tiptap/extension-text-align",
    "@tiptap/extension-typography",
    "@tiptap/extension-underline",
    "@tiptap/extension-code-block-lowlight",
    "@tiptap/extension-table",
    "@tiptap/suggestion",
    "lowlight",
    "lucide-react",
    "tippy.js"
  ],
  "registryDependencies": [
    "button",
    "dropdown-menu",
    "scroll-area",
    "dialog",
    "input"
  ],
  "files": [
    {
      "path": "src/registry/tiptap/tiptap.tsx",
      "content": "\"use client\"\n\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { cn } from \"@/lib/utils\"\nimport { DropdownMenuContent as DropdownMenuContentPrimitive } from \"@radix-ui/react-dropdown-menu\"\nimport { Extension } from \"@tiptap/core\"\nimport { ImageBubbleMenu, TiptapImageExtension } from \"./tiptap-image\"\n\nimport CodeBlockLowlight from \"@tiptap/extension-code-block-lowlight\"\nimport {\n  Table as TiptapTable,\n  TableCell as TiptapTableCell,\n  TableHeader as TiptapTableHeader,\n  TableRow as TiptapTableRow,\n} from \"@tiptap/extension-table\"\n\nimport Highlight from \"@tiptap/extension-highlight\"\nimport Link from \"@tiptap/extension-link\"\nimport Placeholder from \"@tiptap/extension-placeholder\"\nimport TaskItem from \"@tiptap/extension-task-item\"\nimport TaskList from \"@tiptap/extension-task-list\"\nimport { TextAlign } from \"@tiptap/extension-text-align\"\nimport TiptapTypography from \"@tiptap/extension-typography\"\nimport TiptapUnderline from \"@tiptap/extension-underline\"\nimport {\n  BubbleMenu,\n  Editor,\n  EditorContent,\n  FloatingMenu,\n  ReactRenderer,\n  useEditor,\n  UseEditorOptions,\n} from \"@tiptap/react\"\nimport StarterKit from \"@tiptap/starter-kit\"\nimport Suggestion, {\n  SuggestionOptions,\n  SuggestionProps,\n} from \"@tiptap/suggestion\"\nimport { all, createLowlight } from \"lowlight\"\nimport {\n  AlignCenter,\n  AlignJustify,\n  AlignLeft,\n  AlignRight,\n  AlignVerticalJustifyCenter,\n  AlignVerticalJustifyEnd,\n  AlignVerticalJustifyStart,\n  ArrowDownToLine,\n  ArrowLeftToLine,\n  ArrowRightToLine,\n  ArrowUpToLine,\n  Bold,\n  Check,\n  CheckSquare,\n  ChevronDown,\n  ClipboardCopy,\n  Code,\n  Code2,\n  Columns3,\n  Combine,\n  ExternalLink,\n  Heading1,\n  Heading2,\n  Heading3,\n  Heading4,\n  Heading5,\n  Heading6,\n  Highlighter,\n  ImageUp,\n  Italic,\n  Link2,\n  Link2Off,\n  List,\n  ListOrdered,\n  MessageSquare,\n  Minus,\n  Redo,\n  Rows3,\n  Split,\n  Strikethrough,\n  Table,\n  TableProperties,\n  TextQuote,\n  Trash2,\n  Type,\n  Underline,\n  Undo,\n} from \"lucide-react\"\nimport React, {\n  Children,\n  cloneElement,\n  ComponentProps,\n  ComponentType,\n  createContext,\n  Fragment,\n  PropsWithChildren,\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\"\nimport tippy, { Instance as TippyInstance } from \"tippy.js\"\n\n// =============================================================================\n// CodeBlock Extension (inlined from extensions/code-block.tsx)\n// =============================================================================\n\nconst lowlight = createLowlight(all)\n\n// =============================================================================\n// CodeBlock Language Configuration\n// =============================================================================\n\ninterface CodeBlockLanguage {\n  name: string\n  value: string\n}\n\nconst CODEBLOCK_LANGUAGES: CodeBlockLanguage[] = [\n  { name: \"Plain Text\", value: \"plaintext\" },\n  { name: \"JavaScript\", value: \"javascript\" },\n  { name: \"TypeScript\", value: \"typescript\" },\n  { name: \"JSX\", value: \"jsx\" },\n  { name: \"TSX\", value: \"tsx\" },\n  { name: \"HTML\", value: \"html\" },\n  { name: \"CSS\", value: \"css\" },\n  { name: \"SCSS\", value: \"scss\" },\n  { name: \"JSON\", value: \"json\" },\n  { name: \"Markdown\", value: \"markdown\" },\n  { name: \"Python\", value: \"python\" },\n  { name: \"Java\", value: \"java\" },\n  { name: \"C\", value: \"c\" },\n  { name: \"C++\", value: \"cpp\" },\n  { name: \"C#\", value: \"csharp\" },\n  { name: \"Go\", value: \"go\" },\n  { name: \"Rust\", value: \"rust\" },\n  { name: \"Ruby\", value: \"ruby\" },\n  { name: \"PHP\", value: \"php\" },\n  { name: \"Swift\", value: \"swift\" },\n  { name: \"Kotlin\", value: \"kotlin\" },\n  { name: \"Scala\", value: \"scala\" },\n  { name: \"SQL\", value: \"sql\" },\n  { name: \"GraphQL\", value: \"graphql\" },\n  { name: \"Shell\", value: \"bash\" },\n  { name: \"PowerShell\", value: \"powershell\" },\n  { name: \"Docker\", value: \"dockerfile\" },\n  { name: \"YAML\", value: \"yaml\" },\n  { name: \"XML\", value: \"xml\" },\n  { name: \"Diff\", value: \"diff\" },\n]\n\nconst CodeBlock = Extension.create({\n  name: \"codeBlockLowlight\",\n  addExtensions() {\n    return [\n      CodeBlockLowlight.configure({ lowlight, defaultLanguage: \"plaintext\" }),\n    ]\n  },\n})\n\n// =============================================================================\n// Slash Menu Extension\n// =============================================================================\n\nexport interface SlashMenuItem {\n  title: string\n  description: string\n  icon: React.ElementType\n  searchTerms: string[]\n  command: (editor: Editor) => void\n}\n\nconst slashMenuItems: SlashMenuItem[] = [\n  // Basic Blocks\n  {\n    title: \"Text\",\n    description: \"Start writing with plain text\",\n    icon: Type,\n    searchTerms: [\"paragraph\", \"text\", \"plain\"],\n    command: (editor) => editor.chain().focus().setParagraph().run(),\n  },\n  {\n    title: \"Heading 1\",\n    description: \"Large section heading\",\n    icon: Heading1,\n    searchTerms: [\"heading\", \"h1\", \"title\", \"large\"],\n    command: (editor) => editor.chain().focus().setHeading({ level: 1 }).run(),\n  },\n  {\n    title: \"Heading 2\",\n    description: \"Medium section heading\",\n    icon: Heading2,\n    searchTerms: [\"heading\", \"h2\", \"subtitle\", \"medium\"],\n    command: (editor) => editor.chain().focus().setHeading({ level: 2 }).run(),\n  },\n  {\n    title: \"Heading 3\",\n    description: \"Small section heading\",\n    icon: Heading3,\n    searchTerms: [\"heading\", \"h3\", \"small\"],\n    command: (editor) => editor.chain().focus().setHeading({ level: 3 }).run(),\n  },\n  {\n    title: \"Bullet List\",\n    description: \"Create a simple bullet list\",\n    icon: List,\n    searchTerms: [\"bullet\", \"list\", \"unordered\", \"ul\"],\n    command: (editor) => editor.chain().focus().toggleBulletList().run(),\n  },\n  {\n    title: \"Ordered List\",\n    description: \"Create a numbered list\",\n    icon: ListOrdered,\n    searchTerms: [\"ordered\", \"list\", \"numbered\", \"ol\"],\n    command: (editor) => editor.chain().focus().toggleOrderedList().run(),\n  },\n  // Advanced Blocks\n  {\n    title: \"Quote\",\n    description: \"Capture a quote\",\n    icon: TextQuote,\n    searchTerms: [\"quote\", \"blockquote\", \"citation\"],\n    command: (editor) => editor.chain().focus().setBlockquote().run(),\n  },\n  {\n    title: \"Code Block\",\n    description: \"Display code with syntax highlighting\",\n    icon: Code2,\n    searchTerms: [\"code\", \"codeblock\", \"programming\"],\n    command: (editor) => editor.chain().focus().toggleCodeBlock().run(),\n  },\n  {\n    title: \"Horizontal Rule\",\n    description: \"Insert a visual divider\",\n    icon: Minus,\n    searchTerms: [\"divider\", \"hr\", \"horizontal\", \"rule\", \"line\"],\n    command: (editor) => editor.chain().focus().setHorizontalRule().run(),\n  },\n  {\n    title: \"Image\",\n    description: \"Upload or embed an image\",\n    icon: ImageUp,\n    searchTerms: [\"image\", \"picture\", \"photo\", \"media\", \"upload\"],\n    command: (editor) => editor.chain().focus().setImage({ src: null }).run(),\n  },\n  {\n    title: \"Callout\",\n    description: \"Highlight important information\",\n    icon: MessageSquare,\n    searchTerms: [\"callout\", \"note\", \"info\", \"warning\", \"alert\"],\n    command: (editor) =>\n      editor\n        .chain()\n        .focus()\n        .insertContent({\n          type: \"blockquote\",\n          content: [\n            {\n              type: \"paragraph\",\n              content: [{ type: \"text\", text: \"ðŸ’¡ \" }],\n            },\n          ],\n        })\n        .run(),\n  },\n  {\n    title: \"Table\",\n    description: \"Insert a table\",\n    icon: Table,\n    searchTerms: [\"table\", \"grid\", \"spreadsheet\"],\n    command: (editor) =>\n      editor\n        .chain()\n        .focus()\n        .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n        .run(),\n  },\n  {\n    title: \"Todo List\",\n    description: \"Task list with checkboxes\",\n    icon: CheckSquare,\n    searchTerms: [\"todo\", \"task\", \"checkbox\", \"checklist\"],\n    command: (editor) => editor.chain().focus().toggleTaskList().run(),\n  },\n]\n\nfunction filterSlashMenuItems(query: string): SlashMenuItem[] {\n  if (!query) return slashMenuItems\n  const lowerQuery = query.toLowerCase()\n  return slashMenuItems.filter(\n    (item) =>\n      item.title.toLowerCase().includes(lowerQuery) ||\n      item.searchTerms.some((term) => term.includes(lowerQuery))\n  )\n}\n\nexport interface SlashMenuListProps {\n  items: SlashMenuItem[]\n  command: (item: SlashMenuItem) => void\n  editor: Editor\n}\n\nexport interface SlashMenuListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean\n}\n\nexport const SlashMenuList = React.forwardRef<\n  SlashMenuListRef,\n  SlashMenuListProps\n>(({ items, command }, ref) => {\n  const [selectedIndex, setSelectedIndex] = useState(0)\n  const itemRefs = React.useRef<(HTMLButtonElement | null)[]>([])\n\n  const selectItem = (index: number) => {\n    const item = items[index]\n    if (item) command(item)\n  }\n\n  const handleKeyDown = (props: { event: KeyboardEvent }): boolean => {\n    const { event } = props\n    if (event.key === \"ArrowUp\") {\n      setSelectedIndex((prev) => (prev - 1 + items.length) % items.length)\n      return true\n    }\n    if (event.key === \"ArrowDown\") {\n      setSelectedIndex((prev) => (prev + 1) % items.length)\n      return true\n    }\n    if (event.key === \"Enter\") {\n      selectItem(selectedIndex)\n      return true\n    }\n    return false\n  }\n\n  React.useImperativeHandle(ref, () => ({\n    onKeyDown: handleKeyDown,\n  }))\n\n  useEffect(() => {\n    setSelectedIndex(0)\n  }, [items])\n\n  useEffect(() => {\n    const selectedItem = itemRefs.current[selectedIndex]\n    if (selectedItem) {\n      selectedItem.scrollIntoView({ block: \"nearest\", behavior: \"smooth\" })\n    }\n  }, [selectedIndex])\n\n  if (items.length === 0) {\n    return (\n      <div className=\"text-muted-foreground flex items-center justify-center p-4 text-sm\">\n        No results found\n      </div>\n    )\n  }\n\n  return (\n    <ScrollArea\n      style={{\n        height:\n          items.length * Number(itemRefs.current[0]?.offsetHeight ?? 48) + 8,\n      }}\n      className=\"bg-popover max-h-[300px] overflow-auto rounded-md border p-1 shadow-md\"\n    >\n      {items.map((item, index) => (\n        <button\n          key={item.title}\n          ref={(el) => {\n            itemRefs.current[index] = el\n          }}\n          onClick={() => selectItem(index)}\n          className={cn(\n            \"relative flex w-full cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm transition-colors outline-none select-none\",\n            \"min-w-[256px]\",\n            index === selectedIndex\n              ? \"bg-accent text-accent-foreground\"\n              : \"hover:bg-accent hover:text-accent-foreground\"\n          )}\n        >\n          <div\n            className=\"border-border bg-background/40 flex size-8 items-center justify-center rounded-lg border\"\n            aria-hidden=\"true\"\n          >\n            <item.icon size={16} strokeWidth={2} className=\"opacity-60\" />\n          </div>\n          <div className=\"flex flex-col items-start\">\n            <span className=\"text-sm font-medium\">{item.title}</span>\n            <span className=\"text-muted-foreground text-xs\">\n              {item.description}\n            </span>\n          </div>\n        </button>\n      ))}\n    </ScrollArea>\n  )\n})\nSlashMenuList.displayName = \"SlashMenuList\"\n\ninterface SlashMenuSuggestionOptions {\n  editor: Editor\n}\n\nfunction createSlashMenuSuggestion(): Omit<\n  SuggestionOptions<SlashMenuItem>,\n  \"editor\"\n> {\n  return {\n    char: \"/\",\n    items: ({ query }) => filterSlashMenuItems(query),\n    render: () => {\n      let component: ReactRenderer<SlashMenuListRef> | null = null\n      let popup: TippyInstance[] | null = null\n\n      return {\n        onStart: (props: SuggestionProps<SlashMenuItem>) => {\n          component = new ReactRenderer(SlashMenuList, {\n            props: {\n              ...props,\n              command: (item: SlashMenuItem) => {\n                props.command(item)\n              },\n            },\n            editor: props.editor,\n          })\n\n          if (!props.clientRect) return\n\n          popup = tippy(\"body\", {\n            getReferenceClientRect: props.clientRect as () => DOMRect,\n            appendTo: () => document.body,\n            content: component.element,\n            showOnCreate: true,\n            interactive: true,\n            trigger: \"manual\",\n            placement: \"bottom-start\",\n          })\n        },\n        onUpdate: (props: SuggestionProps<SlashMenuItem>) => {\n          component?.updateProps({\n            ...props,\n            command: (item: SlashMenuItem) => {\n              props.command(item)\n            },\n          })\n\n          if (!props.clientRect || !popup?.[0]) return\n\n          popup[0].setProps({\n            getReferenceClientRect: props.clientRect as () => DOMRect,\n          })\n        },\n        onKeyDown: (props: { event: KeyboardEvent }): boolean => {\n          if (props.event.key === \"Escape\") {\n            popup?.[0]?.hide()\n            return true\n          }\n          return component?.ref?.onKeyDown(props) ?? false\n        },\n        onExit: () => {\n          popup?.[0]?.destroy()\n          component?.destroy()\n        },\n      }\n    },\n    command: ({ editor, range, props }) => {\n      // Delete the \"/\" trigger and any query text\n      editor.chain().focus().deleteRange(range).run()\n      // Execute the selected command\n      props.command(editor)\n    },\n  }\n}\n\nexport const SlashMenuExtension = Extension.create({\n  name: \"slashMenu\",\n\n  addOptions() {\n    return {\n      suggestion: createSlashMenuSuggestion(),\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      Suggestion({\n        editor: this.editor,\n        ...this.options.suggestion,\n      }),\n    ]\n  },\n})\n\nconst extensions = [\n  /**\n   * >Nodes\n   * Blockquote, BulletList, CodeBlock, Document, HardBreak, Heading,\n   * HorizontalRule, ListItem, OrderedList, Paragraph, Text\n   *\n   * >Marks\n   * Bold, Code, Italic, Strike\n   *\n   * >Extensions\n   * Dropcursor, Gapcursor, History\n   * @reference https://tiptap.dev/api/extensions/starter-kit\n   */\n  StarterKit,\n\n  /**\n   * @reference https://tiptap.dev/docs/editor/extensions/marks/underline\n   */\n  TiptapUnderline.configure({\n    HTMLAttributes: {\n      class: \"underline underline-offset-4\",\n    },\n  }),\n\n  /**\n   * @reference https://tiptap.dev/api/extensions/text-align\n   */\n  TextAlign.configure({\n    types: [\"heading\", \"paragraph\", \"blockquote\", \"bulletList\", \"orderedList\"],\n  }),\n\n  /**\n   * @reference https://tiptap.dev/api/extensions/typography\n   */\n  TiptapTypography.configure({}),\n\n  /**\n   * @description Allow to format text as code block with syntax highlighting, lowlight\n   * @reference @/registry/editor/extensions/code-block.tsx\n   */\n  CodeBlock.configure({}),\n\n  /**\n   * @description Inline image block with upload UI\n   * @reference @/registry/editor/tiptap-image.tsx\n   */\n  TiptapImageExtension.configure({}),\n\n  /**\n   * @description Slash Menu for inserting blocks via \"/\" trigger\n   * @reference Notion-style slash commands\n   */\n  SlashMenuExtension.configure({}),\n\n  /**\n   * @description Table support with resizable columns\n   * @reference https://tiptap.dev/docs/editor/extensions/nodes/table\n   */\n  TiptapTable.configure({\n    resizable: true,\n    HTMLAttributes: {\n      class: \"w-full caption-bottom text-sm my-4 border border-border\",\n    },\n  }),\n  TiptapTableRow.configure({\n    HTMLAttributes: {\n      class:\n        \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n    },\n  }),\n  TiptapTableHeader.extend({\n    addAttributes() {\n      return {\n        ...this.parent?.(),\n        textAlign: {\n          default: null,\n          parseHTML: (element) =>\n            element.style.textAlign || element.getAttribute(\"data-text-align\"),\n          renderHTML: (attributes) => {\n            if (!attributes.textAlign) return {}\n            return {\n              style: `text-align: ${attributes.textAlign}`,\n              \"data-text-align\": attributes.textAlign,\n            }\n          },\n        },\n        verticalAlign: {\n          default: null,\n          parseHTML: (element) =>\n            element.style.verticalAlign ||\n            element.getAttribute(\"data-vertical-align\"),\n          renderHTML: (attributes) => {\n            if (!attributes.verticalAlign) return {}\n            return {\n              style: `vertical-align: ${attributes.verticalAlign}`,\n              \"data-vertical-align\": attributes.verticalAlign,\n            }\n          },\n        },\n      }\n    },\n  }).configure({\n    HTMLAttributes: {\n      class:\n        \"h-10 px-2 text-left align-middle font-medium text-muted-foreground border-b border-r last:border-r-none bg-muted/10 [&>p]:m-0\",\n    },\n  }),\n  TiptapTableCell.extend({\n    addAttributes() {\n      return {\n        ...this.parent?.(),\n        textAlign: {\n          default: null,\n          parseHTML: (element) =>\n            element.style.textAlign || element.getAttribute(\"data-text-align\"),\n          renderHTML: (attributes) => {\n            if (!attributes.textAlign) return {}\n            return {\n              style: `text-align: ${attributes.textAlign}`,\n              \"data-text-align\": attributes.textAlign,\n            }\n          },\n        },\n        verticalAlign: {\n          default: null,\n          parseHTML: (element) =>\n            element.style.verticalAlign ||\n            element.getAttribute(\"data-vertical-align\"),\n          renderHTML: (attributes) => {\n            if (!attributes.verticalAlign) return {}\n            return {\n              style: `vertical-align: ${attributes.verticalAlign}`,\n              \"data-vertical-align\": attributes.verticalAlign,\n            }\n          },\n        },\n      }\n    },\n  }).configure({\n    HTMLAttributes: {\n      class:\n        \"p-2 align-middle border-b [&:not(:last-child)]:border-r [&>p]:m-0\",\n    },\n  }),\n\n  /**\n   * @description Link support for hyperlinks\n   * @reference https://tiptap.dev/docs/editor/extensions/marks/link\n   */\n  Link.configure({\n    openOnClick: false,\n    HTMLAttributes: {\n      class:\n        \"text-primary underline underline-offset-4 hover:text-primary/80 cursor-pointer\",\n    },\n  }),\n\n  /**\n   * @description Task list with checkboxes\n   * @reference https://tiptap.dev/docs/editor/extensions/nodes/task-list\n   */\n  TaskList.configure({\n    HTMLAttributes: {\n      class: \"not-prose pl-0 list-none\",\n    },\n  }),\n  TaskItem.configure({\n    nested: true,\n    HTMLAttributes: {\n      class: \"flex items-start gap-2 [&>label]:mt-0.5\",\n    },\n  }),\n\n  /**\n   * @description Placeholder text for empty editor\n   * @reference https://tiptap.dev/docs/editor/extensions/functionality/placeholder\n   */\n  Placeholder.configure({\n    placeholder: ({ node }) => {\n      if (node.type.name === \"heading\") {\n        return `Heading ${node.attrs.level}`\n      }\n      return \"Type '/' for commands...\"\n    },\n    emptyEditorClass: \"is-editor-empty\",\n    emptyNodeClass: \"is-empty\",\n  }),\n\n  /**\n   * @description Highlight text with background color\n   * @reference https://tiptap.dev/docs/editor/extensions/marks/highlight\n   */\n  Highlight.configure({\n    multicolor: false,\n    HTMLAttributes: {\n      class: \"bg-yellow-200 dark:bg-yellow-500 px-0.5 rounded\",\n    },\n  }),\n]\n\nconst editorStyles = `\n  /* ==========================================================================\n     Syntax Highlighting Theme (GitHub Dark-inspired)\n     ========================================================================== */\n  /* Comments */\n  .ProseMirror .hljs-comment,\n  .ProseMirror .hljs-quote {\n    color: hsl(215 12% 50%);\n    font-style: italic;\n  }\n\n  /* Keywords & Tags */\n  .ProseMirror .hljs-keyword,\n  .ProseMirror .hljs-selector-tag {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Strings & Regex */\n  .ProseMirror .hljs-string,\n  .ProseMirror .hljs-regexp,\n  .ProseMirror .hljs-attribute,\n  .ProseMirror .hljs-template-variable,\n  .ProseMirror .hljs-variable.language_ {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Numbers */\n  .ProseMirror .hljs-number,\n  .ProseMirror .hljs-literal {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Functions & Classes */\n  .ProseMirror .hljs-title,\n  .ProseMirror .hljs-title.class_,\n  .ProseMirror .hljs-title.function_ {\n    color: hsl(260 83% 79%);\n  }\n\n  /* Built-in & Types */\n  .ProseMirror .hljs-built_in,\n  .ProseMirror .hljs-type {\n    color: hsl(29 67% 75%);\n  }\n\n  /* Variables & Params */\n  .ProseMirror .hljs-variable,\n  .ProseMirror .hljs-params {\n    color: hsl(210 14% 93%);\n  }\n\n  /* Properties & Attributes */\n  .ProseMirror .hljs-attr,\n  .ProseMirror .hljs-property {\n    color: hsl(212 97% 81%);\n  }\n\n  /* Symbols & Bullets */\n  .ProseMirror .hljs-symbol,\n  .ProseMirror .hljs-bullet {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Meta & Preprocessor */\n  .ProseMirror .hljs-meta,\n  .ProseMirror .hljs-meta .hljs-keyword {\n    color: hsl(350 89% 72%);\n  }\n\n  /* Links */\n  .ProseMirror .hljs-link {\n    color: hsl(212 97% 81%);\n    text-decoration: underline;\n  }\n\n  /* Deletion (diff) */\n  .ProseMirror .hljs-deletion {\n    color: hsl(350 89% 72%);\n    background: hsl(350 89% 72% / 0.15);\n  }\n\n  /* Addition (diff) */\n  .ProseMirror .hljs-addition {\n    color: hsl(139 66% 69%);\n    background: hsl(139 66% 69% / 0.15);\n  }\n\n  /* Section */\n  .ProseMirror .hljs-section {\n    color: hsl(212 97% 81%);\n    font-weight: bold;\n  }\n\n  /* Emphasis */\n  .ProseMirror .hljs-emphasis {\n    font-style: italic;\n  }\n\n  /* Strong */\n  .ProseMirror .hljs-strong {\n    font-weight: bold;\n  }\n\n  /* Punctuation */\n  .ProseMirror .hljs-punctuation {\n    color: hsl(210 14% 66%);\n  }\n\n  /* ==========================================================================\n     Complex Pseudo-element Styles (cannot be expressed in Tailwind)\n     ========================================================================== */\n  /* Pre code reset */\n  .ProseMirror pre code {\n    background: transparent;\n    padding: 0;\n    font-size: inherit;\n    color: inherit;\n    font-family: inherit;\n  }\n\n  /* Selected cell overlay */\n  .ProseMirror table .selectedCell::after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    background: var(--primary);\n    opacity: 0.08;\n    pointer-events: none;\n  }\n\n  /* Heading placeholders */\n  .ProseMirror h1.is-empty::before,\n  .ProseMirror h2.is-empty::before,\n  .ProseMirror h3.is-empty::before,\n  .ProseMirror h4.is-empty::before,\n  .ProseMirror h5.is-empty::before,\n  .ProseMirror h6.is-empty::before {\n    color: var(--muted-foreground);\n    content: attr(data-placeholder);\n    float: left;\n    height: 0;\n    pointer-events: none;\n  }\n`\n\nconst tiptapActions = {\n  // @tiptap/starter-kit\n  undo: \"undo\",\n  redo: \"redo\",\n  bold: \"bold\",\n  italic: \"italic\",\n  strike: \"strike\",\n  code: \"code\",\n  divider: \"divider\",\n  heading1: \"heading1\",\n  heading2: \"heading2\",\n  heading3: \"heading3\",\n  heading4: \"heading4\",\n  heading5: \"heading5\",\n  heading6: \"heading6\",\n  text: \"paragraph\",\n  blockquote: \"blockquote\",\n  bulletList: \"bulletList\",\n  orderedList: \"orderedList\",\n  codeBlock: \"codeBlock\",\n  // @tiptap/extension-underline\n  underline: \"underline\",\n  // @/registry/editor/extensions/text-align.tsx\n  left: \"left\",\n  center: \"center\",\n  right: \"right\",\n  justify: \"justify\",\n  // @/registry/editor/extensions/image.tsx\n  image: \"image\",\n  // @tiptap/extension-table\n  insertTable: \"insertTable\",\n  addColumnBefore: \"addColumnBefore\",\n  addColumnAfter: \"addColumnAfter\",\n  deleteColumn: \"deleteColumn\",\n  addRowBefore: \"addRowBefore\",\n  addRowAfter: \"addRowAfter\",\n  deleteRow: \"deleteRow\",\n  deleteTable: \"deleteTable\",\n  mergeCells: \"mergeCells\",\n  splitCell: \"splitCell\",\n  toggleHeaderColumn: \"toggleHeaderColumn\",\n  toggleHeaderRow: \"toggleHeaderRow\",\n  toggleHeaderCell: \"toggleHeaderCell\",\n  mergeOrSplit: \"mergeOrSplit\",\n  goToNextCell: \"goToNextCell\",\n  goToPreviousCell: \"goToPreviousCell\",\n  // @tiptap/extension-task-list\n  taskList: \"taskList\",\n  // @tiptap/extension-highlight\n  highlight: \"highlight\",\n  // @tiptap/extension-link\n  setLink: \"setLink\",\n  unsetLink: \"unsetLink\",\n} as const\n\nconst tiptapTextAlignActiveActions = [\n  tiptapActions.left,\n  tiptapActions.center,\n  tiptapActions.right,\n  tiptapActions.justify,\n] as TiptapAction[]\n\ntype TiptapAction = (typeof tiptapActions)[keyof typeof tiptapActions]\n\ntype TiptapBlock = {\n  key: TiptapAction\n  icon: React.ElementType\n  label: string\n  description: string\n\n  /**\n   * @description Optional component to render when the action is selected\n   * @example const ImageWidget = () => JSX.Element\n   */\n  widget?: ComponentType<any>\n\n  /**\n   * @description Optional event to dispatch when the action is selected\n   * @example const ImageEvent = new Event(\"tiptap:image\")\n   */\n  event?: Event\n}\n\nconst tiptapBlocksMap = new Map<TiptapAction, TiptapBlock>([\n  [\n    tiptapActions.undo,\n    {\n      key: tiptapActions.undo,\n      icon: Undo,\n      label: \"Undo\",\n      description: \"Undo the last action\",\n    },\n  ],\n  [\n    tiptapActions.redo,\n    {\n      key: tiptapActions.redo,\n      icon: Redo,\n      label: \"Redo\",\n      description: \"Redo the last action\",\n    },\n  ],\n  [\n    tiptapActions.text,\n    {\n      key: tiptapActions.text,\n      icon: Type,\n      label: \"Text\",\n      description: \"Start writing with plain text\",\n    },\n  ],\n  [\n    tiptapActions.heading1,\n    {\n      key: tiptapActions.heading1,\n      icon: Heading1,\n      label: \"Heading 1\",\n      description: \"Use this for main titles\",\n    },\n  ],\n  [\n    tiptapActions.heading2,\n    {\n      key: tiptapActions.heading2,\n      icon: Heading2,\n      label: \"Heading 2\",\n      description: \"Ideal for subsections\",\n    },\n  ],\n  [\n    tiptapActions.heading3,\n    {\n      key: tiptapActions.heading3,\n      icon: Heading3,\n      label: \"Heading 3\",\n      description: \"Use for smaller subsections\",\n    },\n  ],\n  [\n    tiptapActions.heading4,\n    {\n      key: tiptapActions.heading4,\n      icon: Heading4,\n      label: \"Heading 4\",\n      description: \"Suitable for detailed sections\",\n    },\n  ],\n  [\n    tiptapActions.heading5,\n    {\n      key: tiptapActions.heading5,\n      icon: Heading5,\n      label: \"Heading 5\",\n      description: \"For minor details\",\n    },\n  ],\n  [\n    tiptapActions.heading6,\n    {\n      key: tiptapActions.heading6,\n      icon: Heading6,\n      label: \"Heading 6\",\n      description: \"Use for the smallest details\",\n    },\n  ],\n  [\n    tiptapActions.blockquote,\n    {\n      key: tiptapActions.blockquote,\n      icon: TextQuote,\n      label: \"Quote\",\n      description: \"Capture a quote\",\n    },\n  ],\n  [\n    tiptapActions.bold,\n    {\n      key: tiptapActions.bold,\n      icon: Bold,\n      label: \"Bold\",\n      description: \"Make text bold\",\n    },\n  ],\n  [\n    tiptapActions.italic,\n    {\n      key: tiptapActions.italic,\n      icon: Italic,\n      label: \"Italic\",\n      description: \"Italicize text\",\n    },\n  ],\n  [\n    tiptapActions.underline,\n    {\n      key: tiptapActions.underline,\n      icon: Underline,\n      label: \"Underline\",\n      description: \"Underline text\",\n    },\n  ],\n  [\n    tiptapActions.strike,\n    {\n      key: tiptapActions.strike,\n      icon: Strikethrough,\n      label: \"Strikethrough\",\n      description: \"Strike through text\",\n    },\n  ],\n  [\n    tiptapActions.code,\n    {\n      key: tiptapActions.code,\n      icon: Code,\n      label: \"Code\",\n      description: \"Format text as code\",\n    },\n  ],\n  [\n    tiptapActions.codeBlock,\n    {\n      key: tiptapActions.codeBlock,\n      icon: Code2,\n      label: \"Code Block\",\n      description: \"Format text as code block\",\n    },\n  ],\n  [\n    tiptapActions.divider,\n    {\n      key: tiptapActions.divider,\n      icon: Minus,\n      label: \"Divider\",\n      description: \"Visually divide blocks\",\n    },\n  ],\n  [\n    tiptapActions.bulletList,\n    {\n      key: tiptapActions.bulletList,\n      icon: List,\n      label: \"Bullet List\",\n      description: \"Create a bullet list\",\n    },\n  ],\n  [\n    tiptapActions.orderedList,\n    {\n      key: tiptapActions.orderedList,\n      icon: ListOrdered,\n      label: \"Ordered List\",\n      description: \"Create an ordered list\",\n    },\n  ],\n  [\n    tiptapActions.left,\n    {\n      key: tiptapActions.left,\n      icon: AlignLeft,\n      label: \"Left\",\n      description: \"Align text to the left\",\n    },\n  ],\n  [\n    tiptapActions.center,\n    {\n      key: tiptapActions.center,\n      icon: AlignCenter,\n      label: \"Center\",\n      description: \"Align text to the center\",\n    },\n  ],\n  [\n    tiptapActions.right,\n    {\n      key: tiptapActions.right,\n      icon: AlignRight,\n      label: \"Right\",\n      description: \"Align text to the right\",\n    },\n  ],\n  [\n    tiptapActions.justify,\n    {\n      key: tiptapActions.justify,\n      icon: AlignJustify,\n      label: \"Justify\",\n      description: \"Align text to the justify\",\n    },\n  ],\n  [\n    tiptapActions.image,\n    {\n      key: tiptapActions.image,\n      icon: ImageUp,\n      label: \"Image\",\n      description: \"Upload or embed an image\",\n    },\n  ],\n  // Table actions\n  [\n    tiptapActions.insertTable,\n    {\n      key: tiptapActions.insertTable,\n      icon: Table,\n      label: \"Table\",\n      description: \"Insert a table\",\n    },\n  ],\n  [\n    tiptapActions.addColumnBefore,\n    {\n      key: tiptapActions.addColumnBefore,\n      icon: ArrowLeftToLine,\n      label: \"Insert Column Before\",\n      description: \"Add a column before current\",\n    },\n  ],\n  [\n    tiptapActions.addColumnAfter,\n    {\n      key: tiptapActions.addColumnAfter,\n      icon: ArrowRightToLine,\n      label: \"Insert Column After\",\n      description: \"Add a column after current\",\n    },\n  ],\n  [\n    tiptapActions.deleteColumn,\n    {\n      key: tiptapActions.deleteColumn,\n      icon: Columns3,\n      label: \"Delete Column\",\n      description: \"Remove current column\",\n    },\n  ],\n  [\n    tiptapActions.addRowBefore,\n    {\n      key: tiptapActions.addRowBefore,\n      icon: ArrowUpToLine,\n      label: \"Insert Row Before\",\n      description: \"Add a row above current\",\n    },\n  ],\n  [\n    tiptapActions.addRowAfter,\n    {\n      key: tiptapActions.addRowAfter,\n      icon: ArrowDownToLine,\n      label: \"Insert Row After\",\n      description: \"Add a row below current\",\n    },\n  ],\n  [\n    tiptapActions.deleteRow,\n    {\n      key: tiptapActions.deleteRow,\n      icon: Rows3,\n      label: \"Delete Row\",\n      description: \"Remove current row\",\n    },\n  ],\n  [\n    tiptapActions.mergeCells,\n    {\n      key: tiptapActions.mergeCells,\n      icon: Combine,\n      label: \"Merge Cells\",\n      description: \"Merge selected cells\",\n    },\n  ],\n  [\n    tiptapActions.splitCell,\n    {\n      key: tiptapActions.splitCell,\n      icon: Split,\n      label: \"Split Cell\",\n      description: \"Split merged cell\",\n    },\n  ],\n  [\n    tiptapActions.toggleHeaderRow,\n    {\n      key: tiptapActions.toggleHeaderRow,\n      icon: TableProperties,\n      label: \"Toggle Header Row\",\n      description: \"Toggle first row as header\",\n    },\n  ],\n  [\n    tiptapActions.toggleHeaderColumn,\n    {\n      key: tiptapActions.toggleHeaderColumn,\n      icon: TableProperties,\n      label: \"Toggle Header Column\",\n      description: \"Toggle first column as header\",\n    },\n  ],\n  [\n    tiptapActions.deleteTable,\n    {\n      key: tiptapActions.deleteTable,\n      icon: Trash2,\n      label: \"Delete Table\",\n      description: \"Remove entire table\",\n    },\n  ],\n  // Task list\n  [\n    tiptapActions.taskList,\n    {\n      key: tiptapActions.taskList,\n      icon: CheckSquare,\n      label: \"Task List\",\n      description: \"Create a task list with checkboxes\",\n    },\n  ],\n  // Highlight\n  [\n    tiptapActions.highlight,\n    {\n      key: tiptapActions.highlight,\n      icon: Highlighter,\n      label: \"Highlight\",\n      description: \"Highlight selected text\",\n    },\n  ],\n  // Links\n  [\n    tiptapActions.setLink,\n    {\n      key: tiptapActions.setLink,\n      icon: Link2,\n      label: \"Add Link\",\n      description: \"Insert a hyperlink\",\n    },\n  ],\n  [\n    tiptapActions.unsetLink,\n    {\n      key: tiptapActions.unsetLink,\n      icon: Link2Off,\n      label: \"Remove Link\",\n      description: \"Remove the hyperlink\",\n    },\n  ],\n])\n\nconst tiptapAllBlocks = Array.from(tiptapBlocksMap.values())\n\nexport interface TipTapContextType {\n  editor: Editor\n}\n\nexport const TipTapContext = createContext<TipTapContextType>(\n  {} as TipTapContextType\n)\n\nexport const useTiptapEditor = () => {\n  const ctx = useContext(TipTapContext)\n\n  if (!ctx)\n    throw new Error(\"useTiptapEditor must be used within a TiptapEditor\")\n\n  return ctx\n}\n\nexport interface TiptapEditorProps extends PropsWithChildren, UseEditorOptions {\n  content: string\n  floatingMenu?: React.ReactNode\n  bubbleMenu?: React.ReactNode\n}\n\nexport const TiptapEditor = ({\n  content,\n  floatingMenu,\n  bubbleMenu,\n  children,\n  ...editorProps\n}: TiptapEditorProps) => {\n  const editor = useEditor({\n    content,\n    extensions,\n    ...editorProps,\n  })\n\n  const sharedValues = useMemo<TipTapContextType>(\n    () => ({ editor: editor! }),\n    [editor?.state]\n  )\n\n  return (\n    <TipTapContext.Provider value={sharedValues}>\n      <style>{editorStyles}</style>\n      {children}\n\n      {floatingMenu}\n      {bubbleMenu}\n    </TipTapContext.Provider>\n  )\n}\n\nexport interface TiptapLabelProps extends ComponentProps<\"div\"> {\n  action?: TiptapAction\n  label: \":icon :label\" | \":label\" | \":label :icon\" | \":icon\"\n}\n\nexport const TiptapLabel = ({\n  className,\n  action,\n  label: labelPattern = \":label\",\n  ...props\n}: TiptapLabelProps) => {\n  const ctx = useContext(TipTapDropdownContext)\n\n  const keyLabels = useTiptapEditorCurrentActionKeys()\n\n  const tiptapBlocks = useMemo(() => {\n    const filteredKeyLabels = ctx?.sharedBlocks?.length\n      ? keyLabels.filter((k) => ctx?.sharedBlocks.find((b) => b.key === k))\n      : keyLabels\n\n    return filteredKeyLabels.map((key) => tiptapBlocksMap.get(key)!)\n  }, [keyLabels, ctx])\n\n  const getLabelNode = (block: TiptapBlock) => {\n    if (labelPattern === \":icon :label\") {\n      return (\n        <Fragment key={block.key}>\n          {block?.icon ? <block.icon className=\"size-4\" /> : null}{\" \"}\n          {block?.label}\n        </Fragment>\n      )\n    }\n\n    if (labelPattern === \":icon\") {\n      return (\n        <Fragment key={block.key}>\n          {block?.icon ? <block.icon className=\"size-4\" /> : null}\n        </Fragment>\n      )\n    }\n\n    if (labelPattern === \":label :icon\") {\n      return (\n        <Fragment key={block.key}>\n          {block?.label}{\" \"}\n          {block?.icon ? <block.icon className=\"size-4\" /> : null}\n        </Fragment>\n      )\n    }\n\n    return block?.label\n  }\n\n  const label = useMemo(() => {\n    if (action) {\n      const block = tiptapBlocksMap.get(action)\n\n      if (!block) return null\n\n      return getLabelNode(block)\n    }\n\n    return tiptapBlocks.map(getLabelNode)\n  }, [action, tiptapBlocks])\n\n  return (\n    <span\n      {...props}\n      className={cn(\"inline-flex items-center gap-2\", className)}\n    >\n      {Children.count(label) !== 0 ? label : getLabelNode(ctx?.sharedBlocks[0])}\n    </span>\n  )\n}\n\nexport interface TiptapButtonProps extends ComponentProps<typeof Button> {\n  action: TiptapAction\n}\n\nexport const TiptapButton = ({\n  action,\n  children,\n  className,\n  ...props\n}: TiptapButtonProps) => {\n  const { editor } = useTiptapEditor()\n\n  const isActive = useTiptapEditorIsActive(action)\n\n  const handleOnClick = () => {\n    const dispatchEventHandler = () => {\n      const customEvt = tiptapBlocksMap.get(action)?.event\n      if (customEvt) {\n        document.dispatchEvent(customEvt)\n      }\n    }\n\n    switch (action) {\n      case tiptapActions.image:\n        dispatchEventHandler()\n        break\n      default:\n        onTiptapEventChangeBlock(editor, action)\n    }\n  }\n\n  const block = useMemo(() => tiptapBlocksMap.get(action), [action])\n\n  if (!editor) return null\n\n  return (\n    <>\n      <Button\n        variant={isActive ? \"secondary\" : \"ghost\"}\n        size=\"icon\"\n        type=\"button\"\n        {...props}\n        className={cn(\"size-8 w-auto min-w-8 px-2\", className)}\n        onClick={handleOnClick}\n        aria-label={block?.label}\n        disabled={!canUseAction(editor, action)}\n      >\n        {cloneElement(children as ReactElement, { action } as any)}\n      </Button>\n      {block?.widget ? <block.widget /> : null}\n    </>\n  )\n}\n\nexport const TiptapDivider = (props: ComponentProps<\"span\">) => {\n  const { editor } = useTiptapEditor()\n\n  if (!editor) return null\n\n  return (\n    <span {...props} className=\"text-border inline-flex items-center gap-2\">\n      |\n    </span>\n  )\n}\n\nexport interface TipTapDropdownContextType {\n  sharedBlocks: TiptapBlock[]\n}\n\nexport const TipTapDropdownContext = createContext<TipTapDropdownContextType>({\n  sharedBlocks: [],\n} as TipTapDropdownContextType)\n\nexport interface TiptapDropdownProps extends ComponentProps<\n  typeof DropdownMenu\n> {\n  actions: TiptapAction[]\n}\n\nexport const TiptapDropdown = ({\n  actions = tiptapAllBlocks.map((block) => block.key),\n  children,\n  ...props\n}: TiptapDropdownProps) => {\n  const { editor } = useTiptapEditor()\n\n  const handleChangeBlock = (key: TiptapAction) => {\n    onTiptapEventChangeBlock(editor, key)\n  }\n\n  const filteredBlocks = actions.map((action) => tiptapBlocksMap.get(action)!)\n\n  const sharedValues = useMemo<TipTapDropdownContextType>(\n    () => ({ sharedBlocks: filteredBlocks }),\n    [filteredBlocks]\n  )\n\n  if (!editor) return null\n\n  return (\n    <TipTapDropdownContext.Provider value={sharedValues}>\n      <DropdownMenu {...props}>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"shadow-none\"\n            aria-label=\"Open blocks menu\"\n          >\n            {children}\n\n            <ChevronDown className=\"text-muted-foreground ml-1 size-3\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent className=\"pb-2\">\n          <ScrollArea\n            style={{\n              height: filteredBlocks.length * (48 + 8),\n            }}\n            className=\"max-h-[300px] overflow-auto\"\n          >\n            {filteredBlocks.map((item) => (\n              <DropdownMenuItem\n                key={item.label}\n                onClick={() => handleChangeBlock(item.key)}\n              >\n                <div\n                  className=\"border-border bg-background flex size-8 items-center justify-center rounded-lg border\"\n                  aria-hidden=\"true\"\n                >\n                  <item.icon size={16} strokeWidth={2} className=\"opacity-60\" />\n                </div>\n                <div>\n                  <div className=\"text-sm font-medium\">{item.label}</div>\n                  <div className=\"text-muted-foreground text-xs\">\n                    {item.description}\n                  </div>\n                </div>\n              </DropdownMenuItem>\n            ))}\n          </ScrollArea>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </TipTapDropdownContext.Provider>\n  )\n}\n\nexport interface TiptapToolbarProps extends ComponentProps<\"div\"> { }\n\nexport const TiptapToolbar = ({ className, ...props }: TiptapToolbarProps) => (\n  <div\n    {...props}\n    className={cn(\"flex flex-row items-center gap-2\", className)}\n  />\n)\n\nexport interface TiptapContentProps extends Omit<\n  ComponentProps<typeof EditorContent>,\n  \"editor\"\n> { }\n\nexport const TiptapContent = ({ className, ...props }: TiptapContentProps) => {\n  const { editor } = useContext(TipTapContext)\n\n  if (!editor) return null\n\n  return (\n    <EditorContent\n      {...props}\n      className={cn(\n        \"w-full\",\n        \"[&>*]:outline-none\",\n        // Code block styles\n        \"[&_.ProseMirror_pre]:bg-[oklch(0.2147_0.0058_285.9)]\",\n        \"[&_.ProseMirror_pre]:border\",\n        \"[&_.ProseMirror_pre]:border-border\",\n        \"[&_.ProseMirror_pre]:rounded-lg\",\n        \"[&_.ProseMirror_pre]:p-4\",\n        \"[&_.ProseMirror_pre]:my-4\",\n        \"[&_.ProseMirror_pre]:overflow-x-auto\",\n        \"[&_.ProseMirror_pre]:font-mono\",\n        \"[&_.ProseMirror_pre]:text-sm\",\n        \"[&_.ProseMirror_pre]:leading-relaxed\",\n        \"[&_.ProseMirror_pre]:text-[hsl(210_14%_83%)]\",\n        // Inline code styles\n        \"[&_.ProseMirror_code]:bg-muted\",\n        \"[&_.ProseMirror_code]:rounded\",\n        \"[&_.ProseMirror_code]:px-1.5\",\n        \"[&_.ProseMirror_code]:py-0.5\",\n        \"[&_.ProseMirror_code]:font-mono\",\n        \"[&_.ProseMirror_code]:text-[0.875em]\",\n        // Table styles\n        \"[&_.ProseMirror_table]:border-spacing-0\",\n        \"[&_.ProseMirror_table]:border-collapse\",\n        \"[&_.ProseMirror_table]:table-fixed\",\n        \"[&_.ProseMirror_table]:w-full\",\n        \"[&_.ProseMirror_table]:overflow-hidden\",\n        \"[&_.ProseMirror_table_td]:min-w-4\",\n        \"[&_.ProseMirror_table_td]:box-border\",\n        \"[&_.ProseMirror_table_td]:relative\",\n        \"[&_.ProseMirror_table_td]:align-top\",\n        \"[&_.ProseMirror_table_th]:min-w-4\",\n        \"[&_.ProseMirror_table_th]:box-border\",\n        \"[&_.ProseMirror_table_th]:relative\",\n        \"[&_.ProseMirror_table_th]:align-top\",\n        \"[&_.ProseMirror_table_th]:font-medium\",\n        \"[&_.ProseMirror_table_.selectedCell]:bg-secondary/5\",\n        // Table wrapper\n        \"[&_.ProseMirror_.tableWrapper]:overflow-x-auto\",\n        \"[&_.ProseMirror_.tableWrapper]:my-4\",\n        \"[&_.ProseMirror_.tableWrapper_>_table_>_colgroup]:border\",\n        \"[&_.ProseMirror_.tableWrapper_>_table_>_colgroup]:border-border\",\n        // Column resize handle\n        \"[&_.ProseMirror_.column-resize-handle]:absolute\",\n        \"[&_.ProseMirror_.column-resize-handle]:-right-0.5\",\n        \"[&_.ProseMirror_.column-resize-handle]:top-0\",\n        \"[&_.ProseMirror_.column-resize-handle]:-bottom-0.5\",\n        \"[&_.ProseMirror_.column-resize-handle]:w-1\",\n        \"[&_.ProseMirror_.column-resize-handle]:bg-primary\",\n        \"[&_.ProseMirror_.column-resize-handle]:cursor-col-resize\",\n        \"[&_.ProseMirror_.column-resize-handle]:z-20\",\n        // Resize cursor\n        \"[&_.ProseMirror.resize-cursor]:cursor-col-resize\",\n        // Placeholder styles (paragraph)\n        \"[&_.ProseMirror_p.is-empty]:before:text-muted-foreground\",\n        \"[&_.ProseMirror_p.is-empty]:before:content-[attr(data-placeholder)]\",\n        \"[&_.ProseMirror_p.is-empty]:before:float-left\",\n        \"[&_.ProseMirror_p.is-empty]:before:h-0\",\n        \"[&_.ProseMirror_p.is-empty]:before:pointer-events-none\",\n        // Task list styles\n        \"[&_.ProseMirror_ul[data-type=taskList]]:list-none\",\n        \"[&_.ProseMirror_ul[data-type=taskList]]:pl-0\",\n        \"[&_.ProseMirror_ul[data-type=taskList]]:my-2\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li]:flex\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li]:items-start\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li]:gap-2\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li]:my-1\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li_>_label]:shrink-0\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li_>_label]:mt-0.5\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li_>_label_>_input[type=checkbox]]:cursor-pointer\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li_>_label_>_input[type=checkbox]]:size-4\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li_>_label_>_input[type=checkbox]]:accent-primary\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li_>_div]:flex-1\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li[data-checked=true]_>_div]:line-through\",\n        \"[&_.ProseMirror_ul[data-type=taskList]_li[data-checked=true]_>_div]:opacity-60\",\n        className\n      )}\n      editor={editor}\n    />\n  )\n}\nexport interface TipTapFloatingMenuProps extends Omit<\n  ComponentProps<typeof FloatingMenu>,\n  \"editor\"\n> { }\n\nexport const TipTapFloatingMenu = (props: TipTapFloatingMenuProps) => {\n  const { editor } = useContext(TipTapContext)\n\n  return (\n    <FloatingMenu {...props} editor={editor}>\n      {/* <ScrollArea className=\"pb-2 max-h-[400px] overflow-auto bg-background border border-border rounded-md\">\n        {tiptapAllBlocks.map((item, index) => (\n          <div\n            className=\"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\"\n            key={`${item.key}-${index}`}\n          >\n            <div\n              className=\"flex size-8 items-center justify-center rounded-lg border border-border bg-background\"\n              aria-hidden=\"true\"\n            >\n              <item.icon size={16} strokeWidth={2} className=\"opacity-60\" />\n            </div>\n            <div>\n              <div className=\"text-sm font-medium\">{item.label}</div>\n              <div className=\"text-xs text-muted-foreground\">\n                {item.description}\n              </div>\n            </div>\n          </div>\n        ))}\n      </ScrollArea> */}\n    </FloatingMenu>\n  )\n}\n\nexport interface TipTapBubbleMenuProps extends Omit<\n  ComponentProps<typeof BubbleMenu>,\n  \"editor\" | \"children\"\n> { }\n\nexport const TipTapBubbleMenu = (props: TipTapBubbleMenuProps) => {\n  const { editor } = useContext(TipTapContext)\n\n  if (!editor) return null\n\n  return (\n    <BubbleMenu {...props} editor={editor}>\n      This is the bubble menu\n    </BubbleMenu>\n  )\n}\n\nexport interface TableBubbleMenuProps extends Omit<\n  ComponentProps<typeof BubbleMenu>,\n  \"editor\" | \"children\"\n> {\n  children?: React.ReactNode\n}\n\nexport const TableBubbleMenu = (props: TableBubbleMenuProps) => {\n  const { editor } = useContext(TipTapContext)\n\n  if (!editor) return null\n\n  const canMergeCells = editor.can().mergeCells()\n  const canSplitCell = editor.can().splitCell()\n  const canDeleteColumn = editor.can().deleteColumn()\n  const canDeleteRow = editor.can().deleteRow()\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"bottom\",\n        getReferenceClientRect: () => {\n          const { view, state } = editor\n          const domAtPos = view.domAtPos(state.selection.from)\n          const node = domAtPos.node\n          const tableElement =\n            node instanceof Element\n              ? node.closest(\"table\")\n              : node.parentElement?.closest(\"table\")\n          if (tableElement) {\n            return tableElement.getBoundingClientRect()\n          }\n          return view.dom.getBoundingClientRect()\n        },\n      }}\n      shouldShow={({ editor }) => editor.isActive(\"table\")}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {/* Column Actions */}\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n            >\n              <Columns3 className=\"size-3.5\" />\n              Column\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            align=\"start\"\n            sideOffset={8}\n            className={cn(\n              \"min-w-[160px]\",\n              \"bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\"\n            )}\n          >\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().toggleHeaderColumn().run()}\n            >\n              <TableProperties className=\"mr-2 size-3.5\" />\n              Toggle Header\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addColumnBefore().run()}\n            >\n              <ArrowLeftToLine className=\"mr-2 size-3.5\" />\n              Insert Before\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addColumnAfter().run()}\n            >\n              <ArrowRightToLine className=\"mr-2 size-3.5\" />\n              Insert After\n            </DropdownMenuItem>\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"textAlign\", \"left\")\n                  .run()\n              }\n            >\n              <AlignLeft className=\"mr-2 size-3.5\" />\n              Align Left\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"textAlign\", \"center\")\n                  .run()\n              }\n            >\n              <AlignCenter className=\"mr-2 size-3.5\" />\n              Align Center\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"textAlign\", \"right\")\n                  .run()\n              }\n            >\n              <AlignRight className=\"mr-2 size-3.5\" />\n              Align Right\n            </DropdownMenuItem>\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().deleteColumn().run()}\n              className=\"text-destructive focus:text-destructive\"\n            >\n              <Trash2 className=\"mr-2 size-3.5\" />\n              Delete Column\n            </DropdownMenuItem>\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        {/* Row Actions */}\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n            >\n              <Rows3 className=\"size-3.5\" />\n              Row\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            align=\"start\"\n            sideOffset={8}\n            className={cn(\n              \"min-w-[160px]\",\n              \"bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\"\n            )}\n          >\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().toggleHeaderRow().run()}\n            >\n              <TableProperties className=\"mr-2 size-3.5\" />\n              Toggle Header\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addRowBefore().run()}\n            >\n              <ArrowUpToLine className=\"mr-2 size-3.5\" />\n              Insert Above\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().addRowAfter().run()}\n            >\n              <ArrowDownToLine className=\"mr-2 size-3.5\" />\n              Insert Below\n            </DropdownMenuItem>\n\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"verticalAlign\", \"top\")\n                  .run()\n              }\n            >\n              <AlignVerticalJustifyStart className=\"mr-2 size-3.5\" />\n              Align Top\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"verticalAlign\", \"middle\")\n                  .run()\n              }\n            >\n              <AlignVerticalJustifyCenter className=\"mr-2 size-3.5\" />\n              Align Middle\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() =>\n                editor\n                  .chain()\n                  .focus()\n                  .setCellAttribute(\"verticalAlign\", \"bottom\")\n                  .run()\n              }\n            >\n              <AlignVerticalJustifyEnd className=\"mr-2 size-3.5\" />\n              Align Bottom\n            </DropdownMenuItem>\n            <div className=\"bg-border my-1 h-px\" />\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().deleteRow().run()}\n              className=\"text-destructive focus:text-destructive\"\n            >\n              <Trash2 className=\"mr-2 size-3.5\" />\n              Delete Row\n            </DropdownMenuItem>\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        {/* Cell Actions */}\n        <DropdownMenu modal={false}>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs\"\n            >\n              <Combine className=\"size-3.5\" />\n              Cell\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContentPrimitive\n            align=\"start\"\n            sideOffset={8}\n            className={cn(\n              \"min-w-[160px]\",\n              \"bg-popover text-popover-foreground z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md\",\n              \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\"\n            )}\n          >\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().mergeCells().run()}\n              disabled={!canMergeCells}\n            >\n              <Combine className=\"mr-2 size-3.5\" />\n              Merge Cells\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().splitCell().run()}\n              disabled={!canSplitCell}\n            >\n              <Split className=\"mr-2 size-3.5\" />\n              Split Cell\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => editor.chain().focus().toggleHeaderCell().run()}\n            >\n              <TableProperties className=\"mr-2 size-3.5\" />\n              Toggle Header Cell\n            </DropdownMenuItem>\n          </DropdownMenuContentPrimitive>\n        </DropdownMenu>\n\n        {/* Quick Delete Actions */}\n        <div className=\"ml-0.5 flex items-center gap-0.5 border-l pl-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 gap-1 px-2 text-xs\"\n            onClick={() => editor.chain().focus().deleteColumn().run()}\n            disabled={!canDeleteColumn}\n            title=\"Delete Column\"\n          >\n            <Columns3 className=\"size-3.5\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 gap-1 px-2 text-xs\"\n            onClick={() => editor.chain().focus().deleteRow().run()}\n            disabled={!canDeleteRow}\n            title=\"Delete Row\"\n          >\n            <Rows3 className=\"size-3.5\" />\n          </Button>\n        </div>\n\n        {/* Delete Table */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-7 w-7 p-0\"\n          onClick={() => editor.chain().focus().deleteTable().run()}\n          title=\"Delete Table\"\n        >\n          <Trash2 className=\"size-3.5\" />\n        </Button>\n      </div>\n    </BubbleMenu>\n  )\n}\n\n// =============================================================================\n// CodeBlock Bubble Menu (Notion-style language switcher)\n// =============================================================================\n\nexport interface CodeBlockBubbleMenuProps extends Omit<\n  ComponentProps<typeof BubbleMenu>,\n  \"editor\" | \"children\"\n> {\n  children?: React.ReactNode\n}\n\nexport const CodeBlockBubbleMenu = (props: CodeBlockBubbleMenuProps) => {\n  const { editor } = useContext(TipTapContext)\n  const [open, setOpen] = useState(false)\n  const [copied, setCopied] = useState(false)\n\n  if (!editor) return null\n\n  const currentLanguage =\n    editor.getAttributes(\"codeBlock\").language || \"plaintext\"\n\n  const currentLanguageLabel =\n    CODEBLOCK_LANGUAGES.find((lang) => lang.value === currentLanguage)?.name ||\n    currentLanguage\n\n  const handleSelectLanguage = (value: string) => {\n    editor\n      .chain()\n      .focus()\n      .updateAttributes(\"codeBlock\", { language: value })\n      .run()\n    setOpen(false)\n  }\n\n  const handleCopyCode = async () => {\n    const { state } = editor\n    const { from } = state.selection\n    const node = state.doc.nodeAt(from)\n\n    if (node && [\"codeBlock\", \"text\"].includes(node.type.name)) {\n      const code = node.textContent\n      await navigator.clipboard.writeText(code)\n      setCopied(true)\n      setTimeout(() => setCopied(false), 2000)\n    }\n  }\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"top-end\",\n        offset: [0, 8],\n        getReferenceClientRect: () => {\n          const { view, state } = editor\n          const { from } = state.selection\n\n          // Find the code block node and get its position\n          let codeBlockPos = from\n          state.doc.nodesBetween(from, from, (node, pos) => {\n            if (node.type.name === \"codeBlock\") {\n              codeBlockPos = pos\n              return false\n            }\n          })\n\n          const domNode = view.nodeDOM(codeBlockPos)\n          if (domNode instanceof HTMLElement) {\n            const preElement = domNode.querySelector(\"pre\") || domNode\n            if (preElement instanceof HTMLElement) {\n              return preElement.getBoundingClientRect()\n            }\n          }\n          return view.dom.getBoundingClientRect()\n        },\n      }}\n      shouldShow={({ editor }) => editor.isActive(\"codeBlock\")}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {/* Language Selector */}\n        <Popover open={open} onOpenChange={setOpen}>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 gap-1 px-2 text-xs font-normal\"\n              role=\"combobox\"\n              aria-expanded={open}\n            >\n              <Code2 className=\"size-3.5\" />\n              {currentLanguageLabel}\n              <ChevronDown className=\"size-3 opacity-50\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent\n            className=\"w-[200px] p-0\"\n            align=\"start\"\n            sideOffset={8}\n          >\n            <Command>\n              <CommandInput placeholder=\"Search language...\" className=\"h-9\" />\n              <CommandList>\n                <CommandEmpty>No language found.</CommandEmpty>\n                <CommandGroup>\n                  {CODEBLOCK_LANGUAGES.map((lang) => (\n                    <CommandItem\n                      key={lang.value}\n                      value={lang.name}\n                      onSelect={() => handleSelectLanguage(lang.value)}\n                    >\n                      {lang.name}\n                      {currentLanguage === lang.value && (\n                        <Check className=\"ml-auto size-4\" />\n                      )}\n                    </CommandItem>\n                  ))}\n                </CommandGroup>\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n\n        {/* Divider */}\n        <div className=\"bg-border h-4 w-px\" />\n\n        {/* Copy Button */}\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-7 w-7 p-0\"\n          onClick={handleCopyCode}\n          title={copied ? \"Copied!\" : \"Copy code\"}\n        >\n          {copied ? (\n            <Check className=\"size-3.5 text-green-500\" />\n          ) : (\n            <ClipboardCopy className=\"size-3.5\" />\n          )}\n        </Button>\n      </div>\n    </BubbleMenu>\n  )\n}\n\n// =============================================================================\n// Text Formatting Bubble Menu\n// =============================================================================\n\nexport interface TextBubbleMenuProps extends Omit<\n  ComponentProps<typeof BubbleMenu>,\n  \"editor\" | \"children\"\n> {\n  children?: React.ReactNode\n}\n\nexport const TextBubbleMenu = (props: TextBubbleMenuProps) => {\n  const { editor } = useContext(TipTapContext)\n  const [linkUrl, setLinkUrl] = useState(\"\")\n  const [showLinkInput, setShowLinkInput] = useState(false)\n\n  if (!editor) return null\n\n  const handleSetLink = () => {\n    if (linkUrl) {\n      editor\n        .chain()\n        .focus()\n        .extendMarkRange(\"link\")\n        .setLink({ href: linkUrl })\n        .run()\n      setLinkUrl(\"\")\n      setShowLinkInput(false)\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault()\n      handleSetLink()\n    }\n    if (e.key === \"Escape\") {\n      setShowLinkInput(false)\n      setLinkUrl(\"\")\n    }\n  }\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"top\",\n      }}\n      shouldShow={({ editor, from, to }) => {\n        // Only show for text selections, not tables/codeblocks/images\n        if (from === to) return false\n        if (editor.isActive(\"table\")) return false\n        if (editor.isActive(\"codeBlock\")) return false\n        if (editor.isActive(\"image\")) return false\n        return true\n      }}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {showLinkInput ? (\n          <div className=\"flex items-center gap-1 p-1\">\n            <Input\n              type=\"url\"\n              placeholder=\"https://...\"\n              value={linkUrl}\n              onChange={(e) => setLinkUrl(e.target.value)}\n              onKeyDown={handleKeyDown}\n              className=\"h-7 w-48 text-xs\"\n              autoFocus\n            />\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={handleSetLink}\n            >\n              <Check className=\"size-3.5\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => {\n                setShowLinkInput(false)\n                setLinkUrl(\"\")\n              }}\n            >\n              <Link2Off className=\"size-3.5\" />\n            </Button>\n          </div>\n        ) : (\n          <>\n            {/* Bold */}\n            <Button\n              variant={editor.isActive(\"bold\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleBold().run()}\n              title=\"Bold\"\n            >\n              <Bold className=\"size-3.5\" />\n            </Button>\n\n            {/* Italic */}\n            <Button\n              variant={editor.isActive(\"italic\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleItalic().run()}\n              title=\"Italic\"\n            >\n              <Italic className=\"size-3.5\" />\n            </Button>\n\n            {/* Underline */}\n            <Button\n              variant={editor.isActive(\"underline\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleUnderline().run()}\n              title=\"Underline\"\n            >\n              <Underline className=\"size-3.5\" />\n            </Button>\n\n            {/* Strikethrough */}\n            <Button\n              variant={editor.isActive(\"strike\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleStrike().run()}\n              title=\"Strikethrough\"\n            >\n              <Strikethrough className=\"size-3.5\" />\n            </Button>\n\n            {/* Code */}\n            <Button\n              variant={editor.isActive(\"code\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleCode().run()}\n              title=\"Code\"\n            >\n              <Code className=\"size-3.5\" />\n            </Button>\n\n            <div className=\"bg-border h-4 w-px\" />\n\n            {/* Highlight */}\n            <Button\n              variant={editor.isActive(\"highlight\") ? \"secondary\" : \"ghost\"}\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().toggleHighlight().run()}\n              title=\"Highlight\"\n            >\n              <Highlighter className=\"size-3.5\" />\n            </Button>\n\n            <div className=\"bg-border h-4 w-px\" />\n\n            {/* Link */}\n            {editor.isActive(\"link\") ? (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 w-7 p-0\"\n                onClick={() => editor.chain().focus().unsetLink().run()}\n                title=\"Remove Link\"\n              >\n                <Link2Off className=\"size-3.5\" />\n              </Button>\n            ) : (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 w-7 p-0\"\n                onClick={() => setShowLinkInput(true)}\n                title=\"Add Link\"\n              >\n                <Link2 className=\"size-3.5\" />\n              </Button>\n            )}\n          </>\n        )}\n      </div>\n    </BubbleMenu>\n  )\n}\n\n// =============================================================================\n// Link Bubble Menu (for editing existing links)\n// =============================================================================\n\nexport interface LinkBubbleMenuProps extends Omit<\n  ComponentProps<typeof BubbleMenu>,\n  \"editor\" | \"children\"\n> {\n  children?: React.ReactNode\n}\n\nexport const LinkBubbleMenu = (props: LinkBubbleMenuProps) => {\n  const { editor } = useContext(TipTapContext)\n  const [isEditing, setIsEditing] = useState(false)\n  const [linkUrl, setLinkUrl] = useState(\"\")\n\n  if (!editor) return null\n\n  const currentLink = editor.getAttributes(\"link\").href || \"\"\n\n  const handleEditLink = () => {\n    setLinkUrl(currentLink)\n    setIsEditing(true)\n  }\n\n  const handleSaveLink = () => {\n    if (linkUrl) {\n      editor\n        .chain()\n        .focus()\n        .extendMarkRange(\"link\")\n        .setLink({ href: linkUrl })\n        .run()\n    }\n    setIsEditing(false)\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault()\n      handleSaveLink()\n    }\n    if (e.key === \"Escape\") {\n      setIsEditing(false)\n    }\n  }\n\n  const handleOpenLink = () => {\n    if (currentLink) {\n      window.open(currentLink, \"_blank\", \"noopener,noreferrer\")\n    }\n  }\n\n  return (\n    <BubbleMenu\n      {...props}\n      editor={editor}\n      tippyOptions={{\n        duration: 100,\n        placement: \"bottom\",\n      }}\n      shouldShow={({ editor, from, to }) => {\n        // Only show when cursor is on a link (not selecting text)\n        if (from !== to) return false\n        return editor.isActive(\"link\")\n      }}\n      className=\"w-fit\"\n    >\n      <div className=\"bg-popover flex items-center gap-0.5 rounded-md border p-0.5 shadow-md\">\n        {isEditing ? (\n          <div className=\"flex items-center gap-1 px-1\">\n            <Input\n              type=\"url\"\n              placeholder=\"https://...\"\n              value={linkUrl}\n              onChange={(e) => setLinkUrl(e.target.value)}\n              onKeyDown={handleKeyDown}\n              className=\"h-7 w-48 text-xs\"\n              autoFocus\n            />\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={handleSaveLink}\n            >\n              <Check className=\"size-3.5\" />\n            </Button>\n          </div>\n        ) : (\n          <>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 max-w-[200px] gap-1 truncate px-2 text-xs font-normal\"\n              onClick={handleEditLink}\n              title=\"Edit link\"\n            >\n              <Link2 className=\"size-3.5 shrink-0\" />\n              <span className=\"truncate\">{currentLink}</span>\n            </Button>\n\n            <div className=\"bg-border h-4 w-px\" />\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 w-7 p-0\"\n              onClick={handleOpenLink}\n              title=\"Open link\"\n            >\n              <ExternalLink className=\"size-3.5\" />\n            </Button>\n\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-destructive hover:text-destructive h-7 w-7 p-0\"\n              onClick={() => editor.chain().focus().unsetLink().run()}\n              title=\"Remove link\"\n            >\n              <Link2Off className=\"size-3.5\" />\n            </Button>\n          </>\n        )}\n      </div>\n    </BubbleMenu>\n  )\n}\n\nexport const TiptapBubbleMenu = () => {\n  return (\n    <>\n      <TextBubbleMenu />\n      <LinkBubbleMenu />\n      <TableBubbleMenu />\n      <CodeBlockBubbleMenu />\n      <ImageBubbleMenu />\n    </>\n  )\n}\n\nexport function useTiptapEditorCurrentActionKeys() {\n  const { editor } = useTiptapEditor()\n  const selectionKeys = getCurrentTiptapAction(editor)\n\n  return selectionKeys.length ? selectionKeys : [tiptapActions.text]\n}\n\nexport function useTiptapEditorIsActive(key: TiptapAction) {\n  const { editor } = useTiptapEditor()\n  return !editor\n    ? false\n    : tiptapTextAlignActiveActions.includes(key)\n      ? editor?.isActive({ textAlign: key })\n      : editor?.isActive(key)\n}\n\nexport function onTiptapEventChangeBlock(\n  editor: Editor,\n  key: TiptapAction,\n  options: Record<string, any> = {}\n) {\n  switch (key) {\n    case tiptapActions.undo:\n      editor.chain().focus().undo().run()\n      break\n    case tiptapActions.redo:\n      editor.chain().focus().redo().run()\n      break\n    case tiptapActions.text:\n      editor.chain().focus().setParagraph().run()\n      break\n    case tiptapActions.heading1:\n      editor.chain().focus().setHeading({ level: 1 }).run()\n      break\n    case tiptapActions.heading2:\n      editor.chain().focus().setHeading({ level: 2 }).run()\n      break\n    case tiptapActions.heading3:\n      editor.chain().focus().setHeading({ level: 3 }).run()\n      break\n    case tiptapActions.heading4:\n      editor.chain().focus().setHeading({ level: 4 }).run()\n      break\n    case tiptapActions.heading5:\n      editor.chain().focus().setHeading({ level: 5 }).run()\n      break\n    case tiptapActions.heading6:\n      editor.chain().focus().setHeading({ level: 6 }).run()\n      break\n    case tiptapActions.codeBlock:\n      editor.chain().focus().toggleCodeBlock().run()\n      break\n    case tiptapActions.divider:\n      editor.chain().focus().setHorizontalRule().run()\n      break\n    case tiptapActions.bold:\n      editor.chain().focus().toggleBold().run()\n      break\n    case tiptapActions.italic:\n      editor.chain().focus().toggleItalic().run()\n      break\n    case tiptapActions.strike:\n      editor.chain().focus().toggleStrike().run()\n      break\n    case tiptapActions.code:\n      editor.chain().focus().toggleCode().run()\n      break\n    case tiptapActions.blockquote:\n      editor.chain().focus().setBlockquote().run()\n      break\n    case tiptapActions.bulletList:\n      editor.chain().focus().toggleBulletList().run()\n      break\n    case tiptapActions.orderedList:\n      editor.chain().focus().toggleOrderedList().run()\n      break\n    case tiptapActions.left:\n      editor.chain().focus().setTextAlign(\"left\").run()\n      break\n    case tiptapActions.center:\n      editor.chain().focus().setTextAlign(\"center\").run()\n      break\n    case tiptapActions.right:\n      editor.chain().focus().setTextAlign(\"right\").run()\n      break\n    case tiptapActions.underline:\n      editor.chain().focus().toggleUnderline().run()\n      break\n    case tiptapActions.image:\n      editor\n        .chain()\n        .focus()\n        .setImage({\n          src: options.src,\n          alt: options?.alt,\n          title: options?.title,\n        })\n        .run()\n      break\n    // Table actions\n    case tiptapActions.insertTable:\n      editor\n        .chain()\n        .focus()\n        .insertTable({ rows: 3, cols: 3, withHeaderRow: true })\n        .run()\n      break\n    case tiptapActions.addColumnBefore:\n      editor.chain().focus().addColumnBefore().run()\n      break\n    case tiptapActions.addColumnAfter:\n      editor.chain().focus().addColumnAfter().run()\n      break\n    case tiptapActions.deleteColumn:\n      editor.chain().focus().deleteColumn().run()\n      break\n    case tiptapActions.addRowBefore:\n      editor.chain().focus().addRowBefore().run()\n      break\n    case tiptapActions.addRowAfter:\n      editor.chain().focus().addRowAfter().run()\n      break\n    case tiptapActions.deleteRow:\n      editor.chain().focus().deleteRow().run()\n      break\n    case tiptapActions.deleteTable:\n      editor.chain().focus().deleteTable().run()\n      break\n    case tiptapActions.mergeCells:\n      editor.chain().focus().mergeCells().run()\n      break\n    case tiptapActions.splitCell:\n      editor.chain().focus().splitCell().run()\n      break\n    case tiptapActions.toggleHeaderColumn:\n      editor.chain().focus().toggleHeaderColumn().run()\n      break\n    case tiptapActions.toggleHeaderRow:\n      editor.chain().focus().toggleHeaderRow().run()\n      break\n    case tiptapActions.toggleHeaderCell:\n      editor.chain().focus().toggleHeaderCell().run()\n      break\n    case tiptapActions.mergeOrSplit:\n      editor.chain().focus().mergeOrSplit().run()\n      break\n    case tiptapActions.goToNextCell:\n      editor.chain().focus().goToNextCell().run()\n      break\n    case tiptapActions.goToPreviousCell:\n      editor.chain().focus().goToPreviousCell().run()\n      break\n    // Task list\n    case tiptapActions.taskList:\n      editor.chain().focus().toggleTaskList().run()\n      break\n    // Highlight\n    case tiptapActions.highlight:\n      editor.chain().focus().toggleHighlight().run()\n      break\n    // Link\n    case tiptapActions.setLink:\n      // Link is handled via LinkBubbleMenu with URL input\n      break\n    case tiptapActions.unsetLink:\n      editor.chain().focus().unsetLink().run()\n      break\n  }\n}\n\nexport function canUseAction(editor: Editor, action: TiptapAction) {\n  switch (action) {\n    // Required @tiptap/starter-kit\n    case tiptapActions.undo:\n      return editor.can().chain().focus().undo().run()\n    case tiptapActions.redo:\n      return editor.can().chain().focus().redo().run()\n    case tiptapActions.text:\n      return editor.can().chain().focus().setParagraph().run()\n    case tiptapActions.heading1:\n      return editor.can().chain().focus().setHeading({ level: 1 }).run()\n    case tiptapActions.heading2:\n      return editor.can().chain().focus().setHeading({ level: 2 }).run()\n    case tiptapActions.heading3:\n      return editor.can().chain().focus().setHeading({ level: 3 }).run()\n    case tiptapActions.heading4:\n      return editor.can().chain().focus().setHeading({ level: 4 }).run()\n    case tiptapActions.heading5:\n      return editor.can().chain().focus().setHeading({ level: 5 }).run()\n    case tiptapActions.heading6:\n      return editor.can().chain().focus().setHeading({ level: 6 }).run()\n    case tiptapActions.codeBlock:\n      return editor.can().chain().focus().toggleCodeBlock().run()\n    case tiptapActions.divider:\n      return editor.can().chain().focus().setHorizontalRule().run()\n    case tiptapActions.bold:\n      return editor.can().chain().focus().toggleBold().run()\n    case tiptapActions.italic:\n      return editor.can().chain().focus().toggleItalic().run()\n    case tiptapActions.strike:\n      return editor.can().chain().focus().toggleStrike().run()\n    case tiptapActions.code:\n      return editor.can().chain().focus().toggleCode().run()\n    case tiptapActions.blockquote:\n      return editor.can().chain().focus().setBlockquote().run()\n    case tiptapActions.bulletList:\n      return editor.can().chain().focus().toggleBulletList().run()\n    case tiptapActions.orderedList:\n      return editor.can().chain().focus().toggleOrderedList().run()\n    // Required @tiptap/extension-text-align\n    case tiptapActions.left:\n      return editor.can().chain().focus().setTextAlign(\"left\").run()\n    case tiptapActions.center:\n      return editor.can().chain().focus().setTextAlign(\"center\").run()\n    case tiptapActions.right:\n      return editor.can().chain().focus().setTextAlign(\"right\").run()\n    // Required @tiptap/extension-underline\n    case tiptapActions.underline:\n      return editor.can().chain().focus().toggleUnderline().run()\n    case tiptapActions.image:\n      return true\n    // Table actions\n    case tiptapActions.insertTable:\n      return editor\n        .can()\n        .chain()\n        .focus()\n        .insertTable({ rows: 3, cols: 3 })\n        .run()\n    case tiptapActions.addColumnBefore:\n      return editor.can().chain().focus().addColumnBefore().run()\n    case tiptapActions.addColumnAfter:\n      return editor.can().chain().focus().addColumnAfter().run()\n    case tiptapActions.deleteColumn:\n      return editor.can().chain().focus().deleteColumn().run()\n    case tiptapActions.addRowBefore:\n      return editor.can().chain().focus().addRowBefore().run()\n    case tiptapActions.addRowAfter:\n      return editor.can().chain().focus().addRowAfter().run()\n    case tiptapActions.deleteRow:\n      return editor.can().chain().focus().deleteRow().run()\n    case tiptapActions.deleteTable:\n      return editor.can().chain().focus().deleteTable().run()\n    case tiptapActions.mergeCells:\n      return editor.can().chain().focus().mergeCells().run()\n    case tiptapActions.splitCell:\n      return editor.can().chain().focus().splitCell().run()\n    case tiptapActions.toggleHeaderColumn:\n      return editor.can().chain().focus().toggleHeaderColumn().run()\n    case tiptapActions.toggleHeaderRow:\n      return editor.can().chain().focus().toggleHeaderRow().run()\n    case tiptapActions.toggleHeaderCell:\n      return editor.can().chain().focus().toggleHeaderCell().run()\n    case tiptapActions.mergeOrSplit:\n      return editor.can().chain().focus().mergeOrSplit().run()\n    case tiptapActions.goToNextCell:\n      return editor.can().chain().focus().goToNextCell().run()\n    case tiptapActions.goToPreviousCell:\n      return editor.can().chain().focus().goToPreviousCell().run()\n    // Task list\n    case tiptapActions.taskList:\n      return editor.can().chain().focus().toggleTaskList().run()\n    // Highlight\n    case tiptapActions.highlight:\n      return editor.can().chain().focus().toggleHighlight().run()\n    // Link\n    case tiptapActions.setLink:\n      return true\n    case tiptapActions.unsetLink:\n      return editor.isActive(\"link\")\n  }\n}\n\nexport function getCurrentTiptapAction(editor: Editor): TiptapAction[] {\n  const keys: Set<TiptapAction> = new Set([tiptapActions.text])\n\n  keys.clear()\n\n  if (editor.isActive(\"heading\")) {\n    const headingLevel = editor.getAttributes(\"heading\").level\n    const headingMap = `heading${headingLevel}`\n    keys.add((tiptapActions as any)[headingMap])\n  }\n\n  tiptapAllBlocks.forEach((block) => {\n    if (tiptapTextAlignActiveActions.includes(block.key)) {\n      if (editor.isActive({ textAlign: block.key })) {\n        keys.add(block.key)\n      }\n    }\n\n    if (editor.isActive(block.key)) {\n      keys.add(block.key)\n    }\n  })\n\n  return Array.from(keys)\n}\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:block"
}
